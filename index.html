<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLB CATEGORY SALES ANALYSIS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 25%, #24243e 50%, #0f0c29 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(118, 75, 162, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 24px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.2) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .header h1 {
            color: #ffffff;
            font-size: 3em;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            background: linear-gradient(135deg, #ffffff 0%, #a8b5ff 50%, #ffffff 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s linear infinite;
            position: relative;
            z-index: 1;
        }
        
        @keyframes shimmer {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }
        
        .header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1em;
            position: relative;
            z-index: 1;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.3em;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            margin-bottom: 30px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .loading .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid rgba(102, 126, 234, 0.8);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .stat-card h3 {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-card .value {
            color: #667eea;
            font-size: 2.5em;
            font-weight: bold;
        }
        
        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px 20px 0 0;
            padding: 8px;
            margin-bottom: 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            overflow-x: auto;
            gap: 8px;
        }
        
        .tab {
            padding: 16px 28px;
            cursor: pointer;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            font-size: 1em;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.95);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
            white-space: nowrap;
            position: relative;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .tab::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            padding: 2px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.5), rgba(118, 75, 162, 0.5));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tab:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .tab.active {
            color: #ffffff;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.6), rgba(118, 75, 162, 0.6));
            box-shadow: 
                0 4px 16px rgba(102, 126, 234, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        }
        
        .tab.active::before {
            opacity: 1;
        }
        
        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .chart-container {
            margin: 30px 0;
            padding: 30px;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .chart-title {
            font-size: 1.5em;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 25px;
            text-align: center;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .category-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .category-card h4 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .category-card .metric {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .category-card .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }
        
        .metric-value {
            color: #ffffff;
            font-weight: 700;
            font-size: 1.1em;
        }
        
        .voc-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .voc-item {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(102, 126, 234, 0.3);
            padding: 25px;
            border-radius: 20px;
            border-left: 4px solid rgba(102, 126, 234, 0.8);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .voc-item h4 {
            color: #ffffff;
            margin-bottom: 15px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .voc-item .score {
            font-size: 2.5em;
            font-weight: 700;
            color: #ffffff;
            background: linear-gradient(135deg, #ffffff 0%, #a8b5ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .search-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        .keyword-tag {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.4), rgba(118, 75, 162, 0.4));
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .keyword-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5);
        }
        
        .filter-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .filter-section select {
            padding: 12px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 1em;
            margin-right: 10px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: #ffffff;
            transition: all 0.3s;
        }
        
        .filter-section select:hover {
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .filter-section select:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.8);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        
        .filter-section label {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            margin-right: 15px;
        }
        
        .error-message {
            background: rgba(244, 67, 54, 0.2);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(244, 67, 54, 0.4);
            color: #ffcdd2;
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            border-left: 4px solid rgba(244, 67, 54, 0.8);
            box-shadow: 
                0 8px 32px rgba(244, 67, 54, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .category-group-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }
        
        .category-group {
            background: rgba(160, 160, 200, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.35);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        
        .category-group:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(170, 170, 210, 0.55);
        }
        
        .category-group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .category-group-header:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.4), rgba(118, 75, 162, 0.4));
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.3);
        }
        
        .collapse-icon {
            user-select: none;
            color: rgba(255, 255, 255, 0.9);
            font-weight: bold;
        }
        
        .category-group-header h3 {
            color: #ffffff;
            font-size: 1.5em;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .category-group-total {
            text-align: right;
        }
        
        .category-group-total .label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95em;
            display: block;
            font-weight: 600;
        }
        
        .category-group-total .value {
            color: #ffffff;
            font-size: 1.6em;
            font-weight: 700;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .category-item-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            transition: all 0.3s;
        }
        
        .group-filter-btn {
            padding: 12px 24px;
            border: 2px solid rgba(102, 126, 234, 0.5);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .group-filter-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.8);
        }
        
        .group-filter-btn.active {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8));
            color: white;
            border-color: rgba(102, 126, 234, 1);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .group-filter-btn:not(.active) {
            background: rgba(255, 255, 255, 0.15);
            color: #ffffff;
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .collapse-icon {
            user-select: none;
        }
        
        .category-item-card {
            background: linear-gradient(135deg, rgba(170, 170, 210, 0.55), rgba(190, 190, 230, 0.55));
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(102, 126, 234, 0.5);
            padding: 20px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .category-item-card:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.4), rgba(118, 75, 162, 0.4));
            border-color: rgba(102, 126, 234, 0.6);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 
                0 8px 24px rgba(102, 126, 234, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .category-item-card.active {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.6), rgba(118, 75, 162, 0.6));
            color: white;
            border-color: rgba(102, 126, 234, 0.8);
            box-shadow: 
                0 8px 24px rgba(102, 126, 234, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .category-item-card h4 {
            margin: 0 0 12px 0;
            font-size: 1.2em;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: 0.5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .category-item-card.active h4 {
            color: #ffffff;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.6);
        }
        
        .category-item-card .item-sales {
            font-size: 0.95em;
            color: #ffffff;
            margin-top: 8px;
        }
        
        .category-item-card.active .item-sales {
            color: #ffffff;
        }
        
        .sales-breakdown {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 10px;
        }
        
        .sales-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .sales-item:last-child {
            border-bottom: none;
        }
        
        .sales-label {
            color: #ffffff;
            font-weight: 600;
            font-size: 0.95em;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        .category-item-card.active .sales-label {
            color: #ffffff;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.6);
        }
        
        .sales-value {
            font-weight: 700;
            color: #ffffff;
            font-size: 1.2em;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.6);
        }
        
        .category-item-card.active .sales-value {
            color: #ffffff;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.7), 0 0 12px rgba(255, 255, 255, 0.3);
            font-size: 1.3em;
        }
        
        .total-breakdown {
            display: flex;
            flex-direction: column;
            gap: 8px;
            text-align: right;
        }
        
        .total-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .total-item .label {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
        }
        
        .total-item .value {
            font-size: 1.4em;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        
        .category-group-total {
            text-align: right;
        }
        
        .category-group-total .label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95em;
            display: block;
            font-weight: 600;
        }
        
        .category-group-total .value {
            color: #ffffff;
            font-size: 1.6em;
            font-weight: 700;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                border-bottom: 1px solid #eee;
                border-right: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MLB CATEGORY SALES ANALYSIS</h1>
            <p style="color: rgba(255, 255, 255, 0.8); font-size: 1.1em; letter-spacing: 1px;">ÌåêÎß§ ÌòÑÌô© ¬∑ VOC Î∂ÑÏÑù ¬∑ Í≤ÄÏÉâ Ìä∏Î†åÎìú ¬∑ ÌÜµÌï© Ïù∏ÏÇ¨Ïù¥Ìä∏</p>
        </div>
        
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...</p>
            <p style="font-size: 0.9em; color: rgba(255, 255, 255, 0.6); margin-top: 10px;">Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî</p>
        </div>
        
        <div id="dashboard" style="display: none;">
            <div class="tabs">
                <button class="tab active" onclick="showTab('sales', this)">ÌåêÎß§ ÌòÑÌô©</button>
                <button class="tab" onclick="showTab('category-detail', this)">Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÉÅÏÑ∏ Î∂ÑÏÑù</button>
                <button class="tab" onclick="showTab('voc', this)">VOC Î∂ÑÏÑù</button>
                <button class="tab" onclick="showTab('search', this)">Í≤ÄÏÉâ Ìä∏Î†åÎìú</button>
                <button class="tab" onclick="showTab('insights', this)">ÌÜµÌï© Ïù∏ÏÇ¨Ïù¥Ìä∏</button>
            </div>
            
            <div id="sales" class="tab-content active">
                <div class="chart-container">
                    <div class="chart-title">Ïπ¥ÌÖåÍ≥†Î¶¨ Í∑∏Î£πÎ≥Ñ ÌåêÎß§ ÌòÑÌô©</div>
                    
                    <!-- ÌïÑÌÑ∞ Î∞è Í≤ÄÏÉâ ÏòÅÏó≠ -->
                    <div style="margin-bottom: 25px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                        <div style="flex: 1; min-width: 250px;">
                            <input type="text" id="categorySearch" placeholder="Ïπ¥ÌÖåÍ≥†Î¶¨ Í≤ÄÏÉâ (Ïòà: DJ, MT, PT...)" 
                                   oninput="filterCategories()" 
                                   style="width: 100%; padding: 12px 18px; font-size: 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); color: #ffffff; transition: all 0.3s;"
                                   onfocus="this.style.borderColor='rgba(102, 126, 234, 0.8)'; this.style.background='rgba(255, 255, 255, 0.15)'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.2), 0 4px 12px rgba(102, 126, 234, 0.3)'" 
                                   onblur="this.style.borderColor='rgba(255, 255, 255, 0.2)'; this.style.background='rgba(255, 255, 255, 0.1)'; this.style.boxShadow='none'">
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button onclick="toggleGroup('OUTER')" id="filterOUTER" class="group-filter-btn">
                                OUTER
                            </button>
                            <button onclick="toggleGroup('INNER')" id="filterINNER" class="group-filter-btn">
                                INNER
                            </button>
                            <button onclick="toggleGroup('BOTTOM')" id="filterBOTTOM" class="group-filter-btn">
                                BOTTOM
                            </button>
                        </div>
                    </div>
                    
                    <div class="category-group-section" id="categoryGroups"></div>
                </div>
                
                <div class="chart-container" id="selectedCategoryChart" style="display: none;">
                    <div class="chart-title" id="selectedCategoryTitle">Ïπ¥ÌÖåÍ≥†Î¶¨ Ï£ºÏ∞®Î≥Ñ ÌåêÎß§ Ï∂îÏù¥</div>
                    
                    <!-- 24F vs 25F ÎπÑÍµê Í∑∏ÎûòÌîÑ -->
                    <div id="comparisonChartContainer" style="margin-bottom: 40px; display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="color: rgba(255, 255, 255, 0.95); margin: 0; font-weight: 700; letter-spacing: 0.5px;">24F vs 25F ÎπÑÍµê (24~10Ï£º)</h3>
                            <div style="display: flex; gap: 10px;">
                                <button id="btnCompareTotal" onclick="switchComparisonChart('total')" class="comparison-btn active" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                                    Ï†ÑÏ≤¥
                                </button>
                                <button id="btnCompareDomestic" onclick="switchComparisonChart('domestic')" class="comparison-btn" style="padding: 10px 20px; background: rgba(255, 255, 255, 0.2); color: rgba(255, 255, 255, 0.8); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                                    Íµ≠ÎÇ¥
                                </button>
                                <button id="btnCompareDF" onclick="switchComparisonChart('df')" class="comparison-btn" style="padding: 10px 20px; background: rgba(255, 255, 255, 0.2); color: rgba(255, 255, 255, 0.8); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                                    D/F
                                </button>
                        </div>
                    </div>
                        <div class="chart-wrapper">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                    </div>
                    
                    <div id="seasonCharts"></div>
                    <button onclick="closeCategoryChart()" style="margin-top: 15px; padding: 12px 24px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.4), rgba(118, 75, 162, 0.4)); backdrop-filter: blur(10px); color: white; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                        Îã´Í∏∞
                    </button>
                </div>
            </div>
            
            <div id="category-detail" class="tab-content">
                <div class="chart-container">
                    <div class="chart-title">Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÉÅÏÑ∏ Î∂ÑÏÑù</div>
                    <div style="margin-bottom: 20px;">
                        <label for="categorySelect" style="font-weight: bold; margin-right: 10px; font-size: 16px; color: rgba(255, 255, 255, 0.9);">Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù:</label>
                        <select id="categorySelect" onchange="loadCategoryDetail()" style="padding: 12px 20px; font-size: 16px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.2); min-width: 200px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); color: #000000; cursor: pointer; transition: all 0.3s; font-weight: 600;">
                            <option value="" style="background: #ffffff; color: #000000;">Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                        </select>
                    </div>
                    
                    <div id="categoryDetailContent" style="display: none;">
                        <!-- TOP5 Ï†úÌíà ÏÑπÏÖò -->
                        <div id="categoryTopProducts" style="margin-top: 30px; margin-bottom: 30px;"></div>
                        
                        <!-- 3D Í∑∏ÎûòÌîÑ ÏÜçÏÑ± ÏÑ†ÌÉù UI -->
                        <div id="attribute3DSelector" style="margin-bottom: 30px; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.2); display: none;">
                            <h4 style="color: rgba(255, 255, 255, 0.95); margin-bottom: 15px; font-weight: 600; font-size: 1.2em;">3D ÏÜçÏÑ± Î∂ÑÌè¨ Í∑∏ÎûòÌîÑ ÏÑ§Ï†ï</h4>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; color: rgba(255, 255, 255, 0.8); margin-bottom: 8px; font-size: 0.9em; font-weight: 500;">XÏ∂ï (ÏÑ±Î≥Ñ)</label>
                                    <select id="axisXSelect" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.95); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; color: #000000; font-size: 0.95em;">
                                        <option value="ÏÑ±Î≥Ñ">ÏÑ±Î≥Ñ</option>
                                        <option value="Ï§ëÎüâÍ∞ê">Ï§ëÎüâÍ∞ê</option>
                                        <option value="Ìïè1">Ìïè</option>
                                        <option value="Ìïè_Ïú†Ï†Ä">Ìïè_Ïú†Ï†Ä</option>
                                        <option value="Í∏∞Ïû•">Í∏∞Ïû•</option>
                                        <option value="Ï∂©Ï†ÑÏû¨">Ï∂©Ï†ÑÏû¨</option>
                                        <option value="ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº">ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº</option>
                                        <option value="ÏÜåÎπÑÏûêÍ∞Ä">ÏÜåÎπÑÏûêÍ∞Ä</option>
                                        <option value="ÌòïÌÉú1_Ïú†Ï†Ä">ÌòïÌÉú1_Ïú†Ï†Ä</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display: block; color: rgba(255, 255, 255, 0.8); margin-bottom: 8px; font-size: 0.9em; font-weight: 500;">YÏ∂ï (Ï§ëÎüâÍ∞ê)</label>
                                    <select id="axisYSelect" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.95); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; color: #000000; font-size: 0.95em;">
                                        <option value="Ï§ëÎüâÍ∞ê">Ï§ëÎüâÍ∞ê</option>
                                        <option value="ÏÑ±Î≥Ñ">ÏÑ±Î≥Ñ</option>
                                        <option value="Ìïè1">Ìïè</option>
                                        <option value="Ìïè_Ïú†Ï†Ä">Ìïè_Ïú†Ï†Ä</option>
                                        <option value="Í∏∞Ïû•">Í∏∞Ïû•</option>
                                        <option value="Ï∂©Ï†ÑÏû¨">Ï∂©Ï†ÑÏû¨</option>
                                        <option value="ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº">ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº</option>
                                        <option value="ÏÜåÎπÑÏûêÍ∞Ä">ÏÜåÎπÑÏûêÍ∞Ä</option>
                                        <option value="ÌòïÌÉú1_Ïú†Ï†Ä">ÌòïÌÉú1_Ïú†Ï†Ä</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display: block; color: rgba(255, 255, 255, 0.8); margin-bottom: 8px; font-size: 0.9em; font-weight: 500;">ZÏ∂ï (ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº)</label>
                                    <select id="axisZSelect" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.95); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; color: #000000; font-size: 0.95em;">
                                        <option value="ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº">ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº</option>
                                        <option value="ÏÑ±Î≥Ñ">ÏÑ±Î≥Ñ</option>
                                        <option value="Ï§ëÎüâÍ∞ê">Ï§ëÎüâÍ∞ê</option>
                                        <option value="Ìïè1">Ìïè</option>
                                        <option value="Ìïè_Ïú†Ï†Ä">Ìïè_Ïú†Ï†Ä</option>
                                        <option value="Í∏∞Ïû•">Í∏∞Ïû•</option>
                                        <option value="Ï∂©Ï†ÑÏû¨">Ï∂©Ï†ÑÏû¨</option>
                                        <option value="ÏÜåÎπÑÏûêÍ∞Ä">ÏÜåÎπÑÏûêÍ∞Ä</option>
                                        <option value="ÌòïÌÉú1_Ïú†Ï†Ä">ÌòïÌÉú1_Ïú†Ï†Ä</option>
                                    </select>
                                </div>
                            </div>
                            <button onclick="update3DChart()" style="padding: 12px 24px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.6), rgba(118, 75, 162, 0.6)); backdrop-filter: blur(10px); color: white; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                                Í∑∏ÎûòÌîÑ ÏÉùÏÑ±
                            </button>
                        </div>
                        
                        <div id="categoryAttributes" style="margin-top: 30px;"></div>
                        <div id="categoryInsights" style="margin-top: 30px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-radius: 15px; border-left: 5px solid #667eea; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.5em; display: flex; align-items: center; gap: 10px;">
                                <span>ü§ñ</span> AI Ïù∏ÏÇ¨Ïù¥Ìä∏
                            </h3>
                            <div id="insightsContent" style="line-height: 1.8; color: #333; font-size: 1.05em;"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="voc" class="tab-content">
                <div class="chart-container">
                    <div class="chart-title">VOC Î∂ÑÏÑù</div>
                    
                    <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ -->
                    <div style="margin-bottom: 25px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                        <label for="vocCategorySelect" style="font-weight: bold; font-size: 16px; color: rgba(255, 255, 255, 0.9);">Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù:</label>
                        <select id="vocCategorySelect" onchange="updateVocAnalysis()" 
                                style="padding: 12px 20px; font-size: 16px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.2); min-width: 200px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); color: #ffffff; cursor: pointer; transition: all 0.3s;">
                            <option value="" style="background: #1a1a2e; color: #ffffff;">Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                            <option value="DJ_PD">DJ/PD (Ìå®Îî©)</option>
                            <option value="WJ">WJ (Î∞îÎûåÎßâÏù¥)</option>
                            <option value="PT_WP_DP">PT/WP/DP (Ìå¨Ï∏†/Îç∞Îãò)</option>
                        </select>
                    </div>
                    
                    <!-- VOC ÏÉÅÏÑ∏ ÎÇ¥Ïö© ÏòÅÏó≠ -->
                    <div id="vocContent" style="display: none;">
                        <!-- ÎßåÏ°±ÎèÑ Ï†êÏàò Ï∞®Ìä∏ -->
                        <div id="vocSatisfactionChart" style="margin-bottom: 30px;"></div>
                        
                        <!-- VOC ÏÉÅÏÑ∏ ÎÇ¥Ïö© -->
                        <div id="vocDetails" style="margin-top: 30px;"></div>
                        
                        <!-- ÌåêÎß§ Îç∞Ïù¥ÌÑ∞ Ïó∞Í≥Ñ Ïù∏ÏÇ¨Ïù¥Ìä∏ -->
                        <div id="vocSalesInsights" style="margin-top: 40px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 30px; border-radius: 15px; border-left: 5px solid #667eea; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.5em; display: flex; align-items: center; gap: 10px;">
                                <span>üìä</span> ÌåêÎß§ Îç∞Ïù¥ÌÑ∞ Ïó∞Í≥Ñ Ïù∏ÏÇ¨Ïù¥Ìä∏
                            </h3>
                            <div id="vocInsightsContent" style="line-height: 1.8; color: #333; font-size: 1.05em;"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="search" class="tab-content">
                <div class="chart-container">
                    <div class="chart-title">Ïù∏Í∏∞ Í≤ÄÏÉâ ÌÇ§ÏõåÎìú Top 20</div>
                    <div class="chart-wrapper">
                        <canvas id="searchChart"></canvas>
                    </div>
                </div>
                
                <div class="search-keywords" id="keywordTags"></div>
            </div>
            
            <div id="insights" class="tab-content">
                <div class="chart-container">
                    <div class="chart-title">Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌåêÎß§ ÎπÑÏ§ë</div>
                    <div class="chart-wrapper">
                        <canvas id="categoryPieChart"></canvas>
                    </div>
                </div>
                
                <div class="category-grid" id="insightsCards"></div>
            </div>
        </div>
    </div>
    
    <script>
        let preprocessedData = null; // Ï†ÑÏ≤òÎ¶¨Îêú JSON Îç∞Ïù¥ÌÑ∞
        let vocDjData = [];
        let vocPtWpDpData = [];
        let vocWjData = [];
        let searchData = [];
        let storeData = [];
        let stylecodeData = [];
        
        let charts = {};
        
        // CSV ÌååÏùº Î°úÎìú (Ïä§Ìä∏Î¶¨Î∞ç Î™®Îìú - ÎåÄÏö©Îüâ ÌååÏùºÏö©)
        async function loadCSV(file, callback, useStreaming = false) {
            try {
                console.log(`Loading ${file}...`);
                const startTime = Date.now();
                
                const response = await fetch(file);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // Content-Length ÌôïÏù∏
                const contentLength = response.headers.get('content-length');
                if (contentLength) {
                    const sizeMB = (parseInt(contentLength) / 1024 / 1024).toFixed(2);
                    console.log(`${file} size: ${sizeMB}MB`);
                    
                    // 50MB Ïù¥ÏÉÅÏù¥Î©¥ Ïä§Ìä∏Î¶¨Î∞ç Î™®Îìú ÏÇ¨Ïö©
                    if (parseInt(contentLength) > 50 * 1024 * 1024) {
                        useStreaming = true;
                        console.log(`${file} is large, using streaming mode...`);
                    }
                }
                
                if (useStreaming) {
                    // Ïä§Ìä∏Î¶¨Î∞ç Î™®Îìú: Ï≤≠ÌÅ¨ Îã®ÏúÑÎ°ú Ï≤òÎ¶¨
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let buffer = '';
                    let rowCount = 0;
                    let headers = null;
                    const data = [];
                    
                    Papa.parse(response.body, {
                        header: true,
                        skipEmptyLines: true,
                        step: function(results) {
                            if (results.errors.length > 0) {
                                console.warn(`${file} parsing errors:`, results.errors);
                            }
                            if (results.data && Object.keys(results.data).length > 0) {
                                data.push(results.data);
                                rowCount++;
                                if (rowCount % 10000 === 0) {
                                    console.log(`${file} processed ${rowCount.toLocaleString()} rows...`);
                                }
                            }
                        },
                        complete: function() {
                            const parseTime = Date.now() - startTime;
                            console.log(`${file} parsed in ${parseTime}ms: ${data.length} rows`);
                            callback(data);
                        },
                        error: function(error) {
                            console.error(`Error parsing ${file}:`, error);
                            callback([]);
                        }
                    });
                } else {
                    // ÏùºÎ∞ò Î™®Îìú: Ï†ÑÏ≤¥ ÌååÏùºÏùÑ Î©îÎ™®Î¶¨Ïóê Î°úÎìú
                    const text = await response.text();
                    const loadTime = Date.now() - startTime;
                    console.log(`${file} loaded in ${loadTime}ms, text length: ${text.length}`);
                    
                    Papa.parse(text, {
                        header: true,
                        skipEmptyLines: true,
                        complete: function(results) {
                            const parseTime = Date.now() - startTime;
                            console.log(`${file} parsed in ${parseTime}ms: ${results.data.length} rows`);
                            if (results.errors && results.errors.length > 0) {
                                console.warn(`${file} parsing errors:`, results.errors.slice(0, 3));
                            }
                            callback(results.data);
                        },
                        error: function(error) {
                            console.error(`Error parsing ${file}:`, error);
                            callback([]);
                        }
                    });
                }
            } catch (error) {
                console.error(`Error loading ${file}:`, error);
                console.error('Error details:', error.message);
                callback([]);
            }
        }
        
        // Î™®Îì† Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        async function loadAllData() {
            const loadingEl = document.getElementById('loading');
            const dashboardEl = document.getElementById('dashboard');
            
            try {
                loadingEl.innerHTML = '<div class="spinner"></div><p>Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...</p>';
                
                // Ïô∏Î∂Ä Îç∞Ïù¥ÌÑ∞ ÌååÏùº Î°úÎìú
                console.log('Ïô∏Î∂Ä Îç∞Ïù¥ÌÑ∞ ÌååÏùº Î°úÎìú Ï§ë...');
                const response = await fetch('dashboard_data.json');
                if (!response.ok) {
                    throw new Error('Îç∞Ïù¥ÌÑ∞ ÌååÏùºÏùÑ Î°úÎìúÌï† Ïàò ÏóÜÏäµÎãàÎã§: ' + response.status);
                }
                
                const data = await response.json();
                preprocessedData = data;
                
                // CSV Îç∞Ïù¥ÌÑ∞Îäî Îπà Î∞∞Ïó¥Î°ú Ï¥àÍ∏∞Ìôî
                vocDjData = [];
                vocPtWpDpData = [];
                vocWjData = [];
                searchData = [];
                storeData = [];
                stylecodeData = [];
                
                console.log('Î™®Îì† Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å!');
                console.log('Ïπ¥ÌÖåÍ≥†Î¶¨ Í∑∏Î£π:', Object.keys(preprocessedData.categories || {}));
                
                loadingEl.style.display = 'none';
                dashboardEl.style.display = 'block';
                
                initializeDashboard();
            } catch (error) {
                loadingEl.innerHTML = `
                    <div class="error-message">
                        <h3>Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ïò§Î•ò</h3>
                        <p>Îç∞Ïù¥ÌÑ∞ ÌååÏùºÏùÑ Î°úÎìúÌï† Ïàò ÏóÜÏäµÎãàÎã§.</p>
                        <p style="margin-top: 10px; font-size: 0.9em;">Ïò§Î•ò: ${error.message}</p>
                        <p style="margin-top: 10px; font-size: 0.9em;">dashboard_data.json ÌååÏùºÏù¥ Í∞ôÏùÄ Ìè¥ÎçîÏóê ÏûàÎäîÏßÄ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.</p>
                    </div>
                `;
                console.error('Error loading data:', error);
            }
        }
                function parseNumber(value) {
            if (typeof value === 'string') {
                return parseFloat(value.replace(/,/g, '')) || 0;
            }
            return parseFloat(value) || 0;
        }
        
        // ÎåÄÏãúÎ≥¥Îìú Ï¥àÍ∏∞Ìôî
        function initializeDashboard() {
            updateCategoryCharts();
            initializeCategoryDetail();
            updateVocCharts();
            updateSearchCharts();
            updateInsights();
        }
        
        // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÉÅÏÑ∏ Î∂ÑÏÑù Ï¥àÍ∏∞Ìôî
        function initializeCategoryDetail() {
            if (!preprocessedData || !preprocessedData.categories) return;
            
            const select = document.getElementById('categorySelect');
            if (!select) return;
            
            select.innerHTML = '<option value="">Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>';
            
            // Î™®Îì† Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∂îÍ∞Ä (ETC Ìè¨Ìï®)
            ['OUTER', 'INNER', 'BOTTOM', 'ETC'].forEach(group => {
                const categories = preprocessedData.categories[group] || [];
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.item;
                    option.textContent = `${cat.item} (${group})`;
                    option.style.background = '#ffffff';
                    option.style.color = '#000000';
                    select.appendChild(option);
                });
            });
        }
        
        // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÉÅÏÑ∏ Î∂ÑÏÑù Î°úÎìú
        function loadCategoryDetail() {
            const category = document.getElementById('categorySelect').value;
            const contentDiv = document.getElementById('categoryDetailContent');
            const attributesDiv = document.getElementById('categoryAttributes');
            const insightsDiv = document.getElementById('insightsContent');
            
            if (!category || !preprocessedData || !preprocessedData.categoryAttributes) {
                if (contentDiv) contentDiv.style.display = 'none';
                return;
            }
            
            const attributes = preprocessedData.categoryAttributes[category];
            if (!attributes) {
                if (contentDiv) contentDiv.style.display = 'none';
                return;
            }
            
            if (contentDiv) contentDiv.style.display = 'block';
            
            // 3D Í∑∏ÎûòÌîÑ ÏÜçÏÑ± ÏÑ†ÌÉù UI ÌëúÏãú
            const selectorDiv = document.getElementById('attribute3DSelector');
            if (selectorDiv) {
                selectorDiv.style.display = 'block';
            }
            
            // ÏÑ†ÌÉùÌïú Ïπ¥ÌÖåÍ≥†Î¶¨Ïùò Í∑∏Î£π Ï∞æÍ∏∞
            let categoryGroup = null;
            ['OUTER', 'INNER', 'BOTTOM', 'ETC'].forEach(group => {
                const categories = preprocessedData.categories[group] || [];
                if (categories.find(cat => cat.item === category)) {
                    categoryGroup = group;
                }
            });
            
            // TOP5 ÌíàÎ≤à ÌëúÏãú (ÏÑ†ÌÉùÌïú Ïπ¥ÌÖåÍ≥†Î¶¨ ÎÇ¥Ïùò ÌíàÎ≤àÎì§)
            const topProductsDiv = document.getElementById('categoryTopProducts');
            if (topProductsDiv && preprocessedData.categoryStylecodes && preprocessedData.categoryStylecodes[category]) {
                const stylecodes = preprocessedData.categoryStylecodes[category];
                
                // 25F ÏãúÏ¶å ÎàÑÏ†Å ÌåêÎß§ TOP5 ÌíàÎ≤à
                const top5_25F = Object.keys(stylecodes)
                    .map(stylecode => {
                        const stylecodeData = stylecodes[stylecode];
                        let sales25F = 0;
                        if (stylecodeData.timeSeries && stylecodeData.timeSeries['25F']) {
                            Object.values(stylecodeData.timeSeries['25F']).forEach(weekData => {
                                sales25F += weekData.salesTotal || 0;
                            });
                        }
                        return {
                            stylecode: stylecode,
                            productName: stylecodeData.attributes?.Ï†úÌíàÎ™Ö || '',
                            salesTotal: sales25F
                        };
                    })
                    .sort((a, b) => b.salesTotal - a.salesTotal)
                    .slice(0, 5);
                
                // 24F ÏãúÏ¶å ÎàÑÏ†Å ÌåêÎß§ TOP5 ÌíàÎ≤à
                const top5_24F = Object.keys(stylecodes)
                    .map(stylecode => {
                        const stylecodeData = stylecodes[stylecode];
                        let sales24F = 0;
                        if (stylecodeData.timeSeries && stylecodeData.timeSeries['24F']) {
                            Object.values(stylecodeData.timeSeries['24F']).forEach(weekData => {
                                sales24F += weekData.salesTotal || 0;
                            });
                        }
                        return {
                            stylecode: stylecode,
                            productName: stylecodeData.attributes?.Ï†úÌíàÎ™Ö || '',
                            salesTotal: sales24F
                        };
                    })
                    .sort((a, b) => b.salesTotal - a.salesTotal)
                    .slice(0, 5);
                
                // ÏµúÍ∑º Ï£ºÍ∞Ñ ÌåêÎß§ TOP5 ÌíàÎ≤à (25F ÏãúÏ¶åÏùò Í∞ÄÏû• ÏµúÍ∑º Ï£ºÏ∞® Í∏∞Ï§Ä)
                let recentWeekTop5_25F = [];
                let recentWeekTop5_24F = [];
                let latestWeekKey = null;
                let sameWeekKey24F = null;
                
                if (preprocessedData.categoryStylecodes[category]) {
                    // Í∞ÄÏû• ÏµúÍ∑º Ï£ºÏ∞® Ï∞æÍ∏∞ (25F)
                    let latestWeek = null;
                    
                    Object.keys(stylecodes).forEach(stylecode => {
                        const stylecodeData = stylecodes[stylecode];
                        if (stylecodeData.timeSeries && stylecodeData.timeSeries['25F']) {
                            const weeks25F = stylecodeData.timeSeries['25F'];
                            Object.keys(weeks25F).forEach(weekKey => {
                                const match = weekKey.match(/(\d+)W(\d+)/);
                                if (match) {
                                    const year = parseInt(match[1]);
                                    const week = parseInt(match[2]);
                                    const fullYear = year < 100 ? 2000 + year : year;
                                    const sortKey = getWeekSortKey(fullYear, week);
                                    
                                    if (!latestWeek || sortKey > latestWeek) {
                                        latestWeek = sortKey;
                                        latestWeekKey = weekKey;
                                    }
                                }
                            });
                        }
                    });
                    
                    // 24ÎÖÑÎèÑ ÎèôÏùº Ï£ºÏ∞® Ï∞æÍ∏∞
                    if (latestWeekKey) {
                        const match = latestWeekKey.match(/(\d+)W(\d+)/);
                        if (match) {
                            const week = parseInt(match[2]);
                            sameWeekKey24F = `24W${week.toString().padStart(2, '0')}`;
                        }
                    }
                    
                    // ÏµúÍ∑º Ï£ºÏ∞®Ïùò ÌåêÎß§Ïï°Í≥º ÏàòÎüâÏúºÎ°ú Ï†ïÎ†¨ (25F) - Ï†ÑÏ≤¥ Í∏∞Ï§Ä
                    if (latestWeekKey) {
                        recentWeekTop5_25F = Object.keys(stylecodes)
                            .map(stylecode => {
                                const stylecodeData = stylecodes[stylecode];
                                let recentSales = 0;
                                let recentQuantity = 0;
                                if (stylecodeData.timeSeries && 
                                    stylecodeData.timeSeries['25F'] &&
                                    stylecodeData.timeSeries['25F'][latestWeekKey]) {
                                    recentSales = stylecodeData.timeSeries['25F'][latestWeekKey].salesTotal || 0;
                                    recentQuantity = stylecodeData.timeSeries['25F'][latestWeekKey].quantityTotal || 0;  // MÏó¥(Ï†ÑÏ≤¥)
                                }
                                return {
                                    stylecode: stylecode,
                                    productName: stylecodeData.attributes?.Ï†úÌíàÎ™Ö || '',
                                    salesTotal: recentSales,
                                    quantityTotal: recentQuantity
                                };
                            })
                            .sort((a, b) => b.salesTotal - a.salesTotal)
                            .slice(0, 5);
                    }
                    
                    // 24ÎÖÑÎèÑ ÎèôÏùº Ï£ºÏ∞®Ïùò ÌåêÎß§Ïï°Í≥º ÏàòÎüâÏúºÎ°ú Ï†ïÎ†¨ (24F) - Ï†ÑÏ≤¥ Í∏∞Ï§Ä
                    if (sameWeekKey24F) {
                        recentWeekTop5_24F = Object.keys(stylecodes)
                            .map(stylecode => {
                                const stylecodeData = stylecodes[stylecode];
                                let recentSales = 0;
                                let recentQuantity = 0;
                                if (stylecodeData.timeSeries && 
                                    stylecodeData.timeSeries['24F'] &&
                                    stylecodeData.timeSeries['24F'][sameWeekKey24F]) {
                                    recentSales = stylecodeData.timeSeries['24F'][sameWeekKey24F].salesTotal || 0;
                                    recentQuantity = stylecodeData.timeSeries['24F'][sameWeekKey24F].quantityTotal || 0;  // MÏó¥(Ï†ÑÏ≤¥)
                                }
                                return {
                                    stylecode: stylecode,
                                    productName: stylecodeData.attributes?.Ï†úÌíàÎ™Ö || '',
                                    salesTotal: recentSales,
                                    quantityTotal: recentQuantity
                                };
                            })
                            .sort((a, b) => b.salesTotal - a.salesTotal)
                            .slice(0, 5);
                    }
                }
                
                // HTML ÏÉùÏÑ±
                let topProductsHtml = `
                    <div class="chart-container" style="border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 20px; padding: 30px; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); margin-bottom: 30px;">
                        <div class="chart-title" style="font-size: 1.5em; margin-bottom: 25px; color: #ffffff; font-weight: 700; letter-spacing: 0.5px;">${category} ÌíàÎ≤à TOP5</div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                            <!-- 25F ÎàÑÏ†Å ÌåêÎß§ TOP5 ÌíàÎ≤à -->
                            <div style="border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 20px; background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="color: rgba(255, 255, 255, 0.95); margin: 0; font-weight: 600; font-size: 1.2em;">25F ÎàÑÏ†Å ÌåêÎß§ TOP5</h4>
                                    <div style="display: flex; gap: 8px;">
                                        <button id="toggleBtn1" onclick="toggleTop5List('top5List1', 'toggleBtn1')" style="padding: 6px 12px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.6), rgba(118, 75, 162, 0.6)); border: none; border-radius: 8px; color: white; font-weight: 600; font-size: 0.75em; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 12px rgba(0, 0, 0, 0.3)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.2)'">
                                            üìã Î™©Î°ù Î≥¥Í∏∞
                                        </button>
                                        <button onclick="showStyleInsight('${category}', 'cumulative25F', 'insightContent1')" style="padding: 6px 12px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8)); border: none; border-radius: 8px; color: white; font-weight: 600; font-size: 0.75em; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 12px rgba(0, 0, 0, 0.3)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.2)'">
                                            ü§ñ AI Î∂ÑÏÑù
                                        </button>
                                    </div>
                                </div>
                                <div id="top5List1" style="display: none; background: rgba(255, 255, 255, 0.02); border-radius: 12px; padding: 20px;">
                                    ${top5_25F.length > 0 ? top5_25F.map((item, index) => `
                                        <div style="padding: 12px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                                                    <span style="font-size: 1.2em; font-weight: bold; color: rgba(102, 126, 234, 1); min-width: 30px;">${index + 1}</span>
                                                    <div style="display: flex; flex-direction: column; gap: 2px;">
                                                        <span style="color: rgba(255, 255, 255, 0.9); font-weight: 600;">${item.stylecode}</span>
                                                        ${item.productName ? `<span style="color: rgba(255, 255, 255, 0.7); font-size: 0.85em;">${item.productName}</span>` : ''}
                                                    </div>
                                                </div>
                                                <span style="color: rgba(255, 255, 255, 0.9); font-weight: 600;">${formatSalesAmount(item.salesTotal)} (Î∞±ÎßåÏõê)</span>
                                            </div>
                                        </div>
                                    `).join('') : '<div style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 20px;">25F Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>'}
                                </div>
                                <div id="insightContent1" style="display: none; margin-top: 15px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1);"></div>
                            </div>
                            
                            <!-- 24F ÎàÑÏ†Å ÌåêÎß§ TOP5 ÌíàÎ≤à -->
                            <div style="border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 20px; background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="color: rgba(255, 255, 255, 0.95); margin: 0; font-weight: 600; font-size: 1.2em;">24F ÎàÑÏ†Å ÌåêÎß§ TOP5</h4>
                                    <div style="display: flex; gap: 8px;">
                                        <button id="toggleBtn2" onclick="toggleTop5List('top5List2', 'toggleBtn2')" style="padding: 6px 12px; background: linear-gradient(135deg, rgba(156, 39, 176, 0.6), rgba(118, 75, 162, 0.6)); border: none; border-radius: 8px; color: white; font-weight: 600; font-size: 0.75em; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 12px rgba(0, 0, 0, 0.3)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.2)'">
                                            üìã Î™©Î°ù Î≥¥Í∏∞
                                        </button>
                                        <button onclick="showStyleInsight('${category}', 'cumulative24F', 'insightContent2')" style="padding: 6px 12px; background: linear-gradient(135deg, rgba(156, 39, 176, 0.8), rgba(118, 75, 162, 0.8)); border: none; border-radius: 8px; color: white; font-weight: 600; font-size: 0.75em; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 12px rgba(0, 0, 0, 0.3)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.2)'">
                                            ü§ñ AI Î∂ÑÏÑù
                                        </button>
                                    </div>
                                </div>
                                <div id="top5List2" style="display: none; background: rgba(255, 255, 255, 0.02); border-radius: 12px; padding: 20px;">
                                    ${top5_24F.length > 0 ? top5_24F.map((item, index) => `
                                        <div style="padding: 12px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                                                    <span style="font-size: 1.2em; font-weight: bold; color: rgba(156, 39, 176, 1); min-width: 30px;">${index + 1}</span>
                                                    <div style="display: flex; flex-direction: column; gap: 2px;">
                                                        <span style="color: rgba(255, 255, 255, 0.9); font-weight: 600;">${item.stylecode}</span>
                                                        ${item.productName ? `<span style="color: rgba(255, 255, 255, 0.7); font-size: 0.85em;">${item.productName}</span>` : ''}
                                                    </div>
                                                </div>
                                                <span style="color: rgba(255, 255, 255, 0.9); font-weight: 600;">${formatSalesAmount(item.salesTotal)} (Î∞±ÎßåÏõê)</span>
                                            </div>
                                        </div>
                                    `).join('') : '<div style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 20px;">24F Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>'}
                                </div>
                                <div id="insightContent2" style="display: none; margin-top: 15px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1);"></div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                            <!-- 25F ÏµúÍ∑º Ï£ºÍ∞Ñ ÌåêÎß§ TOP5 ÌíàÎ≤à -->
                            <div style="border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 20px; background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="color: rgba(255, 255, 255, 0.95); margin: 0; font-weight: 600; font-size: 1.2em;">25F ÏµúÍ∑º Ï£ºÍ∞Ñ ÌåêÎß§ TOP5 ${latestWeekKey ? `(${latestWeekKey})` : ''}</h4>
                                    <div style="display: flex; gap: 8px;">
                                        <button id="toggleBtn3" onclick="toggleTop5List('top5List3', 'toggleBtn3')" style="padding: 6px 12px; background: linear-gradient(135deg, rgba(76, 175, 80, 0.6), rgba(56, 142, 60, 0.6)); border: none; border-radius: 8px; color: white; font-weight: 600; font-size: 0.75em; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 12px rgba(0, 0, 0, 0.3)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.2)'">
                                            üìã Î™©Î°ù Î≥¥Í∏∞
                                        </button>
                                        <button onclick="showStyleInsight('${category}', 'weekly25F', 'insightContent3')" style="padding: 6px 12px; background: linear-gradient(135deg, rgba(76, 175, 80, 0.8), rgba(56, 142, 60, 0.8)); border: none; border-radius: 8px; color: white; font-weight: 600; font-size: 0.75em; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 12px rgba(0, 0, 0, 0.3)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.2)'">
                                            ü§ñ AI Î∂ÑÏÑù
                                        </button>
                                    </div>
                                </div>
                                <div id="top5List3" style="display: none; background: rgba(255, 255, 255, 0.02); border-radius: 12px; padding: 20px;">
                                    ${recentWeekTop5_25F.length > 0 ? recentWeekTop5_25F.map((item, index) => `
                                        <div style="padding: 12px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                                                    <span style="font-size: 1.2em; font-weight: bold; color: rgba(76, 175, 80, 1); min-width: 30px;">${index + 1}</span>
                                                    <div style="display: flex; flex-direction: column; gap: 2px;">
                                                        <span style="color: rgba(255, 255, 255, 0.9); font-weight: 600;">${item.stylecode}</span>
                                                        ${item.productName ? `<span style="color: rgba(255, 255, 255, 0.7); font-size: 0.85em;">${item.productName}</span>` : ''}
                                                    </div>
                                                </div>
                                                <span style="color: rgba(255, 255, 255, 0.9); font-weight: 600;">${formatSalesAmount(item.salesTotal)} (Î∞±ÎßåÏõê)</span>
                                            </div>
                                            <div style="text-align: right; color: rgba(255, 255, 255, 0.7); font-size: 0.9em;">
                                                ÏàòÎüâ: ${formatQuantity(item.quantityTotal)}Í∞ú
                                            </div>
                                        </div>
                                    `).join('') : '<div style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 20px;">ÏµúÍ∑º Ï£ºÍ∞Ñ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>'}
                                </div>
                                <div id="insightContent3" style="display: none; margin-top: 15px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1);"></div>
                            </div>
                            
                            <!-- 24F ÎèôÏùº Ï£ºÍ∞Ñ ÌåêÎß§ TOP5 ÌíàÎ≤à -->
                            <div style="border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 20px; background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="color: rgba(255, 255, 255, 0.95); margin: 0; font-weight: 600; font-size: 1.2em;">24F ÎèôÏùº Ï£ºÍ∞Ñ ÌåêÎß§ TOP5 ${sameWeekKey24F ? `(${sameWeekKey24F})` : ''}</h4>
                                    <div style="display: flex; gap: 8px;">
                                        <button id="toggleBtn4" onclick="toggleTop5List('top5List4', 'toggleBtn4')" style="padding: 6px 12px; background: linear-gradient(135deg, rgba(255, 152, 0, 0.6), rgba(245, 124, 0, 0.6)); border: none; border-radius: 8px; color: white; font-weight: 600; font-size: 0.75em; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 12px rgba(0, 0, 0, 0.3)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.2)'">
                                            üìã Î™©Î°ù Î≥¥Í∏∞
                                        </button>
                                        <button onclick="showStyleInsight('${category}', 'weekly24F', 'insightContent4')" style="padding: 6px 12px; background: linear-gradient(135deg, rgba(255, 152, 0, 0.8), rgba(245, 124, 0, 0.8)); border: none; border-radius: 8px; color: white; font-weight: 600; font-size: 0.75em; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 12px rgba(0, 0, 0, 0.3)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.2)'">
                                            ü§ñ AI Î∂ÑÏÑù
                                        </button>
                                    </div>
                                </div>
                                <div id="top5List4" style="display: none; background: rgba(255, 255, 255, 0.02); border-radius: 12px; padding: 20px;">
                                    ${recentWeekTop5_24F.length > 0 ? recentWeekTop5_24F.map((item, index) => `
                                        <div style="padding: 12px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                                                    <span style="font-size: 1.2em; font-weight: bold; color: rgba(255, 152, 0, 1); min-width: 30px;">${index + 1}</span>
                                                    <div style="display: flex; flex-direction: column; gap: 2px;">
                                                        <span style="color: rgba(255, 255, 255, 0.9); font-weight: 600;">${item.stylecode}</span>
                                                        ${item.productName ? `<span style="color: rgba(255, 255, 255, 0.7); font-size: 0.85em;">${item.productName}</span>` : ''}
                                                    </div>
                                                </div>
                                                <span style="color: rgba(255, 255, 255, 0.9); font-weight: 600;">${formatSalesAmount(item.salesTotal)} (Î∞±ÎßåÏõê)</span>
                                            </div>
                                            <div style="text-align: right; color: rgba(255, 255, 255, 0.7); font-size: 0.9em;">
                                                ÏàòÎüâ: ${formatQuantity(item.quantityTotal)}Í∞ú
                                            </div>
                                        </div>
                                    `).join('') : '<div style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 20px;">ÎèôÏùº Ï£ºÍ∞Ñ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>'}
                                </div>
                                <div id="insightContent4" style="display: none; margin-top: 15px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1);"></div>
                            </div>
                        </div>
                    </div>
                `;
                
                topProductsDiv.innerHTML = topProductsHtml;
                
                // TOP5 Îç∞Ïù¥ÌÑ∞Î•º Ï†ÑÏó≠ Î≥ÄÏàòÏóê Ï†ÄÏû• (Ïù∏ÏÇ¨Ïù¥Ìä∏ Î∂ÑÏÑùÏö©)
                window.top5Data = {
                    cumulative25F: top5_25F,
                    cumulative24F: top5_24F,
                    weekly25F: recentWeekTop5_25F,
                    weekly24F: recentWeekTop5_24F
                };
            } else if (topProductsDiv) {
                topProductsDiv.innerHTML = '<div style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 20px;">ÌíàÎ≤à Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</div>';
            }
            
            // Í∏∞Ï°¥ Ï∞®Ìä∏ Ï†úÍ±∞
            Object.keys(attributes).forEach(attrName => {
                const chartId = `chart_${category}_${attrName}`;
                const existingChart = charts[chartId];
                if (existingChart) {
                    charts[chartId].destroy();
                    delete charts[chartId];
                }
            });
            
            // 3D ÏÜçÏÑ± Î∂ÑÌè¨ Í∑∏ÎûòÌîÑ ÏÉùÏÑ± (DJ Ïπ¥ÌÖåÍ≥†Î¶¨Îßå)
            console.log('3D Í∑∏ÎûòÌîÑ ÏÉùÏÑ± Ï≤¥ÌÅ¨:', { 
                category, 
                isDJ: category === 'DJ',
                hasAttributesDiv: !!attributesDiv, 
                hasCategoryAttributes: !!(preprocessedData && preprocessedData.categoryAttributes && preprocessedData.categoryAttributes[category]) 
            });
            
            if (category === 'DJ' && attributesDiv && preprocessedData && preprocessedData.categoryAttributes && preprocessedData.categoryAttributes[category]) {
                // Í∏∞Ï°¥ 3D Í∑∏ÎûòÌîÑ Ï†úÍ±∞
                const existing3DChart = document.getElementById('attribute3DChart');
                if (existing3DChart) {
                    existing3DChart.remove();
                }
                // ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ Í∑∏ÎûòÌîÑ ÏÉùÏÑ± (DOMÏù¥ ÏôÑÏ†ÑÌûà Î†åÎçîÎßÅÎêú ÌõÑ)
                setTimeout(() => {
                    console.log('3D Í∑∏ÎûòÌîÑ ÏÉùÏÑ± ÏãúÏûë...');
                    create3DAttributeChart(category, attributesDiv);
                }, 200);
            } else {
                console.log('3D Í∑∏ÎûòÌîÑ ÏÉùÏÑ± Ï°∞Í±¥ Î∂àÎßåÏ°±:', {
                    category,
                    isDJ: category === 'DJ',
                    hasAttributesDiv: !!attributesDiv,
                    hasPreprocessedData: !!preprocessedData,
                    hasCategoryAttributes: !!(preprocessedData && preprocessedData.categoryAttributes),
                    hasCategoryData: !!(preprocessedData && preprocessedData.categoryAttributes && preprocessedData.categoryAttributes[category])
                });
            }
            
            // ÏÜçÏÑ±Î≥Ñ Ï∞®Ìä∏ ÏÉùÏÑ± (ÏßëÍ≥Ñ + ÏãúÍ≥ÑÏó¥)
            let attributesHtml = '';
            
            // 3D ÏÜçÏÑ± Î∂ÑÌè¨ Í∑∏ÎûòÌîÑ HTML Ï∂îÍ∞Ä (DJ Ïπ¥ÌÖåÍ≥†Î¶¨Îßå)
            if (category === 'DJ' && preprocessedData && preprocessedData.categoryAttributes && preprocessedData.categoryAttributes[category]) {
                attributesHtml += `
                    <div id="attribute3DChart" style="margin-top: 30px; margin-bottom: 30px; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.2);">
                        <h4 style="color: rgba(255, 255, 255, 0.95); margin-bottom: 20px; font-weight: 600; font-size: 1.3em;">ÏÜçÏÑ±Î≥Ñ ÌåêÎß§ Î∂ÑÌè¨ (3D)</h4>
                        <div id="plotly3DChart" style="width: 100%; height: 600px; background: rgba(0, 0, 0, 0.1);"></div>
                    </div>
                `;
            }
            const attributeNames = {
                'Ï§ëÎüâÍ∞ê': 'Ï§ëÎüâÍ∞êÎ≥Ñ ÌåêÎß§ Î∂ÑÏÑù',
                'Ìïè1': 'Ìïè1Î≥Ñ ÌåêÎß§ Î∂ÑÏÑù',
                'Ìïè2': 'Ìïè2Î≥Ñ ÌåêÎß§ Î∂ÑÏÑù',
                'Í∏∞Îä•ÏÑ±': 'Í∏∞Îä•ÏÑ±Î≥Ñ ÌåêÎß§ Î∂ÑÏÑù',
                'Í∏∞Ïû•': 'Í∏∞Ïû•Î≥Ñ ÌåêÎß§ Î∂ÑÏÑù',
                'Ï∂©Ï†ÑÏû¨': 'Ï∂©Ï†ÑÏû¨Î≥Ñ ÌåêÎß§ Î∂ÑÏÑù',
                'ÏÜåÏû¨ÌÉÄÏûÖ': 'ÏÜåÏû¨ÌÉÄÏûÖÎ≥Ñ ÌåêÎß§ Î∂ÑÏÑù',
                'ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº': 'ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùºÎ≥Ñ ÌåêÎß§ Î∂ÑÏÑù'
            };
            
            let chartIndex = 0;
            Object.keys(attributes).forEach(attrName => {
                const attrData = attributes[attrName];
                const values = Object.keys(attrData);
                
                if (values.length === 0) return;
                
                // Îç∞Ïù¥ÌÑ∞ Ï†ïÎ†¨ (ÌåêÎß§Ïï° Í∏∞Ï§Ä)
                const sortedValues = values.sort((a, b) => 
                    attrData[b].salesTotal - attrData[a].salesTotal
                );
                
                const labels = sortedValues;
                const salesData = sortedValues.map(v => Math.round(attrData[v].salesTotal / 1000000));
                const counts = sortedValues.map(v => attrData[v].count);
                
                const barChartId = `chart_bar_${category}_${attrName}`;
                
                // ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÏãúÏ¶å Ï∞æÍ∏∞
                const availableSeasons = new Set();
                Object.keys(attrData).forEach(attrValue => {
                    const timeSeries = attrData[attrValue].timeSeries || {};
                    Object.keys(timeSeries).forEach(season => {
                        if (Object.keys(timeSeries[season]).length > 0) {
                            availableSeasons.add(season);
                        }
                    });
                });
                const seasons = Array.from(availableSeasons).sort();
                
                // ÏãúÍ≥ÑÏó¥ Ï∞®Ìä∏ HTML ÏÉùÏÑ±
                let timeSeriesHtml = '';
                if (seasons.length > 0) {
                    const colsPerRow = Math.min(2, seasons.length);
                    timeSeriesHtml = `
                        <div style="margin-top: 30px;">
                            <h4 style="color: rgba(255, 255, 255, 0.95); margin-bottom: 20px; font-weight: 600; font-size: 1.2em;">Ï£ºÏ∞®Î≥Ñ ÌåêÎß§ Ï∂îÏù¥ (Îã®ÏúÑ: Î∞±ÎßåÏõê)</h4>
                            <div style="display: grid; grid-template-columns: repeat(${colsPerRow}, 1fr); gap: 25px;">
                                ${seasons.sort((a, b) => {
                                    if (a === '25F') return -1;
                                    if (b === '25F') return 1;
                                    return a.localeCompare(b);
                                }).map(season => {
                                    const timeSeriesChartId = `chart_ts_${category}_${attrName}_${season}`;
                                    const rangeText = (season === '24F' || season === '25F') ? ' (24~10Ï£º)' : '';
                                    return `
                                <div>
                                            <h5 style="color: rgba(255, 255, 255, 0.95); margin-bottom: 12px; font-weight: 600; font-size: 1.1em;">${season} ÏãúÏ¶å${rangeText}</h5>
                                    <div class="chart-wrapper" style="height: 300px; background: rgba(255, 255, 255, 0.02); border-radius: 12px; padding: 15px;">
                                                <canvas id="${timeSeriesChartId}"></canvas>
                                    </div>
                                </div>
                                    `;
                                }).join('')}
                                    </div>
                                </div>
                    `;
                }
                
                attributesHtml += `
                    <div class="chart-container" style="margin-bottom: 50px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 20px; padding: 30px; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);">
                        <div class="chart-title" style="font-size: 1.5em; margin-bottom: 25px; color: #ffffff; font-weight: 700; letter-spacing: 0.5px;">${attributeNames[attrName] || attrName}</div>
                        
                        <div style="margin-bottom: 30px;">
                            <h4 style="color: rgba(255, 255, 255, 0.95); margin-bottom: 15px; font-weight: 600; font-size: 1.2em;">Ï†ÑÏ≤¥ ÌåêÎß§ ÏßëÍ≥Ñ</h4>
                            <div class="chart-wrapper" style="height: 350px; background: rgba(255, 255, 255, 0.02); border-radius: 12px; padding: 15px;">
                                <canvas id="${barChartId}"></canvas>
                            </div>
                        </div>
                        ${timeSeriesHtml}
                    </div>
                `;
                
                // Ï∞®Ìä∏ ÏÉùÏÑ± (ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ)
                setTimeout(() => {
                    createAttributeChart(barChartId, labels, salesData, counts, attrName);
                    seasons.forEach(season => {
                        const timeSeriesChartId = `chart_ts_${category}_${attrName}_${season}`;
                        createAttributeTimeSeriesChart(timeSeriesChartId, category, attrName, season, attrData);
                    });
                }, 100 * chartIndex);
                chartIndex++;
            });
            
            if (attributesDiv) {
                attributesDiv.innerHTML = attributesHtml;
                
                // 3D Í∑∏ÎûòÌîÑ ÏÉùÏÑ± (DJ Ïπ¥ÌÖåÍ≥†Î¶¨Îßå, HTMLÏù¥ Ï∂îÍ∞ÄÎêú ÌõÑ)
                if (category === 'DJ' && preprocessedData && preprocessedData.categoryAttributes && preprocessedData.categoryAttributes[category]) {
                    setTimeout(() => {
                        console.log('3D Í∑∏ÎûòÌîÑ ÏÉùÏÑ± ÏãúÏûë...');
                        create3DAttributeChart(category, attributesDiv);
                    }, 300);
                }
            }
            
            // AI Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏÉùÏÑ± (ÏãúÍ≥ÑÏó¥ Îç∞Ïù¥ÌÑ∞ Ìè¨Ìï®)
            if (insightsDiv) generateAIInsightsWithTimeSeries(category, attributes, insightsDiv);
        }
        
        // ÏÜçÏÑ±Î≥Ñ Ï∞®Ìä∏ ÏÉùÏÑ±
        function createAttributeChart(canvasId, labels, salesData, counts, attrName) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            charts[canvasId] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ÌåêÎß§Ïï° (Î∞±ÎßåÏõê)',
                        data: salesData,
                        backgroundColor: 'rgba(168, 181, 255, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 12, 41, 0.95)',
                            titleColor: 'rgba(255, 255, 255, 0.9)',
                            bodyColor: 'rgba(255, 255, 255, 0.8)',
                            borderColor: 'rgba(102, 126, 234, 0.5)',
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                afterLabel: function(context) {
                                    const index = context.dataIndex;
                                    return `ÌåêÎß§ Í±¥Ïàò: ${counts[index].toLocaleString()}Í±¥`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.9)',
                                font: {
                                    size: 12,
                                    weight: 600
                                },
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.15)',
                                lineWidth: 1
                            },
                            title: {
                                display: true,
                                text: 'ÌåêÎß§Ïï° (Î∞±ÎßåÏõê)',
                                color: 'rgba(255, 255, 255, 0.95)',
                                font: {
                                    size: 14,
                                    weight: 700
                                }
                            }
                        },
                        x: {
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.9)',
                                font: {
                                    size: 12,
                                    weight: 600
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            title: {
                                display: true,
                                text: attrName,
                                color: 'rgba(255, 255, 255, 0.95)',
                                font: {
                                    size: 14,
                                    weight: 700
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // ÏÜçÏÑ±Î≥Ñ ÏãúÍ≥ÑÏó¥ Ï∞®Ìä∏ ÏÉùÏÑ±
        function createAttributeTimeSeriesChart(canvasId, category, attrName, season, attrData) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            // Í∞Å ÏÜçÏÑ±Í∞íÎ≥Ñ ÏãúÍ≥ÑÏó¥ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            const datasets = [];
            const allWeeks = new Set();
            const colors = [
                'rgba(102, 126, 234, 1)',   // ÌååÎûÄÏÉâ
                'rgba(76, 175, 80, 1)',    // Ï¥àÎ°ùÏÉâ
                'rgba(255, 152, 0, 1)',    // Ï£ºÌô©ÏÉâ
                'rgba(156, 39, 176, 1)',   // Î≥¥ÎùºÏÉâ
                'rgba(244, 67, 54, 1)',    // Îπ®Í∞ÑÏÉâ
                'rgba(0, 188, 212, 1)',    // Ï≤≠Î°ùÏÉâ
                'rgba(255, 193, 7, 1)',    // ÎÖ∏ÎûÄÏÉâ
                'rgba(121, 85, 72, 1)'     // Í∞àÏÉâ
            ];
            
            // ÏãúÏ¶åÎ≥Ñ Ï£ºÏ∞® Î≤îÏúÑ ÏÑ§Ï†ï
            let startYear, startWeek, endYear, endWeek;
            if (season === '24F') {
                startYear = 24;
                startWeek = 24;
                endYear = 25;
                endWeek = 10;
            } else if (season === '25F') {
                startYear = 25;
                startWeek = 24;
                endYear = 26;
                endWeek = 10;
            }
            
            let colorIndex = 0;
            Object.keys(attrData).forEach(attrValue => {
                const timeSeries = attrData[attrValue].timeSeries?.[season] || {};
                // ÏãúÏ¶åÎ≥Ñ Î≤îÏúÑÏóê ÎßûÎäî Ï£ºÏ∞®Îßå ÌïÑÌÑ∞ÎßÅ
                const weeks = Object.keys(timeSeries).filter(weekKey => {
                    if (season !== '24F' && season !== '25F') return true;
                    const match = weekKey.match(/(\d+)W(\d+)/);
                    if (!match) return false;
                    const year = parseInt(match[1]);
                    const week = parseInt(match[2]);
                    if (season === '24F') {
                        return (year === 24 && week >= 24) || (year === 25 && week <= 10);
                    } else if (season === '25F') {
                        return (year === 25 && week >= 24) || (year === 26 && week <= 10);
                    }
                    return false;
                }).sort((a, b) => {
                    const matchA = a.match(/(\d+)W(\d+)/);
                    const matchB = b.match(/(\d+)W(\d+)/);
                    if (!matchA || !matchB) return 0;
                    const yearA = parseInt(matchA[1]);
                    const weekA = parseInt(matchA[2]);
                    const yearB = parseInt(matchB[1]);
                    const weekB = parseInt(matchB[2]);
                    const fullYearA = yearA < 100 ? 2000 + yearA : yearA;
                    const fullYearB = yearB < 100 ? 2000 + yearB : yearB;
                    const sortKeyA = getWeekSortKey(fullYearA, weekA);
                    const sortKeyB = getWeekSortKey(fullYearB, weekB);
                    return sortKeyA - sortKeyB;
                });
                
                weeks.forEach(week => allWeeks.add(week));
                
                const salesData = weeks.map(week => {
                    const weekData = timeSeries[week];
                    return Math.round((weekData?.salesTotal || 0) / 1000000);
                });
                
                if (salesData.length > 0 && salesData.some(v => v > 0)) {
                    datasets.push({
                        label: attrValue,
                        data: salesData,
                        borderColor: colors[colorIndex % colors.length],
                        backgroundColor: colors[colorIndex % colors.length].replace('1)', '0.1)'),
                        tension: 0.4,
                        fill: false,
                        borderWidth: 2
                    });
                    colorIndex++;
                }
            });
            
            if (datasets.length === 0) {
                ctx.parentElement.parentElement.style.display = 'none';
                return;
            }
            
            // Î™®Îì† Ï£ºÏ∞® Ï†ïÎ†¨ (ÏãúÏ¶åÎ≥Ñ Î≤îÏúÑÏóê ÎßûÍ≤å)
            let sortedWeeks = Array.from(allWeeks);
            
            // ÏãúÏ¶åÎ≥Ñ Î≤îÏúÑÏóê ÎßûÎäî Îπà Ï£ºÏ∞® Ï±ÑÏö∞Í∏∞
            if (season === '24F' || season === '25F') {
                const weekSet = new Set(sortedWeeks);
                if (season === '24F') {
                    for (let week = 24; week <= 52; week++) {
                        const weekKey = `24W${week.toString().padStart(2, '0')}`;
                        if (!weekSet.has(weekKey)) {
                            sortedWeeks.push(weekKey);
                        }
                    }
                    for (let week = 1; week <= 10; week++) {
                        const weekKey = `25W${week.toString().padStart(2, '0')}`;
                        if (!weekSet.has(weekKey)) {
                            sortedWeeks.push(weekKey);
                        }
                    }
                } else if (season === '25F') {
                    for (let week = 24; week <= 52; week++) {
                        const weekKey = `25W${week.toString().padStart(2, '0')}`;
                        if (!weekSet.has(weekKey)) {
                            sortedWeeks.push(weekKey);
                        }
                    }
                    for (let week = 1; week <= 10; week++) {
                        const weekKey = `26W${week.toString().padStart(2, '0')}`;
                        if (!weekSet.has(weekKey)) {
                            sortedWeeks.push(weekKey);
                        }
                    }
                }
            }
            
            sortedWeeks = sortedWeeks.sort((a, b) => {
                const matchA = a.match(/(\d+)W(\d+)/);
                const matchB = b.match(/(\d+)W(\d+)/);
                if (!matchA || !matchB) return 0;
                const yearA = parseInt(matchA[1]);
                const weekA = parseInt(matchA[2]);
                const yearB = parseInt(matchB[1]);
                const weekB = parseInt(matchB[2]);
                const fullYearA = yearA < 100 ? 2000 + yearA : yearA;
                const fullYearB = yearB < 100 ? 2000 + yearB : yearB;
                const sortKeyA = getWeekSortKey(fullYearA, weekA);
                const sortKeyB = getWeekSortKey(fullYearB, weekB);
                return sortKeyA - sortKeyB;
            });
            
            // ÏãúÏ¶åÎ≥Ñ Î≤îÏúÑ ÌïÑÌÑ∞ÎßÅ (ÏïàÏ†ÑÏû•Ïπò)
            if (season === '24F' || season === '25F') {
                sortedWeeks = sortedWeeks.filter(weekKey => {
                    const match = weekKey.match(/(\d+)W(\d+)/);
                    if (!match) return false;
                    const year = parseInt(match[1]);
                    const week = parseInt(match[2]);
                    if (season === '24F') {
                        return (year === 24 && week >= 24) || (year === 25 && week <= 10);
                    } else if (season === '25F') {
                        return (year === 25 && week >= 24) || (year === 26 && week <= 10);
                    }
                    return true;
                });
            }
            
            const weekLabels = sortedWeeks.map(week => {
                const match = week.match(/(\d+)W(\d+)/);
                if (match) return match[2];
                return week;
            });
            
            // Í∞Å Îç∞Ïù¥ÌÑ∞ÏÖãÏùò Ï£ºÏ∞®Ïóê ÎßûÏ∂∞ Îç∞Ïù¥ÌÑ∞ Ï†ïÎ†¨
            datasets.forEach(dataset => {
                const newData = sortedWeeks.map(week => {
                    const weekData = attrData[dataset.label]?.timeSeries?.[season]?.[week];
                    return weekData ? Math.round(weekData.salesTotal / 1000000) : 0;
                });
                dataset.data = newData;
            });
            
            charts[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weekLabels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toLocaleString() + ' (Î∞±ÎßåÏõê)';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.8)',
                                font: {
                                    size: 12,
                                    weight: 500
                                },
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            title: {
                                display: true,
                                text: 'ÌåêÎß§Ïï° (Î∞±ÎßåÏõê)',
                                color: 'rgba(255, 255, 255, 0.9)',
                                font: {
                                    size: 14,
                                    weight: 600
                                }
                            }
                        },
                        x: {
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.8)',
                                font: {
                                    size: 12,
                                    weight: 500
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            title: {
                                display: true,
                                text: 'Ï£ºÏ∞®',
                                color: 'rgba(255, 255, 255, 0.9)',
                                font: {
                                    size: 14,
                                    weight: 600
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: 'rgba(255, 255, 255, 0.9)',
                                font: {
                                    size: 12,
                                    weight: 600
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 12, 41, 0.95)',
                            titleColor: 'rgba(255, 255, 255, 0.9)',
                            bodyColor: 'rgba(255, 255, 255, 0.8)',
                            borderColor: 'rgba(102, 126, 234, 0.5)',
                            borderWidth: 1
                        }
                    }
                }
            });
        }
        
        // AI Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏÉùÏÑ± (ÏãúÍ≥ÑÏó¥ Îç∞Ïù¥ÌÑ∞ Ìè¨Ìï®)
        function generateAIInsightsWithTimeSeries(category, attributes, insightsDiv) {
            let insights = [];
            
            // Í∞Å ÏÜçÏÑ±Î≥ÑÎ°ú Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏÉùÏÑ±
            Object.keys(attributes).forEach(attrName => {
                const attrData = attributes[attrName];
                const values = Object.keys(attrData);
                
                if (values.length === 0) return;
                
                // ÌåêÎß§Ïï° Í∏∞Ï§Ä Ï†ïÎ†¨
                const sorted = values.sort((a, b) => 
                    attrData[b].salesTotal - attrData[a].salesTotal
                );
                
                const topValue = sorted[0];
                const topSales = attrData[topValue].salesTotal;
                const totalSales = values.reduce((sum, v) => sum + attrData[v].salesTotal, 0);
                const topRatio = (topSales / totalSales * 100).toFixed(1);
                
                // ÏãúÍ≥ÑÏó¥ Ï∂îÏù¥ Î∂ÑÏÑù
                let timeSeriesInsight = '';
                const topTimeSeries24F = attrData[topValue].timeSeries?.['24F'] || {};
                const topTimeSeries25F = attrData[topValue].timeSeries?.['25F'] || {};
                
                const weeks24F = Object.keys(topTimeSeries24F);
                const weeks25F = Object.keys(topTimeSeries25F);
                
                if (weeks24F.length > 0 || weeks25F.length > 0) {
                    const avg24F = weeks24F.length > 0 
                        ? Object.values(topTimeSeries24F).reduce((sum, d) => sum + (d.salesTotal || 0), 0) / weeks24F.length 
                        : 0;
                    const avg25F = weeks25F.length > 0 
                        ? Object.values(topTimeSeries25F).reduce((sum, d) => sum + (d.salesTotal || 0), 0) / weeks25F.length 
                        : 0;
                    
                    if (avg25F > 0 && avg24F > 0) {
                        const growth = ((avg25F - avg24F) / avg24F * 100).toFixed(1);
                        if (parseFloat(growth) > 0) {
                            timeSeriesInsight = ` ÏãúÍ≥ÑÏó¥ Ï∂îÏù¥ Î∂ÑÏÑù Í≤∞Í≥º, ${topValue} Ï†úÌíàÏùò 25F ÏãúÏ¶å ÌèâÍ∑† ÌåêÎß§Í∞Ä 24F ÎåÄÎπÑ ${growth}% Ï¶ùÍ∞ÄÌïòÏó¨ ÏÑ±Ïû•ÏÑ∏Î•º Î≥¥Ïù¥Í≥† ÏûàÏäµÎãàÎã§.`;
                        } else {
                            timeSeriesInsight = ` ÏãúÍ≥ÑÏó¥ Ï∂îÏù¥ Î∂ÑÏÑù Í≤∞Í≥º, ${topValue} Ï†úÌíàÏùò 25F ÏãúÏ¶å ÌåêÎß§Í∞Ä 24F ÎåÄÎπÑ ${Math.abs(parseFloat(growth))}% Í∞êÏÜåÌñàÏäµÎãàÎã§.`;
                        }
                    } else if (avg25F > 0) {
                        timeSeriesInsight = ` ÏãúÍ≥ÑÏó¥ Ï∂îÏù¥ Î∂ÑÏÑù Í≤∞Í≥º, ${topValue} Ï†úÌíàÏù¥ 25F ÏãúÏ¶åÏóê ÏÉàÎ°≠Í≤å Îì±Ïû•ÌïòÏó¨ ÌåêÎß§Î•º ÏãúÏûëÌñàÏäµÎãàÎã§.`;
                    }
                }
                
                // Ïù∏ÏÇ¨Ïù¥Ìä∏ Î©îÏãúÏßÄ ÏÉùÏÑ±
                let insight = '';
                if (attrName === 'Ï§ëÎüâÍ∞ê') {
                    insight = `üí° <strong>Ï§ëÎüâÍ∞ê Î∂ÑÏÑù:</strong> ${topValue} Ï†úÌíàÏù¥ Ï†ÑÏ≤¥ ÌåêÎß§Ïùò ${topRatio}%Î•º Ï∞®ÏßÄÌïòÎ©∞ Í∞ÄÏû• ÎÜíÏùÄ ÌåêÎß§ Ïã§Ï†ÅÏùÑ Î≥¥ÏûÖÎãàÎã§.${timeSeriesInsight} Í≥†Í∞ùÎì§ÏùÄ ${topValue} Ï†úÌíàÏùÑ ÏÑ†Ìò∏ÌïòÎäî Í≤ΩÌñ•Ïù¥ ÏûàÏäµÎãàÎã§.`;
                } else if (attrName === 'Í∏∞Îä•ÏÑ±') {
                    insight = `üí° <strong>Í∏∞Îä•ÏÑ± Î∂ÑÏÑù:</strong> ${topValue} Ï†úÌíàÏù¥ Ï£ºÎèÑÏ†ÅÏù∏ ÌåêÎß§Î•º Î≥¥Ïù¥Í≥† ÏûàÏäµÎãàÎã§.${timeSeriesInsight} Í∏∞Îä•ÏÑ±Ïóê ÎåÄÌïú Í≥†Í∞ù ÏÑ†Ìò∏ÎèÑÍ∞Ä Î™ÖÌôïÌïòÍ≤å ÎÇòÌÉÄÎÇòÍ≥† ÏûàÏäµÎãàÎã§.`;
                } else if (attrName === 'Ìïè1' || attrName === 'Ìïè2') {
                    insight = `üí° <strong>Ìïè Î∂ÑÏÑù:</strong> ${topValue} ÌïèÏù¥ Í∞ÄÏû• Ïù∏Í∏∞ ÏûàÎäî Ïä§ÌÉÄÏùºÎ°ú, Ï†ÑÏ≤¥ ÌåêÎß§Ïùò ${topRatio}%Î•º Ï∞®ÏßÄÌï©ÎãàÎã§.${timeSeriesInsight} Ïù¥ Ìïè Ïä§ÌÉÄÏùºÏóê ÎåÄÌïú Í≥†Í∞ù ÎßåÏ°±ÎèÑÍ∞Ä ÎÜíÏùÄ Í≤ÉÏúºÎ°ú Î≥¥ÏûÖÎãàÎã§.`;
                } else if (attrName === 'Í∏∞Ïû•') {
                    insight = `üí° <strong>Í∏∞Ïû• Î∂ÑÏÑù:</strong> ${topValue} Í∏∞Ïû• Ï†úÌíàÏù¥ Í∞ÄÏû• ÏÑ†Ìò∏ÎêòÎ©∞,${timeSeriesInsight} ÏãúÏû• Ìä∏Î†åÎìúÎ•º Î∞òÏòÅÌïòÍ≥† ÏûàÏäµÎãàÎã§.`;
                } else if (attrName === 'Ï∂©Ï†ÑÏû¨') {
                    insight = `üí° <strong>Ï∂©Ï†ÑÏû¨ Î∂ÑÏÑù:</strong> ${topValue} Ï∂©Ï†ÑÏû¨Î•º ÏÇ¨Ïö©Ìïú Ï†úÌíàÏù¥ ${topRatio}%Ïùò ÌåêÎß§ Ï†êÏú†Ïú®ÏùÑ Î≥¥Ïù¥Î©∞,${timeSeriesInsight} Í≥†Í∞ùÎì§Ïù¥ ÏÑ†Ìò∏ÌïòÎäî Ï∂©Ï†ÑÏû¨ Ïú†ÌòïÏûÖÎãàÎã§.`;
                } else if (attrName === 'ÏÜåÏû¨ÌÉÄÏûÖ') {
                    insight = `üí° <strong>ÏÜåÏû¨ Î∂ÑÏÑù:</strong> ${topValue} ÏÜåÏû¨Í∞Ä Ï£ºÎèÑÏ†ÅÏù∏ ÌåêÎß§Î•º Î≥¥Ïù¥Í≥† ÏûàÏñ¥,${timeSeriesInsight} ÏÜåÏû¨Ïóê ÎåÄÌïú Í≥†Í∞ù ÏÑ†Ìò∏ÎèÑÍ∞Ä Î™ÖÌôïÌï©ÎãàÎã§.`;
                } else if (attrName === 'ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº') {
                    insight = `üí° <strong>ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº Î∂ÑÏÑù:</strong> ${topValue} Ïä§ÌÉÄÏùºÏù¥ Í∞ÄÏû• ÎÜíÏùÄ ÌåêÎß§Î•º Í∏∞Î°ùÌïòÎ©∞,${timeSeriesInsight} ÌÉÄÍ≤ü Í≥†Í∞ùÏ∏µÏùò ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùºÏùÑ Ïûò Î∞òÏòÅÌïòÍ≥† ÏûàÏäµÎãàÎã§.`;
                } else {
                    insight = `üí° <strong>${attrName} Î∂ÑÏÑù:</strong> ${topValue}Í∞Ä Í∞ÄÏû• ÎÜíÏùÄ ÌåêÎß§ Ïã§Ï†Å(${topRatio}%)ÏùÑ Î≥¥Ïù¥Î©∞,${timeSeriesInsight} Ïù¥ ÏÜçÏÑ±Ïù¥ Í≥†Í∞ù ÏÑ†ÌÉùÏóê Ï§ëÏöîÌïú ÏöîÏÜåÏûÑÏùÑ ÏãúÏÇ¨Ìï©ÎãàÎã§.`;
                }
                
                insights.push(insight);
            });
            
            // Ï∂îÍ∞Ä Ï¢ÖÌï© Ïù∏ÏÇ¨Ïù¥Ìä∏
            if (insights.length > 0) {
                insights.push(`<br><strong>üìä Ï¢ÖÌï© Î∂ÑÏÑù:</strong> ${category} Ïπ¥ÌÖåÍ≥†Î¶¨Ïùò Îã§ÏñëÌïú ÏÜçÏÑ± Î∂ÑÏÑù Í≤∞Í≥º, Í≥†Í∞ù ÏÑ†Ìò∏ÎèÑÍ∞Ä Î™ÖÌôïÌïòÍ≤å Íµ¨Î∂ÑÎê©ÎãàÎã§. ÏãúÍ≥ÑÏó¥ Ï∂îÏù¥Î•º ÌÜµÌï¥ Í∞Å ÏÜçÏÑ±Î≥Ñ ÌåêÎß§ Ìå®ÌÑ¥Ïùò Î≥ÄÌôîÎ•º ÌôïÏù∏Ìï† Ïàò ÏûàÏúºÎ©∞, Ïù¥Î•º Î∞îÌÉïÏúºÎ°ú Ï†úÌíà Í∞úÎ∞úÍ≥º ÎßàÏºÄÌåÖ Ï†ÑÎûµÏùÑ ÏàòÎ¶ΩÌïòÎäî Í≤ÉÏùÑ Í∂åÏû•Ìï©ÎãàÎã§.`);
            }
            
            insightsDiv.innerHTML = insights.join('<br><br>');
        }
        
        // Ï£ºÎ≤àÌò∏Î•º Ïà´ÏûêÎ°ú Î≥ÄÌôò (24W24 -> 24, 25W10 -> 10)
        function formatWeekForDisplay(year, week) {
            const yearNum = parseInt(year) || 0;
            const weekNum = parseInt(week) || 0;
            const yearShort = yearNum >= 2000 ? yearNum % 100 : yearNum;
            
            // Ï£ºÏ∞®Îßå Ïà´ÏûêÎ°ú ÌëúÏãú (24, 25, ..., 52, 1, 2, ..., 10)
            return weekNum.toString();
        }
        
        // Ï£ºÎ≤àÌò∏ Ï†ïÎ†¨ÏùÑ ÏúÑÌïú ÌÇ§ ÏÉùÏÑ±
        function getWeekSortKey(year, week) {
            const yearNum = parseInt(year) || 0;
            const weekNum = parseInt(week) || 0;
            const yearShort = yearNum >= 2000 ? yearNum % 100 : yearNum;
            
            // 24ÎÖÑÏùÄ Í∑∏ÎåÄÎ°ú, 25ÎÖÑÏùÄ +52Î°ú Î≥ÄÌôò, 26ÎÖÑÏùÄ +104Î°ú Î≥ÄÌôòÌïòÏó¨ Ï†ïÎ†¨
            if (yearShort === 24) {
                return weekNum;
            } else if (yearShort === 25) {
                return 52 + weekNum; // 25ÎÖÑ 1Ï£º = 53, 25ÎÖÑ 52Ï£º = 104
            } else if (yearShort === 26) {
                return 104 + weekNum; // 26ÎÖÑ 1Ï£º = 105, 26ÎÖÑ 10Ï£º = 114
            }
            return 0;
        }
        
        // Í∏àÏï°ÏùÑ Î∞±ÎßåÏõê Îã®ÏúÑÎ°ú Î∞òÏò¨Î¶ºÌïòÍ≥† Ï≤úÎã®ÏúÑ Íµ¨Î∂ÑÏûê Ï∂îÍ∞Ä (78880000 -> 79, 2000 -> 2,000)
        function formatSalesAmount(amount) {
            const rounded = Math.round(amount / 1000000);
            return rounded.toLocaleString();
        }
        
        function formatQuantity(quantity) {
            return Math.round(quantity).toLocaleString();
        }
        
        // TOP5 Î¶¨Ïä§Ìä∏ ÌÜ†Í∏Ä Ìï®Ïàò
        function toggleTop5List(listId, buttonId) {
            const listElement = document.getElementById(listId);
            if (!listElement) return;
            
            const button = document.getElementById(buttonId);
            
            if (listElement.style.display === 'none' || listElement.style.display === '') {
                listElement.style.display = 'block';
                if (button) {
                    button.textContent = 'üìã Î™©Î°ù Îã´Í∏∞';
                }
            } else {
                listElement.style.display = 'none';
                if (button) {
                    button.textContent = 'üìã Î™©Î°ù Î≥¥Í∏∞';
                }
            }
        }
        
        // 3D Í∑∏ÎûòÌîÑ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò (ÏÜçÏÑ± ÏÑ†ÌÉùÏóê Îî∞Îùº)
        function update3DChart() {
            const category = document.getElementById('categorySelect').value;
            if (!category) {
                alert('Ïπ¥ÌÖåÍ≥†Î¶¨Î•º Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const axisX = document.getElementById('axisXSelect').value;
            const axisY = document.getElementById('axisYSelect').value;
            const axisZ = document.getElementById('axisZSelect').value;
            
            if (axisX === axisY || axisY === axisZ || axisX === axisZ) {
                alert('Í∞Å Ï∂ïÏùÄ ÏÑúÎ°ú Îã§Î•∏ ÏÜçÏÑ±ÏùÑ ÏÑ†ÌÉùÌï¥Ïïº Ìï©ÎãàÎã§.');
                return;
            }
            
            console.log('3D Í∑∏ÎûòÌîÑ ÏÉùÏÑ± ÏãúÏûë:', { category, axisX, axisY, axisZ });
            
            // 3D Í∑∏ÎûòÌîÑ Ïª®ÌÖåÏù¥ÎÑà HTML ÏÉùÏÑ±
            const attributesDiv = document.getElementById('categoryAttributes');
            if (!attributesDiv) {
                console.error('categoryAttributes divÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            // Í∏∞Ï°¥ 3D Í∑∏ÎûòÌîÑ Ï†úÍ±∞
            const existing3D = document.getElementById('attribute3DChart');
            if (existing3D) existing3D.remove();
            
            // 3D Í∑∏ÎûòÌîÑ HTML Ï∂îÍ∞Ä (Î°úÎî© Î©îÏãúÏßÄ Ìè¨Ìï®)
            const chartHtml = `
                <div id="attribute3DChart" style="margin-top: 30px; margin-bottom: 30px; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.2);">
                    <h4 style="color: rgba(255, 255, 255, 0.95); margin-bottom: 20px; font-weight: 600; font-size: 1.3em;">ÏÜçÏÑ±Î≥Ñ ÌåêÎß§ Î∂ÑÌè¨ (3D) - ${axisX} / ${axisY} / ${axisZ}</h4>
                    <div id="plotly3DChart" style="width: 100%; height: 600px; background: rgba(0, 0, 0, 0.1); position: relative;">
                        <div id="plotly3DLoading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: rgba(255, 255, 255, 0.7); font-size: 1.1em; z-index: 10;">Í∑∏ÎûòÌîÑ ÏÉùÏÑ± Ï§ë...</div>
                    </div>
                </div>
            `;
            attributesDiv.insertAdjacentHTML('afterbegin', chartHtml);
            
            // ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ Í∑∏ÎûòÌîÑ ÏÉùÏÑ± (DOM ÏóÖÎç∞Ïù¥Ìä∏ ÎåÄÍ∏∞)
            setTimeout(() => {
                const plotlyDiv = document.getElementById('plotly3DChart');
                if (plotlyDiv) {
                    create3DAttributeChart(category, plotlyDiv, axisX, axisY, axisZ);
                } else {
                    console.error('plotly3DChart divÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                }
            }, 100);
        }
        
        // 3D ÏÜçÏÑ± Î∂ÑÌè¨ Í∑∏ÎûòÌîÑ ÏÉùÏÑ± Ìï®Ïàò (ÎèôÏ†Å ÏÜçÏÑ± ÏßÄÏõê)
        function create3DAttributeChart(category, containerDiv, axisXAttr = 'ÏÑ±Î≥Ñ', axisYAttr = 'Ï§ëÎüâÍ∞ê', axisZAttr = 'ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº') {
            console.log('create3DAttributeChart Ìò∏Ï∂úÎê®:', category, axisXAttr, axisYAttr, axisZAttr);
            
            if (!containerDiv) {
                console.error('containerDivÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            if (!preprocessedData) {
                console.error('preprocessedDataÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                containerDiv.innerHTML = '<div style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 20px;">Îç∞Ïù¥ÌÑ∞Í∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.</div>';
                return;
            }
            
            if (!preprocessedData.categoryAttributes || !preprocessedData.categoryAttributes[category]) {
                console.error('categoryAttributesÍ∞Ä ÏóÜÏäµÎãàÎã§:', { 
                    hasCategoryAttributes: !!preprocessedData.categoryAttributes,
                    category: category,
                    availableCategories: preprocessedData.categoryAttributes ? Object.keys(preprocessedData.categoryAttributes) : []
                });
                containerDiv.innerHTML = '<div style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 20px;">Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÜçÏÑ± Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }
            
            const attributes = preprocessedData.categoryAttributes[category];
            console.log('ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÏÜçÏÑ±:', Object.keys(attributes));
            
            // ÏÑ†ÌÉùÌïú ÏÜçÏÑ±Ïùò Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏ (ÎåÄÏ≤¥ Ïù¥Î¶ÑÎèÑ ÌôïÏù∏)
            let attrX = attributes[axisXAttr] || {};
            let attrY = attributes[axisYAttr] || {};
            let attrZ = attributes[axisZAttr] || {};
            
            // ÏÜçÏÑ± Ïù¥Î¶ÑÏù¥ Îã§Î•º Ïàò ÏûàÏúºÎØÄÎ°ú ÎåÄÏ≤¥ Ïù¥Î¶ÑÎèÑ ÌôïÏù∏
            if (Object.keys(attrX).length === 0) {
                if (axisXAttr === 'Ìïè1') attrX = attributes['Ìïè'] || {};
                else if (axisXAttr === 'Ìïè') attrX = attributes['Ìïè1'] || {};
            }
            if (Object.keys(attrY).length === 0) {
                if (axisYAttr === 'Ìïè1') attrY = attributes['Ìïè'] || {};
                else if (axisYAttr === 'Ìïè') attrY = attributes['Ìïè1'] || {};
            }
            if (Object.keys(attrZ).length === 0) {
                if (axisZAttr === 'Ìïè1') attrZ = attributes['Ìïè'] || {};
                else if (axisZAttr === 'Ìïè') attrZ = attributes['Ìïè1'] || {};
            }
            
            console.log('ÏÑ†ÌÉùÌïú ÏÜçÏÑ± Îç∞Ïù¥ÌÑ∞:', {
                [axisXAttr]: Object.keys(attrX).length,
                [axisYAttr]: Object.keys(attrY).length,
                [axisZAttr]: Object.keys(attrZ).length,
                availableAttributes: Object.keys(attributes)
            });
            
            if (Object.keys(attrX).length === 0 || Object.keys(attrY).length === 0 || Object.keys(attrZ).length === 0) {
                const missingAttrs = [];
                if (Object.keys(attrX).length === 0) missingAttrs.push(axisXAttr);
                if (Object.keys(attrY).length === 0) missingAttrs.push(axisYAttr);
                if (Object.keys(attrZ).length === 0) missingAttrs.push(axisZAttr);
                
                console.warn('ÏÑ†ÌÉùÌïú ÏÜçÏÑ±Ïóê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§:', missingAttrs, 'ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÏÜçÏÑ±:', Object.keys(attributes));
                containerDiv.innerHTML = `<div style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 20px;">ÏÑ†ÌÉùÌïú ÏÜçÏÑ± (${missingAttrs.join(', ')})Ïóê ÎåÄÌïú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. Îã§Î•∏ ÏÜçÏÑ±ÏùÑ ÏÑ†ÌÉùÌï¥Î≥¥ÏÑ∏Ïöî.</div>`;
                return;
            }
            
            // ÏÜçÏÑ± Í∞í ÏàòÏßë
            const xValues = Object.keys(attrX).filter(k => k && k !== 'nan' && k !== '').sort();
            const yValues = Object.keys(attrY).filter(k => k && k !== 'nan' && k !== '').sort();
            const zValues = Object.keys(attrZ).filter(k => k && k !== 'nan' && k !== '').sort();
            
            // ÏÜçÏÑ± Í∞íÏóê Ïù∏Îç±Ïä§ Îß§Ìïë
            const xIndexMap = {};
            xValues.forEach((val, idx) => { xIndexMap[val] = idx; });
            const yIndexMap = {};
            yValues.forEach((val, idx) => { yIndexMap[val] = idx; });
            const zIndexMap = {};
            zValues.forEach((val, idx) => { zIndexMap[val] = idx; });
            
            // categoryStylecodesÏóêÏÑú ÏÜçÏÑ± Ï°∞Ìï©Î≥Ñ Îç∞Ïù¥ÌÑ∞ Í≥ÑÏÇ∞
            const stylecodes = preprocessedData.categoryStylecodes && preprocessedData.categoryStylecodes[category] ? preprocessedData.categoryStylecodes[category] : {};
            console.log('Ïä§ÌÉÄÏùºÏΩîÎìú Îç∞Ïù¥ÌÑ∞:', Object.keys(stylecodes).length, 'Í∞ú');
            
            const combinationData = {}; // Ï°∞Ìï©Î≥Ñ ÏßëÍ≥Ñ Îç∞Ïù¥ÌÑ∞
            let processedCount = 0;
            let validCombinationCount = 0;
            
            Object.keys(stylecodes).forEach(stylecode => {
                processedCount++;
                const styleData = stylecodes[stylecode];
                const styleAttrs = styleData.attributes || {};
                
                // ÏÜçÏÑ± Í∞í Ï∂îÏ∂ú (Îã§ÏñëÌïú ÌòïÏãù ÏßÄÏõê)
                let xVal = String(styleAttrs[axisXAttr] || '').trim();
                let yVal = String(styleAttrs[axisYAttr] || '').trim();
                let zVal = String(styleAttrs[axisZAttr] || '').trim();
                
                // ÏÜçÏÑ± Ïù¥Î¶ÑÏù¥ Îã§Î•º Ïàò ÏûàÏúºÎØÄÎ°ú ÎåÄÏ≤¥ Ïù¥Î¶ÑÎèÑ ÌôïÏù∏
                if (!xVal || xVal === 'nan' || xVal === '') {
                    if (axisXAttr === 'Ìïè1') {
                        xVal = String(styleAttrs['Ìïè'] || styleAttrs['Ìïè1'] || '').trim();
                    }
                }
                if (!yVal || yVal === 'nan' || yVal === '') {
                    if (axisYAttr === 'Ìïè1') {
                        yVal = String(styleAttrs['Ìïè'] || styleAttrs['Ìïè1'] || '').trim();
                    }
                }
                if (!zVal || zVal === 'nan' || zVal === '') {
                    if (axisZAttr === 'Ìïè1') {
                        zVal = String(styleAttrs['Ìïè'] || styleAttrs['Ìïè1'] || '').trim();
                    }
                }
                
                if (xVal && xVal !== 'nan' && xVal !== '' && 
                    yVal && yVal !== 'nan' && yVal !== '' && 
                    zVal && zVal !== 'nan' && zVal !== '') {
                    
                    const comboKey = `${xVal}|${yVal}|${zVal}`;
                    if (!combinationData[comboKey]) {
                        combinationData[comboKey] = {
                            salesTotal: 0,
                            quantityTotal: 0,
                            styles: []
                        };
                    }
                    
                    // 25F ÏãúÏ¶å Îç∞Ïù¥ÌÑ∞Îßå ÏßëÍ≥Ñ (24F Ï†úÏô∏)
                    let sales25F = 0;
                    let qty25F = 0;
                    if (styleData.timeSeries && styleData.timeSeries['25F']) {
                        Object.values(styleData.timeSeries['25F']).forEach(weekData => {
                            sales25F += weekData.salesTotal || 0;
                            qty25F += weekData.quantityTotal || 0;
                        });
                    }
                    
                    // 25F Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Ìï¥Îãπ Ï°∞Ìï© Ï†úÏô∏ (24F Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö© Ïïà Ìï®)
                    if (sales25F === 0) {
                        return; // 25F Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Ïù¥ Ïä§ÌÉÄÏùºÏùÄ Ï†úÏô∏
                    }
                    
                    combinationData[comboKey].salesTotal += sales25F;
                    combinationData[comboKey].quantityTotal += qty25F;
                    combinationData[comboKey].styles.push({
                        stylecode: stylecode,
                        productName: styleAttrs['Ï†úÌíàÎ™Ö'] || '',
                        salesTotal: sales25F,
                        quantityTotal: qty25F
                    });
                    validCombinationCount++;
                }
            });
            
            console.log('ÏÜçÏÑ± Ï°∞Ìï© Í≥ÑÏÇ∞ ÏôÑÎ£å:', {
                processedStyles: processedCount,
                validCombinations: validCombinationCount,
                uniqueCombinations: Object.keys(combinationData).length,
                sampleCombinations: Object.keys(combinationData).slice(0, 5),
                xValues: xValues,
                yValues: yValues,
                zValues: zValues
            });
            
            // Ï°∞Ìï© Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ ÏÉòÌîå ÏÜçÏÑ± Í∞í ÌôïÏù∏
            if (Object.keys(combinationData).length === 0 && processedCount > 0) {
                console.warn('Ï°∞Ìï© Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÏÉòÌîå ÏÜçÏÑ± ÌôïÏù∏:', {
                    sampleStylecode: Object.keys(stylecodes)[0],
                    sampleAttributes: stylecodes[Object.keys(stylecodes)[0]]?.attributes || {},
                    requestedAttrs: { x: axisXAttr, y: axisYAttr, z: axisZAttr }
                });
            }
            
            console.log('ÏÜçÏÑ± Ï°∞Ìï© Í≥ÑÏÇ∞ ÏôÑÎ£å:', {
                processedStyles: processedCount,
                validCombinations: validCombinationCount,
                uniqueCombinations: Object.keys(combinationData).length,
                xValues: xValues,
                yValues: yValues,
                zValues: zValues,
                sampleCombinations: Object.keys(combinationData).slice(0, 5)
            });
            
            // Ï°∞Ìï© Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ ÏÉòÌîå ÏÜçÏÑ± Í∞í ÌôïÏù∏
            if (Object.keys(combinationData).length === 0 && processedCount > 0) {
                const sampleStylecode = Object.keys(stylecodes)[0];
                const sampleAttrs = stylecodes[sampleStylecode]?.attributes || {};
                console.warn('Ï°∞Ìï© Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÏÉòÌîå ÏÜçÏÑ± ÌôïÏù∏:', {
                    sampleStylecode: sampleStylecode,
                    sampleAttributes: sampleAttrs,
                    requestedAttrs: { x: axisXAttr, y: axisYAttr, z: axisZAttr },
                    xVal: sampleAttrs[axisXAttr],
                    yVal: sampleAttrs[axisYAttr],
                    zVal: sampleAttrs[axisZAttr]
                });
            }
            
            // 3D Í∑∏ÎûòÌîÑ Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ
            const x = [];
            const y = [];
            const z = [];
            const text = [];
            const sizes = [];
            const salesValues = [];
            const pointCombinationMap = [];
            
            // ÏµúÎåÄ ÌåêÎß§Ïï° Í≥ÑÏÇ∞
            let maxSales = 0;
            Object.values(combinationData).forEach(combo => {
                if (combo.salesTotal > maxSales) maxSales = combo.salesTotal;
            });
            
            // Í∞Å Ï°∞Ìï©Î≥ÑÎ°ú Îç∞Ïù¥ÌÑ∞ Ìè¨Ïù∏Ìä∏ ÏÉùÏÑ±
            Object.keys(combinationData).forEach(comboKey => {
                const combo = combinationData[comboKey];
                const parts = comboKey.split('|');
                if (parts.length !== 3) return;
                
                const xVal = parts[0];
                const yVal = parts[1];
                const zVal = parts[2];
                
                // ÏÜçÏÑ± Í∞í Îß§Ïπ≠ (ÎåÄÏÜåÎ¨∏Ïûê, Í≥µÎ∞± Î¨¥Ïãú)
                const findIndex = (val, values, indexMap) => {
                    if (indexMap[val] !== undefined) return indexMap[val];
                    // ÎåÄÏÜåÎ¨∏Ïûê Î¨¥Ïãú Îß§Ïπ≠
                    const lowerVal = val.toLowerCase().trim();
                    for (let i = 0; i < values.length; i++) {
                        if (values[i].toLowerCase().trim() === lowerVal) {
                            return i;
                        }
                    }
                    return undefined;
                };
                
                const xIdx = findIndex(xVal, xValues, xIndexMap);
                const yIdx = findIndex(yVal, yValues, yIndexMap);
                const zIdx = findIndex(zVal, zValues, zIndexMap);
                
                if (xIdx !== undefined && yIdx !== undefined && zIdx !== undefined) {
                    const sales = (combo.salesTotal || 0) / 1000000; // Î∞±ÎßåÏõê Îã®ÏúÑ
                    
                    x.push(xIdx);
                    y.push(yIdx);
                    z.push(zIdx);
                    
                    pointCombinationMap.push({
                        [axisXAttr]: xVal,
                        [axisYAttr]: yVal,
                        [axisZAttr]: zVal
                    });
                    
                    text.push(
                        `${axisXAttr}: ${xVal}<br>` +
                        `${axisYAttr}: ${yVal}<br>` +
                        `${axisZAttr}: ${zVal}<br>` +
                        `ÌåêÎß§Ïï°: ${sales.toFixed(1)}Î∞±ÎßåÏõê<br>` +
                        `ÌåêÎß§ÏàòÎüâ: ${formatQuantity(combo.quantityTotal)}Í∞ú`
                    );
                    
                    const sizeRatio = maxSales > 0 ? (combo.salesTotal / maxSales) : 0;
                    sizes.push(Math.max(10, Math.min(50, 10 + sizeRatio * 40)));
                    salesValues.push(sales);
                }
            });
            
            window.pointCombinationMap = pointCombinationMap;
            window.currentAxisAttrs = { x: axisXAttr, y: axisYAttr, z: axisZAttr };
            window.currentCombinationData = combinationData;
            
            // Ï°∞Ìï© Ï†ïÎ≥¥Î•º Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú Ï†ÄÏû• (ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ÏóêÏÑú ÏÇ¨Ïö©)
            window.pointCombinationMap = pointCombinationMap;
            
            console.log('3D Í∑∏ÎûòÌîÑ Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ ÏôÑÎ£å:', { 
                x: x.length, 
                y: y.length, 
                z: z.length,
                combinationCount: Object.keys(combinationData).length,
                xValues: xValues.length,
                yValues: yValues.length,
                zValues: zValues.length
            });
            
            // Îç∞Ïù¥ÌÑ∞ Ìè¨Ïù∏Ìä∏Í∞Ä ÏóÜÏúºÎ©¥ Î©îÏãúÏßÄ ÌëúÏãú
            if (x.length === 0) {
                console.warn('3D Í∑∏ÎûòÌîÑÎ•º ÏÉùÏÑ±Ìï† Îç∞Ïù¥ÌÑ∞ Ìè¨Ïù∏Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§.', {
                    combinationCount: Object.keys(combinationData).length,
                    xValues: xValues,
                    yValues: yValues,
                    zValues: zValues
                });
                if (containerDiv) {
                    containerDiv.innerHTML = '<div style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 20px;">ÏÑ†ÌÉùÌïú ÏÜçÏÑ± Ï°∞Ìï©Ïóê ÎåÄÌïú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. Îã§Î•∏ ÏÜçÏÑ±ÏùÑ ÏÑ†ÌÉùÌï¥Î≥¥ÏÑ∏Ïöî.</div>';
                }
                return;
            }
            
            // 3D Í∑∏ÎûòÌîÑ Ïª®ÌÖåÏù¥ÎÑà Ï∞æÍ∏∞ (Ïù¥ÎØ∏ HTMLÏóê Ï∂îÍ∞ÄÎêòÏñ¥ ÏûàÏùå)
            const graphDiv = document.getElementById('attribute3DChart');
            const plotlyDiv = document.getElementById('plotly3DChart');
            
            if (!graphDiv || !plotlyDiv) {
                console.error('3D Í∑∏ÎûòÌîÑ Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. graphDiv:', !!graphDiv, 'plotlyDiv:', !!plotlyDiv);
                if (containerDiv) {
                    containerDiv.innerHTML = '<div style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 20px;">Í∑∏ÎûòÌîÑ Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.</div>';
                }
                return;
            }
            
            // Î°úÎî© Î©îÏãúÏßÄ Ï†úÍ±∞ (Í∑∏ÎûòÌîÑÍ∞Ä ÏÉùÏÑ±ÎêòÎØÄÎ°ú)
            const loadingDiv = document.getElementById('plotly3DLoading');
            if (loadingDiv) {
                loadingDiv.remove();
            }
            
            // Plotly ÎùºÏù¥Î∏åÎü¨Î¶¨ ÌôïÏù∏
            if (typeof Plotly === 'undefined') {
                console.error('Plotly ÎùºÏù¥Î∏åÎü¨Î¶¨Í∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                plotlyDiv.innerHTML = '<div style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 20px;">Plotly ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }
            
            console.log('Plotly ÎùºÏù¥Î∏åÎü¨Î¶¨ ÌôïÏù∏Îê®, Í∑∏ÎûòÌîÑ ÏÉùÏÑ± ÏãúÏûë...');
            
            // Plotly 3D Scatter Plot ÏÉùÏÑ± (Îçî ÏûÖÏ≤¥Ï†ÅÏúºÎ°ú)
            const trace = {
                x: x,
                y: y,
                z: z,
                mode: 'markers',
                type: 'scatter3d',
                marker: {
                    size: sizes.map(s => s * 0.7), // Ï†ê ÌÅ¨Í∏∞ ÎπÑÏú® Ï§ÑÏûÑ
                    color: salesValues, // ÌåêÎß§Ïï°ÏùÑ ÏÉâÏÉÅ Í∏∞Ï§ÄÏúºÎ°ú ÏÇ¨Ïö©
                    opacity: 0.9,
                    line: {
                        color: 'rgba(255, 255, 255, 1)',
                        width: 4
                    },
                    symbol: 'circle',
                    sizemode: 'diameter',
                    sizeref: 2.0,
                    sizemin: 5,
                    showscale: true,
                    colorbar: {
                        title: {
                            text: 'ÌåêÎß§Ïï° (Î∞±ÎßåÏõê)',
                            font: { color: 'rgba(255, 255, 255, 0.9)', size: 13 }
                        },
                        tickfont: { color: 'rgba(255, 255, 255, 0.8)', size: 11 },
                        thickness: 20,
                        len: 0.6,
                        x: 1.15,
                        xpad: 10
                    },
                    colorscale: [
                        [0, 'rgba(102, 126, 234, 0.85)'],      // ÌååÎûÄÏÉâ (ÎÇÆÏùÄ ÌåêÎß§Ïï°) - Îçî ÏßÑÌïòÍ≤å
                        [0.25, 'rgba(118, 75, 162, 0.88)'],   // Î≥¥ÎùºÏÉâ
                        [0.5, 'rgba(76, 175, 80, 0.9)'],      // Ï¥àÎ°ùÏÉâ
                        [0.75, 'rgba(255, 152, 0, 0.92)'],    // Ï£ºÌô©ÏÉâ
                        [1, 'rgba(244, 67, 54, 0.95)']         // Îπ®Í∞ÑÏÉâ (ÎÜíÏùÄ ÌåêÎß§Ïï°) - Îçî ÏßÑÌïòÍ≤å
                    ],
                    cmin: 0,
                    cmax: maxSales / 1000000,
                    reversescale: false
                },
                text: text,
                hovertemplate: '<b>%{text}</b><extra></extra>'
            };
            
            // ÌåêÎß§Ïï°ÏùÑ ÏÉâÏÉÅ Í∏∞Ï§ÄÏúºÎ°ú ÏÇ¨Ïö© (Ïù¥ÎØ∏ salesValues Î∞∞Ïó¥Ïóê Ï†ÄÏû•Îê®)
            trace.marker.color = salesValues;
            
            const layout = {
                scene: {
                    xaxis: { 
                        title: axisXAttr,
                        titlefont: { color: 'rgba(255, 255, 255, 0.9)', size: 14 },
                        tickfont: { color: 'rgba(255, 255, 255, 0.7)', size: 12 },
                        tickmode: 'array',
                        tickvals: xValues.map((_, idx) => idx),
                        ticktext: xValues,
                        gridcolor: 'rgba(255, 255, 255, 0.15)',
                        gridwidth: 2,
                        backgroundcolor: 'rgba(0, 0, 0, 0)',
                        range: [-0.5, xValues.length - 0.5],
                        showspikes: true,
                        spikecolor: 'rgba(102, 126, 234, 0.6)',
                        spikesides: true,
                        spikethickness: 3,
                        showbackground: false
                    },
                    yaxis: { 
                        title: axisYAttr,
                        titlefont: { color: 'rgba(255, 255, 255, 0.9)', size: 14 },
                        tickfont: { color: 'rgba(255, 255, 255, 0.7)', size: 12 },
                        tickmode: 'array',
                        tickvals: yValues.map((_, idx) => idx),
                        ticktext: yValues,
                        gridcolor: 'rgba(255, 255, 255, 0.15)',
                        gridwidth: 2,
                        backgroundcolor: 'rgba(0, 0, 0, 0)',
                        range: [-0.5, yValues.length - 0.5],
                        showspikes: true,
                        spikecolor: 'rgba(118, 75, 162, 0.6)',
                        spikesides: true,
                        spikethickness: 3,
                        showbackground: false
                    },
                    zaxis: { 
                        title: axisZAttr,
                        titlefont: { color: 'rgba(255, 255, 255, 0.9)', size: 14 },
                        tickfont: { color: 'rgba(255, 255, 255, 0.7)', size: 12 },
                        tickmode: 'array',
                        tickvals: zValues.map((_, idx) => idx),
                        ticktext: zValues,
                        gridcolor: 'rgba(255, 255, 255, 0.15)',
                        gridwidth: 2,
                        backgroundcolor: 'rgba(0, 0, 0, 0)',
                        range: [-0.5, zValues.length - 0.5],
                        showspikes: true,
                        spikecolor: 'rgba(76, 175, 80, 0.6)',
                        spikesides: true,
                        spikethickness: 3,
                        showbackground: false
                    },
                    bgcolor: 'rgba(0, 0, 0, 0)',
                    camera: {
                        eye: { x: 1.5, y: 1.5, z: 1.5 },
                        center: { x: 0, y: 0, z: 0 },
                        up: { x: 0, y: 0, z: 1 }
                    },
                    aspectmode: 'cube',
                    dragmode: 'orbit',
                    lighting: {
                        ambient: 0.6,
                        diffuse: 0.8,
                        specular: 0.3,
                        roughness: 0.4,
                        fresnel: 0.2
                    }
                },
                paper_bgcolor: 'rgba(0, 0, 0, 0)',
                plot_bgcolor: 'rgba(0, 0, 0, 0)',
                font: {
                    color: 'rgba(255, 255, 255, 0.9)'
                },
                margin: { l: 0, r: 0, t: 0, b: 0 }
            };
            
            const config = {
                responsive: true,
                displayModeBar: true,
                displaylogo: false,
                modeBarButtonsToRemove: ['pan2d', 'lasso2d'],
                toImageButtonOptions: {
                    format: 'png',
                    filename: '3d_attribute_chart',
                    height: 600,
                    width: 1000,
                    scale: 1
                }
            };
            
            try {
                Plotly.newPlot('plotly3DChart', [trace], layout, config).then(() => {
                    console.log('3D Í∑∏ÎûòÌîÑ ÏÉùÏÑ± ÏôÑÎ£å!');
                    
                    // Î°úÎî© Î©îÏãúÏßÄ Ï†úÍ±∞
                    const loadingDiv = document.getElementById('plotly3DLoading');
                    if (loadingDiv) {
                        loadingDiv.remove();
                    }
                    
                    // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä (Plotly Ïù¥Î≤§Ìä∏ ÏãúÏä§ÌÖú ÏÇ¨Ïö©)
                    const plotlyDiv = document.getElementById('plotly3DChart');
                    if (plotlyDiv) {
                        plotlyDiv.on('plotly_click', function(data) {
                            if (data.points && data.points.length > 0 && window.pointCombinationMap && window.currentAxisAttrs && window.currentCombinationData) {
                                const point = data.points[0];
                                const pointIndex = point.pointNumber;
                                
                                if (pointIndex >= 0 && pointIndex < window.pointCombinationMap.length) {
                                    const combination = window.pointCombinationMap[pointIndex];
                                    const attrs = window.currentAxisAttrs;
                                    
                                    console.log('ÌÅ¥Î¶≠Îêú ÏÜçÏÑ± Ï°∞Ìï©:', combination);
                                    
                                    // Ï°∞Ìï© ÌÇ§ ÏÉùÏÑ±
                                    const comboKey = `${combination[attrs.x]}|${combination[attrs.y]}|${combination[attrs.z]}`;
                                    const comboData = window.currentCombinationData[comboKey];
                                    
                                    if (comboData && comboData.styles) {
                                        const matchingStyles = comboData.styles.map(style => ({
                                            stylecode: style.stylecode,
                                            productName: style.productName || '',
                                            salesTotal: style.salesTotal || 0,
                                            quantityTotal: style.quantityTotal || 0
                                        }))
                                        .sort((a, b) => (b.salesTotal || 0) - (a.salesTotal || 0)); // ÌåêÎß§Í∏àÏï° ÎÇ¥Î¶ºÏ∞®Ïàú Ï†ïÎ†¨
                                        
                                        showStyleListModal(
                                            category, 
                                            `${attrs.x}: ${combination[attrs.x]}`, 
                                            `${attrs.y}: ${combination[attrs.y]}`, 
                                            `${attrs.z}: ${combination[attrs.z]}`,
                                            matchingStyles
                                        );
                                    }
                                }
                            }
                        });
                    }
                }).catch(err => {
                    console.error('3D Í∑∏ÎûòÌîÑ ÏÉùÏÑ± Ïò§Î•ò:', err);
                });
            } catch (error) {
                console.error('Plotly.newPlot Ïò§Î•ò:', error);
            }
        }
        
        // ÏÜçÏÑ± Ï°∞Ìï©Ïóê Ìï¥ÎãπÌïòÎäî Ïä§ÌÉÄÏùº Î¶¨Ïä§Ìä∏ ÌëúÏãú Ìï®Ïàò
        function showStylesForAttributeCombination(category, gender, weight, lifestyle) {
            if (!preprocessedData || !preprocessedData.categoryAttributeCombinations || !preprocessedData.categoryAttributeCombinations[category]) {
                console.error('ÏÜçÏÑ± Ï°∞Ìï© Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            const combinations = preprocessedData.categoryAttributeCombinations[category];
            const combination_key = `${gender}|${weight}|${lifestyle}`;
            
            // Ï†ÑÏ≤òÎ¶¨Îêú Ï°∞Ìï© Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Ïä§ÌÉÄÏùº Î¶¨Ïä§Ìä∏ Í∞ÄÏ†∏Ïò§Í∏∞
            const combination = combinations[combination_key];
            
            if (!combination || !combination.styles || combination.styles.length === 0) {
                console.warn('Ìï¥Îãπ ÏÜçÏÑ± Ï°∞Ìï©Ïóê ÏùºÏπòÌïòÎäî Ïä§ÌÉÄÏùºÏù¥ ÏóÜÏäµÎãàÎã§:', combination_key);
                showStyleListModal(category, gender, weight, lifestyle, []);
                return;
            }
            
            // Ïä§ÌÉÄÏùº Î¶¨Ïä§Ìä∏ ÏÉùÏÑ± Î∞è ÌåêÎß§Í∏àÏï° ÎÇ¥Î¶ºÏ∞®Ïàú Ï†ïÎ†¨
            const matchingStyles = combination.styles.map(style => ({
                stylecode: style.stylecode,
                productName: style.productName || '',
                salesTotal: style.salesTotal || 0,
                quantityTotal: style.quantityTotal || 0
            }))
            .sort((a, b) => (b.salesTotal || 0) - (a.salesTotal || 0)); // ÌåêÎß§Í∏àÏï° ÎÇ¥Î¶ºÏ∞®Ïàú Ï†ïÎ†¨
            
            // Î™®Îã¨ ÌëúÏãú
            showStyleListModal(category, gender, weight, lifestyle, matchingStyles);
        }
        
        // Ïä§ÌÉÄÏùº Î¶¨Ïä§Ìä∏ Î™®Îã¨ ÌëúÏãú Ìï®Ïàò
        function showStyleListModal(category, gender, weight, lifestyle, styles) {
            // Í∏∞Ï°¥ Î™®Îã¨Ïù¥ ÏûàÏúºÎ©¥ Ï†úÍ±∞
            const existingModal = document.getElementById('styleListModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Î™®Îã¨ ÏÉùÏÑ±
            const modal = document.createElement('div');
            modal.id = 'styleListModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                backdrop-filter: blur(5px);
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, rgba(30, 30, 50, 0.95), rgba(40, 40, 60, 0.95));
                border-radius: 20px;
                padding: 30px;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                border: 2px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            `;
            
            const header = document.createElement('div');
            header.style.cssText = `
                margin-bottom: 20px;
                padding-bottom: 15px;
                border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            `;
            
            const title = document.createElement('h3');
            title.style.cssText = `
                color: rgba(255, 255, 255, 0.95);
                margin: 0 0 10px 0;
                font-size: 1.5em;
                font-weight: 600;
            `;
            title.textContent = `${category} - ÏÜçÏÑ± Ï°∞Ìï© Ïä§ÌÉÄÏùº Î¶¨Ïä§Ìä∏`;
            
            const attributes = document.createElement('div');
            attributes.style.cssText = `
                color: rgba(255, 255, 255, 0.8);
                font-size: 0.95em;
                margin-top: 5px;
            `;
            attributes.innerHTML = `
                <strong>ÏÑ±Î≥Ñ:</strong> ${gender || '-'} | 
                <strong>Ï§ëÎüâÍ∞ê:</strong> ${weight || '-'} | 
                <strong>ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº:</strong> ${lifestyle || '-'}
            `;
            
            header.appendChild(title);
            header.appendChild(attributes);
            
            const closeBtn = document.createElement('button');
            closeBtn.textContent = '‚úï';
            closeBtn.style.cssText = `
                position: absolute;
                top: 15px;
                right: 15px;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.3);
                color: rgba(255, 255, 255, 0.9);
                width: 35px;
                height: 35px;
                border-radius: 50%;
                cursor: pointer;
                font-size: 18px;
                transition: all 0.3s;
            `;
            closeBtn.onmouseover = () => {
                closeBtn.style.background = 'rgba(255, 255, 255, 0.2)';
            };
            closeBtn.onmouseout = () => {
                closeBtn.style.background = 'rgba(255, 255, 255, 0.1)';
            };
            closeBtn.onclick = () => {
                modal.remove();
            };
            
            modalContent.style.position = 'relative';
            modalContent.appendChild(closeBtn);
            modalContent.appendChild(header);
            
            if (styles.length === 0) {
                const noData = document.createElement('div');
                noData.style.cssText = `
                    color: rgba(255, 255, 255, 0.6);
                    text-align: center;
                    padding: 40px 20px;
                    font-size: 1.1em;
                `;
                noData.textContent = 'Ìï¥Îãπ ÏÜçÏÑ± Ï°∞Ìï©Ïóê ÏùºÏπòÌïòÎäî Ïä§ÌÉÄÏùºÏù¥ ÏóÜÏäµÎãàÎã§.';
                modalContent.appendChild(noData);
            } else {
                const count = document.createElement('div');
                count.style.cssText = `
                    color: rgba(255, 255, 255, 0.7);
                    margin-bottom: 15px;
                    font-size: 0.9em;
                `;
                count.textContent = `Ï¥ù ${styles.length}Í∞úÏùò Ïä§ÌÉÄÏùºÏù¥ ÏûàÏäµÎãàÎã§.`;
                modalContent.appendChild(count);
                
                const list = document.createElement('div');
                styles.forEach((style, idx) => {
                    const item = document.createElement('div');
                    item.style.cssText = `
                        background: rgba(255, 255, 255, 0.05);
                        border: 1px solid rgba(255, 255, 255, 0.1);
                        border-radius: 10px;
                        padding: 15px;
                        margin-bottom: 10px;
                        transition: all 0.3s;
                    `;
                    item.onmouseover = () => {
                        item.style.background = 'rgba(255, 255, 255, 0.1)';
                        item.style.borderColor = 'rgba(255, 255, 255, 0.3)';
                    };
                    item.onmouseout = () => {
                        item.style.background = 'rgba(255, 255, 255, 0.05)';
                        item.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                    };
                    
                    const stylecodeDiv = document.createElement('div');
                    stylecodeDiv.style.cssText = `
                        color: rgba(255, 255, 255, 0.95);
                        font-weight: 600;
                        font-size: 1.1em;
                        margin-bottom: 8px;
                    `;
                    stylecodeDiv.textContent = `${idx + 1}. ${style.stylecode}`;
                    
                    const productNameDiv = document.createElement('div');
                    productNameDiv.style.cssText = `
                        color: rgba(255, 255, 255, 0.8);
                        font-size: 0.95em;
                        margin-bottom: 8px;
                    `;
                    productNameDiv.textContent = `Ï†úÌíàÎ™Ö: ${style.productName || '-'}`;
                    
                    const salesDiv = document.createElement('div');
                    salesDiv.style.cssText = `
                        color: rgba(255, 255, 255, 0.7);
                        font-size: 0.9em;
                        display: flex;
                        gap: 20px;
                    `;
                    // ÌåêÎß§Ïï°ÏùÑ Ïõê Îã®ÏúÑÎ°ú ÌëúÏãú (ÎßåÏõê Îã®ÏúÑÎ°ú Î≥ÄÌôò)
                    const salesInManwon = Math.round(style.salesTotal / 10000);
                    salesDiv.innerHTML = `
                        <span>ÌåêÎß§Ïï°: <strong>${salesInManwon.toLocaleString()}</strong>ÎßåÏõê</span>
                        <span>ÌåêÎß§ÏàòÎüâ: <strong>${formatQuantity(style.quantityTotal)}</strong>Í∞ú</span>
                    `;
                    
                    item.appendChild(stylecodeDiv);
                    item.appendChild(productNameDiv);
                    item.appendChild(salesDiv);
                    list.appendChild(item);
                });
                modalContent.appendChild(list);
            }
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };
        }
        
        // Ïä§ÌÉÄÏùº Ïù∏ÏÇ¨Ïù¥Ìä∏ ÌëúÏãú Ìï®Ïàò
        function showStyleInsight(category, type, contentId) {
            const insightContent = document.getElementById(contentId);
            if (!insightContent || !window.top5Data || !preprocessedData.categoryStylecodes) {
                return;
            }
            
            // Ïù¥ÎØ∏ ÌëúÏãúÎêòÏñ¥ ÏûàÏúºÎ©¥ Ïà®Í∏∞Í∏∞, ÏïÑÎãàÎ©¥ ÌëúÏãúÌïòÍ∏∞
            if (insightContent.style.display === 'block') {
                insightContent.style.display = 'none';
                return;
            }
            
            const top5List = window.top5Data[type] || [];
            if (top5List.length === 0) {
                insightContent.innerHTML = '<div style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 20px;">Î∂ÑÏÑùÌï† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
                insightContent.style.display = 'block';
                return;
            }
            
            // Ïó¨Îü¨ Í∞úÏùò AI Î∂ÑÏÑùÏùÑ ÎèôÏãúÏóê Î≥º Ïàò ÏûàÎèÑÎ°ù Îã§Î•∏ Ïù∏ÏÇ¨Ïù¥Ìä∏ Î∞ïÏä§Îäî Ïà®Í∏∞ÏßÄ ÏïäÏùå
            
            // TOP5 ÌíàÎ≤àÎì§Ïùò ÏÜçÏÑ± Î∂ÑÏÑù
            const stylecodes = preprocessedData.categoryStylecodes[category] || {};
            const attributeAnalysis = {
                'Ï§ëÎüâÍ∞ê': {},
                'Ìïè1': {},
                'Ìïè2': {},
                'Í∏∞Îä•ÏÑ±': {},
                'Í∏∞Ïû•': {},
                'Ï∂©Ï†ÑÏû¨': {},
                'ÏÜåÏû¨ÌÉÄÏûÖ': {},
                'ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº': {}
            };
            
            let totalSales = 0;
            top5List.forEach(item => {
                const stylecodeData = stylecodes[item.stylecode];
                if (stylecodeData && stylecodeData.attributes) {
                    totalSales += item.salesTotal;
                    const attrs = stylecodeData.attributes;
                    
                    Object.keys(attributeAnalysis).forEach(attrName => {
                        const attrValue = attrs[attrName];
                        if (attrValue && attrValue !== 'nan' && attrValue !== '' && attrValue !== 'N/A') {
                            if (!attributeAnalysis[attrName][attrValue]) {
                                attributeAnalysis[attrName][attrValue] = {
                                    count: 0,
                                    salesTotal: 0,
                                    stylecodes: []
                                };
                            }
                            attributeAnalysis[attrName][attrValue].count += 1;
                            attributeAnalysis[attrName][attrValue].salesTotal += item.salesTotal;
                            if (!attributeAnalysis[attrName][attrValue].stylecodes.includes(item.stylecode)) {
                                attributeAnalysis[attrName][attrValue].stylecodes.push(item.stylecode);
                            }
                        }
                    });
                }
            });
            
            // Í∞Å ÏÜçÏÑ±Î≥ÑÎ°ú TOP Í∞í Ï∞æÍ∏∞
            const insights = [];
            const typeNames = {
                'cumulative25F': '25F ÎàÑÏ†Å ÌåêÎß§ TOP5',
                'cumulative24F': '24F ÎàÑÏ†Å ÌåêÎß§ TOP5',
                'weekly25F': '25F ÏµúÍ∑º Ï£ºÍ∞Ñ ÌåêÎß§ TOP5',
                'weekly24F': '24F ÎèôÏùº Ï£ºÍ∞Ñ ÌåêÎß§ TOP5'
            };
            
            Object.keys(attributeAnalysis).forEach(attrName => {
                const attrData = attributeAnalysis[attrName];
                const sortedAttrs = Object.keys(attrData)
                    .map(key => ({ value: key, ...attrData[key] }))
                    .sort((a, b) => b.count - a.count || b.salesTotal - a.salesTotal);
                
                if (sortedAttrs.length > 0) {
                    const topAttr = sortedAttrs[0];
                    const percentage = ((topAttr.count / top5List.length) * 100).toFixed(0);
                    insights.push({
                        attribute: attrName,
                        value: topAttr.value,
                        count: topAttr.count,
                        percentage: percentage,
                        salesTotal: topAttr.salesTotal
                    });
                }
            });
            
            // Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏÉùÏÑ±
            const attrNames = {
                'Ï§ëÎüâÍ∞ê': 'Ï§ëÎüâÍ∞ê',
                'Ìïè1': 'Ìïè1',
                'Ìïè2': 'Ìïè2',
                'Í∏∞Îä•ÏÑ±': 'Í∏∞Îä•ÏÑ±',
                'Í∏∞Ïû•': 'Í∏∞Ïû•',
                'Ï∂©Ï†ÑÏû¨': 'Ï∂©Ï†ÑÏû¨',
                'ÏÜåÏû¨ÌÉÄÏûÖ': 'ÏÜåÏû¨',
                'ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº': 'ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº'
            };
            
            let insightHtml = `
                <div style="margin-bottom: 25px;">
                    <h5 style="color: rgba(255, 255, 255, 0.95); margin-bottom: 15px; font-weight: 600; font-size: 1.3em;">${typeNames[type]} Ïä§ÌÉÄÏùº Î∂ÑÏÑù</h5>
                    <div style="background: rgba(255, 255, 255, 0.02); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h6 style="color: rgba(255, 255, 255, 0.9); margin-bottom: 12px; font-weight: 600;">Ï£ºÏöî ÏÜçÏÑ± Î∂ÑÏÑù</h6>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                            ${insights.map(insight => `
                                <div style="padding: 12px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; border-left: 3px solid rgba(102, 126, 234, 0.8);">
                                    <div style="font-size: 0.85em; color: rgba(255, 255, 255, 0.7); margin-bottom: 4px;">${attrNames[insight.attribute] || insight.attribute}</div>
                                    <div style="font-weight: 600; color: rgba(255, 255, 255, 0.9);">${insight.value}</div>
                                    <div style="font-size: 0.8em; color: rgba(255, 255, 255, 0.6); margin-top: 4px;">${insight.count}Í∞ú ÌíàÎ≤à (${insight.percentage}%)</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15)); border-radius: 12px; padding: 20px; border-left: 4px solid rgba(102, 126, 234, 0.8);">
                        <h6 style="color: rgba(255, 255, 255, 0.95); margin-bottom: 12px; font-weight: 600; font-size: 1.1em;">üìä Í∏∞Ìöç Î∞©Ìñ• Ï†úÏïà</h6>
                        <ul style="line-height: 1.8; color: rgba(255, 255, 255, 0.85); padding-left: 20px; margin: 0;">
                            ${insights.filter(i => i.percentage >= 40).map(insight => {
                                const recommendations = {
                                    'Ï§ëÎüâÍ∞ê': `Ï§ëÎüâÍ∞ê "${insight.value}" Ïä§ÌÉÄÏùºÏù¥ ${insight.percentage}%Î•º Ï∞®ÏßÄÌïòÎØÄÎ°ú, Ìï¥Îãπ Ï§ëÎüâÍ∞êÏùÑ Ï§ëÏã¨ÏúºÎ°ú Ïã†Í∑ú ÎùºÏù∏ÏóÖ Í∏∞Ìöç Í∂åÏû•`,
                                    'Ìïè1': `Ìïè "${insight.value}" Ïä§ÌÉÄÏùºÏù¥ ${insight.percentage}%Î•º Ï∞®ÏßÄÌïòÎØÄÎ°ú, Ìï¥Îãπ ÌïèÏùÑ Í∞ïÌôîÌïú Ï†úÌíà Î∞úÏ£º ÌôïÎåÄ Í∂åÏû•`,
                                    'Ìïè2': `Ìïè2 "${insight.value}" Ïä§ÌÉÄÏùºÏù¥ ${insight.percentage}%Î•º Ï∞®ÏßÄÌïòÎØÄÎ°ú, Î≥¥Ï°∞ Ìïè ÌäπÏÑ± Î∞òÏòÅ Í∂åÏû•`,
                                    'Í∏∞Îä•ÏÑ±': `Í∏∞Îä•ÏÑ± "${insight.value}" Ïä§ÌÉÄÏùºÏù¥ ${insight.percentage}%Î•º Ï∞®ÏßÄÌïòÎØÄÎ°ú, Ìï¥Îãπ Í∏∞Îä•ÏÑ±ÏùÑ Í∞ïÌôîÌïú Ï†úÌíà Í∞úÎ∞ú Í∂åÏû•`,
                                    'Í∏∞Ïû•': `Í∏∞Ïû• "${insight.value}" Ïä§ÌÉÄÏùºÏù¥ ${insight.percentage}%Î•º Ï∞®ÏßÄÌïòÎØÄÎ°ú, Ìï¥Îãπ Í∏∞Ïû• Ï§ëÏã¨Ïùò ÎùºÏù∏ÏóÖ ÌôïÏû• Í∂åÏû•`,
                                    'Ï∂©Ï†ÑÏû¨': `Ï∂©Ï†ÑÏû¨ "${insight.value}" Ïä§ÌÉÄÏùºÏù¥ ${insight.percentage}%Î•º Ï∞®ÏßÄÌïòÎØÄÎ°ú, Ìï¥Îãπ Ï∂©Ï†ÑÏû¨Î•º ÌôúÏö©Ìïú Ïã†Í∑ú Ï†úÌíà Í∏∞Ìöç Í∂åÏû•`,
                                    'ÏÜåÏû¨ÌÉÄÏûÖ': `ÏÜåÏû¨ "${insight.value}" Ïä§ÌÉÄÏùºÏù¥ ${insight.percentage}%Î•º Ï∞®ÏßÄÌïòÎØÄÎ°ú, Ìï¥Îãπ ÏÜåÏû¨ Ï§ëÏã¨Ïùò Ï†úÌíà Î∞úÏ£º ÌôïÎåÄ Í∂åÏû•`,
                                    'ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº': `ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº "${insight.value}" Ïä§ÌÉÄÏùºÏù¥ ${insight.percentage}%Î•º Ï∞®ÏßÄÌïòÎØÄÎ°ú, Ìï¥Îãπ ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº ÌÉÄÍ≤ü Ï†úÌíà Í∏∞Ìöç Í∂åÏû•`
                                };
                                return `<li>${recommendations[insight.attribute] || `${insight.attribute} "${insight.value}" Ï§ëÏã¨ Í∏∞Ìöç Í∂åÏû•`}</li>`;
                            }).join('')}
                            ${insights.filter(i => i.percentage >= 40).length === 0 ? '<li>TOP5 ÌíàÎ≤àÎì§Ïùò ÏÜçÏÑ±Ïù¥ Îã§ÏñëÌïòÏó¨, Í∞Å ÏÜçÏÑ±Î≥Ñ Í∑†ÌòïÏû°Ìûå ÎùºÏù∏ÏóÖ Íµ¨ÏÑ± Í∂åÏû•</li>' : ''}
                        </ul>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(56, 142, 60, 0.15)); border-radius: 12px; padding: 20px; margin-top: 15px; border-left: 4px solid rgba(76, 175, 80, 0.8);">
                        <h6 style="color: rgba(255, 255, 255, 0.95); margin-bottom: 12px; font-weight: 600; font-size: 1.1em;">üì¶ Î∞úÏ£º Î∞©Ìñ• Ï†úÏïà</h6>
                        <ul style="line-height: 1.8; color: rgba(255, 255, 255, 0.85); padding-left: 20px; margin: 0;">
                            <li>TOP5 ÌíàÎ≤àÏùò Í≥µÌÜµ ÏÜçÏÑ±ÏùÑ Í∞ÄÏßÑ Ïã†Í∑ú Ïä§ÌÉÄÏùº Î∞úÏ£º Ïö∞ÏÑ† Í≤ÄÌÜ†</li>
                            ${insights.filter(i => i.percentage >= 60).length > 0 ? `<li>ÌäπÌûà ${insights.filter(i => i.percentage >= 60).map(i => `${attrNames[i.attribute] || i.attribute} "${i.value}"`).join(', ')} ÏÜçÏÑ±ÏùÑ Í∞ÄÏßÑ Ïä§ÌÉÄÏùº Î∞úÏ£º ÌôïÎåÄ Í∂åÏû•</li>` : '<li>Îã§ÏñëÌïú ÏÜçÏÑ± Ï°∞Ìï©Ïùò Ïä§ÌÉÄÏùº Î∞úÏ£ºÎ°ú Î¶¨Ïä§ÌÅ¨ Î∂ÑÏÇ∞ Í∂åÏû•</li>'}
                            <li>Ï£ºÍ∞Ñ TOP5ÏôÄ ÎàÑÏ†Å TOP5Ïùò ÏÜçÏÑ± Ï∞®Ïù¥Î•º Î∂ÑÏÑùÌïòÏó¨ Ìä∏Î†åÎìú Î≥ÄÌôî Î∞òÏòÅ</li>
                            <li>Í≥†ÌåêÎß§ ÌíàÎ≤àÏùò ÏÜçÏÑ± Ï°∞Ìï©ÏùÑ Ï∞∏Í≥†ÌïòÏó¨ Ïã†Í∑ú Ïä§ÌÉÄÏùº Í∏∞Ìöç Ïãú ÌôúÏö©</li>
                        </ul>
                    </div>
                </div>
            `;
            
            insightContent.innerHTML = insightHtml;
            insightContent.style.display = 'block';
        }
        
        
        // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ (OUTER, INNER, BOTTOM Í∑∏Î£πÌôî)
        function updateCategoryCharts() {
            // Ï†ÑÏ≤òÎ¶¨Îêú Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©
            if (!preprocessedData || !preprocessedData.categories) {
                console.error('Ï†ÑÏ≤òÎ¶¨Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§!');
                return;
            }
            
            // Ï†ÑÏ≤òÎ¶¨Îêú Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Í∑∏Î£πÎ≥Ñ Ïπ¥ÌÖåÍ≥†Î¶¨ Í∞ÄÏ†∏Ïò§Í∏∞ (ETC Ìè¨Ìï®)
            const groups = {
                'OUTER': preprocessedData.categories.OUTER || [],
                'INNER': preprocessedData.categories.INNER || [],
                'BOTTOM': preprocessedData.categories.BOTTOM || [],
                'ETC': preprocessedData.categories.ETC || []
            };
            
            // Í∑∏Î£πÎ≥Ñ HTML ÏÉùÏÑ±
            const groupNames = {
                'OUTER': 'OUTER (ÏïÑÏö∞ÌÑ∞)',
                'INNER': 'INNER (Ïù¥ÎÑà)',
                'BOTTOM': 'BOTTOM (ÌïòÏùò)',
                'ETC': 'ETC (Í∏∞ÌÉÄ)'
            };
            
            let groupsHtml = '';
            ['OUTER', 'INNER', 'BOTTOM', 'ETC'].forEach(group => {
                const items = groups[group];
                // Í∑∏Î£πÏóê ÏïÑÏù¥ÌÖúÏù¥ ÏóÜÏúºÎ©¥ ÌëúÏãúÌïòÏßÄ ÏïäÏùå
                if (items.length === 0) return;
                
                // Í∑∏Î£πÎ≥Ñ Ï¥ùÌï©ÎèÑ 25F ÏãúÏ¶åÎßå Í≥ÑÏÇ∞
                let totalSales25F = 0;
                let totalDomestic25F = 0;
                let totalDF25F = 0;
                
                items.forEach(itemData => {
                    if (preprocessedData.timeSeries && preprocessedData.timeSeries[itemData.item] && preprocessedData.timeSeries[itemData.item]['25F']) {
                        const weeks25F = preprocessedData.timeSeries[itemData.item]['25F'];
                        Object.keys(weeks25F).forEach(weekKey => {
                            const match = weekKey.match(/(\d+)W(\d+)/);
                            if (match) {
                                const year = parseInt(match[1]);
                                const week = parseInt(match[2]);
                                if ((year === 25 && week >= 24) || (year === 26 && week <= 10)) {
                                    totalSales25F += weeks25F[weekKey].salesTotal || 0;
                                    totalDomestic25F += weeks25F[weekKey].salesDomestic || 0;
                                    totalDF25F += weeks25F[weekKey].salesDF || 0;
                                }
                            }
                        });
                    }
                });
                
                const itemsHtml = items.map(itemData => {
                    // 25F ÏãúÏ¶å Îç∞Ïù¥ÌÑ∞Îßå Í≥ÑÏÇ∞ (25ÎÖÑ 24Ï£º~26ÎÖÑ 10Ï£º)
                    let sales25F = 0;
                    let domestic25F = 0;
                    let df25F = 0;
                    
                    if (preprocessedData.timeSeries && preprocessedData.timeSeries[itemData.item] && preprocessedData.timeSeries[itemData.item]['25F']) {
                        const weeks25F = preprocessedData.timeSeries[itemData.item]['25F'];
                        Object.keys(weeks25F).forEach(weekKey => {
                            const match = weekKey.match(/(\d+)W(\d+)/);
                            if (match) {
                                const year = parseInt(match[1]);
                                const week = parseInt(match[2]);
                                // 25ÎÖÑ 24Ï£º Ïù¥ÏÉÅ ÎòêÎäî 26ÎÖÑ 10Ï£º Ïù¥ÌïòÎßå Ìè¨Ìï®
                                if ((year === 25 && week >= 24) || (year === 26 && week <= 10)) {
                                    sales25F += weeks25F[weekKey].salesTotal || 0;
                                    domestic25F += weeks25F[weekKey].salesDomestic || 0;
                                    df25F += weeks25F[weekKey].salesDF || 0;
                                }
                            }
                        });
                    }
                    
                    // ÎπÑÏ§ë Í≥ÑÏÇ∞
                    const domesticRatio = sales25F > 0 ? ((domestic25F / sales25F) * 100).toFixed(1) : '0.0';
                    const dfRatio = sales25F > 0 ? ((df25F / sales25F) * 100).toFixed(1) : '0.0';
                    
                    return `
                    <div class="category-item-card" onclick="showCategoryTimeSeries('${itemData.item}')">
                        <h4>${itemData.item}</h4>
                        <div class="item-sales">
                            <div class="sales-breakdown">
                                <div class="sales-item">
                                    <span class="sales-label">Ï†ÑÏ≤¥</span>
                                    <span class="sales-value">${formatSalesAmount(sales25F)}</span>
                                </div>
                                <div class="sales-item">
                                    <span class="sales-label">Íµ≠ÎÇ¥</span>
                                    <span class="sales-value">${formatSalesAmount(domestic25F)} <span style="font-size: 0.85em; color: rgba(255, 255, 255, 0.7);">(${domesticRatio}%)</span></span>
                                </div>
                                <div class="sales-item">
                                    <span class="sales-label">D/F</span>
                                    <span class="sales-value">${formatSalesAmount(df25F)} <span style="font-size: 0.85em; color: rgba(255, 255, 255, 0.7);">(${dfRatio}%)</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                }).join('');
                
                groupsHtml += `
                    <div class="category-group" id="group_${group}" data-group="${group}" style="display: none;">
                        <div class="category-group-header" onclick="toggleGroupCollapse('${group}')" style="cursor: pointer;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="collapse-icon" id="icon_${group}" style="font-size: 1.2em; transition: transform 0.3s;">‚ñº</span>
                                <h3 style="margin: 0;">${groupNames[group]}</h3>
                                <span style="font-size: 0.9em; color: rgba(255, 255, 255, 0.8); font-weight: 500;">(${items.length}Í∞ú)</span>
                            </div>
                            <div class="category-group-total">
                                <div style="font-size: 0.8em; color: rgba(255, 255, 255, 0.85); margin-bottom: 8px; text-align: right; font-weight: 600;">Îã®ÏúÑ: Î∞±ÎßåÏõê</div>
                                <div class="total-breakdown">
                                    <div class="total-item">
                                        <span class="label">Ï†ÑÏ≤¥</span>
                                        <span class="value">${formatSalesAmount(totalSales25F)}</span>
                                    </div>
                                    <div class="total-item">
                                        <span class="label">Íµ≠ÎÇ¥</span>
                                        <span class="value">${formatSalesAmount(totalDomestic25F)}</span>
                                    </div>
                                    <div class="total-item">
                                        <span class="label">D/F</span>
                                        <span class="value">${formatSalesAmount(totalDF25F)}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="category-item-list" id="list_${group}">
                            ${itemsHtml}
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('categoryGroups').innerHTML = groupsHtml;
            
            // Í∑∏Î£π ÌïÑÌÑ∞ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî (ETC Ìè¨Ìï®) - Ï≤òÏùåÏóêÎäî Î™®Îëê Ïà®ÍπÄ
            window.groupFilterState = {
                'OUTER': false,
                'INNER': false,
                'BOTTOM': false,
                'ETC': false
            };
        }
        
        // Í∑∏Î£π ÌïÑÌÑ∞ ÌÜ†Í∏Ä
        function toggleGroup(group) {
            if (!window.groupFilterState) {
                window.groupFilterState = {
                    'OUTER': false,
                    'INNER': false,
                    'BOTTOM': false,
                    'ETC': false
                };
            }
            
            window.groupFilterState[group] = !window.groupFilterState[group];
            const btn = document.getElementById(`filter${group}`);
            const groupDiv = document.getElementById(`group_${group}`);
            
            if (window.groupFilterState[group]) {
                btn.style.background = '#667eea';
                btn.style.color = 'white';
                if (groupDiv) {
                    groupDiv.style.display = 'block';
                    // Í∑∏Î£πÏù¥ Î≥¥Ïùº Îïå Ïπ¥ÌÖåÍ≥†Î¶¨ Î¶¨Ïä§Ìä∏ÎèÑ ÌéºÏ≥êÏßÑ ÏÉÅÌÉúÎ°ú
                    const listDiv = document.getElementById(`list_${group}`);
                    if (listDiv) {
                        listDiv.style.display = 'grid';
                    }
                }
            } else {
                btn.style.background = 'white';
                btn.style.color = '#667eea';
                if (groupDiv) groupDiv.style.display = 'none';
            }
        }
        
        // Í∑∏Î£π Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞
        function toggleGroupCollapse(group) {
            const groupDiv = document.getElementById(`group_${group}`);
            const listDiv = document.getElementById(`list_${group}`);
            const icon = document.getElementById(`icon_${group}`);
            const btn = document.getElementById(`filter${group}`);
            
            // Í∑∏Î£πÏù¥ Ïà®Í≤®Ï†∏ ÏûàÏúºÎ©¥ Î®ºÏ†Ä Î≥¥Ïù¥Í≤å Ìï®
            if (groupDiv && groupDiv.style.display === 'none') {
                groupDiv.style.display = 'block';
                if (!window.groupFilterState) {
                    window.groupFilterState = {
                        'OUTER': false,
                        'INNER': false,
                        'BOTTOM': false,
                        'ETC': false
                    };
                }
                window.groupFilterState[group] = true;
                if (btn) {
                    btn.style.background = '#667eea';
                    btn.style.color = 'white';
                }
            }
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨ Î¶¨Ïä§Ìä∏ Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞
            if (listDiv && icon) {
                if (listDiv.style.display === 'none') {
                    listDiv.style.display = 'grid';
                    icon.textContent = '‚ñº';
                    icon.style.transform = 'rotate(0deg)';
                } else {
                    listDiv.style.display = 'none';
                    icon.textContent = '‚ñ∂';
                    icon.style.transform = 'rotate(0deg)';
                }
            }
        }
        
        // Ïπ¥ÌÖåÍ≥†Î¶¨ Í≤ÄÏÉâ ÌïÑÌÑ∞
        function filterCategories() {
            const searchTerm = document.getElementById('categorySearch').value.toLowerCase();
            const allCards = document.querySelectorAll('.category-item-card');
            
            allCards.forEach(card => {
                const categoryName = card.querySelector('h4').textContent.toLowerCase();
                if (categoryName.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = searchTerm === '' ? 'block' : 'none';
                }
            });
            
            // Í≤ÄÏÉâÏñ¥Í∞Ä ÏûàÏúºÎ©¥ Í∑∏Î£π Ìó§ÎçîÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            if (searchTerm) {
                ['OUTER', 'INNER', 'BOTTOM'].forEach(group => {
                    const groupDiv = document.getElementById(`group_${group}`);
                    const visibleCards = groupDiv ? groupDiv.querySelectorAll('.category-item-card[style*="block"], .category-item-card:not([style*="none"])').length : 0;
                    const totalCards = groupDiv ? groupDiv.querySelectorAll('.category-item-card').length : 0;
                    
                    if (groupDiv && visibleCards === 0 && totalCards > 0) {
                        groupDiv.style.opacity = '0.5';
                    } else if (groupDiv) {
                        groupDiv.style.opacity = '1';
                    }
                });
            } else {
                ['OUTER', 'INNER', 'BOTTOM'].forEach(group => {
                    const groupDiv = document.getElementById(`group_${group}`);
                    if (groupDiv) groupDiv.style.opacity = '1';
                });
            }
        }
        
        // Ïπ¥ÌÖåÍ≥†Î¶¨ ÌÅ¥Î¶≠ Ïãú ÏãúÍ≥ÑÏó¥ Ï∞®Ìä∏ ÌëúÏãú (Î™®Îì† ÏãúÏ¶å ÏßÄÏõê)
        function showCategoryTimeSeries(category) {
            // Ï†ÑÏ≤òÎ¶¨Îêú Îç∞Ïù¥ÌÑ∞ÏóêÏÑú ÏãúÍ≥ÑÏó¥ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
            if (!preprocessedData || !preprocessedData.timeSeries || !preprocessedData.timeSeries[category]) {
                alert('Ìï¥Îãπ Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê ÎåÄÌïú ÏãúÍ≥ÑÏó¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            const categoryTimeSeries = preprocessedData.timeSeries[category];
            // 25FÎ•º Î®ºÏ†Ä, Í∑∏ Îã§Ïùå Îã§Î•∏ ÏãúÏ¶åÎì§
            const allSeasons = Object.keys(categoryTimeSeries);
            const seasons = allSeasons.sort((a, b) => {
                if (a === '25F') return -1;
                if (b === '25F') return 1;
                return a.localeCompare(b);
            });
            
            if (seasons.length === 0) {
                alert('Ìï¥Îãπ Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê ÎåÄÌïú ÌåêÎß§ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            console.log(`[${category}] ÏãúÏ¶å:`, seasons);
            
            // Ï∞®Ìä∏ Ïª®ÌÖåÏù¥ÎÑà ÌëúÏãú
            document.getElementById('selectedCategoryChart').style.display = 'block';
            document.getElementById('selectedCategoryTitle').textContent = `${category} Ï£ºÏ∞®Î≥Ñ ÌåêÎß§ Ï∂îÏù¥`;
            
            // Í∏∞Ï°¥ Ï∞®Ìä∏ Ï†úÍ±∞
            Object.keys(charts).forEach(key => {
                if (key.startsWith('categoryTimeSeries') || key === 'comparisonChart') {
                    charts[key].destroy();
                    delete charts[key];
                }
            });
            
            // 24FÏôÄ 25F ÎπÑÍµê Í∑∏ÎûòÌîÑ ÏÉùÏÑ±
            const has24F = categoryTimeSeries['24F'] && Object.keys(categoryTimeSeries['24F']).length > 0;
            const has25F = categoryTimeSeries['25F'] && Object.keys(categoryTimeSeries['25F']).length > 0;
            
            if (has24F && has25F) {
                document.getElementById('comparisonChartContainer').style.display = 'block';
                createComparisonChart(category, categoryTimeSeries);
            } else {
                document.getElementById('comparisonChartContainer').style.display = 'none';
            }
            
            // Ï∞®Ìä∏ Ïª®ÌÖåÏù¥ÎÑà HTML ÏÉùÏÑ±
            let chartsHtml = '';
            
            // ÏãúÏ¶åÎ≥Ñ Ï∞®Ìä∏ Ï∂îÍ∞Ä
            seasons.forEach((season, index) => {
                const weeklyMap = categoryTimeSeries[season] || {};
                const weekData = [];
                
                // ÏãúÏ¶åÎ≥Ñ Ï£ºÏ∞® Î≤îÏúÑ ÏÑ§Ï†ï
                let startYear, startWeek, endYear, endWeek;
                if (season === '24F') {
                    startYear = 24;
                    startWeek = 24;
                    endYear = 25;
                    endWeek = 10;
                } else if (season === '25F') {
                    startYear = 25;
                    startWeek = 24;
                    endYear = 26;
                    endWeek = 10;
                } else {
                    // Îã§Î•∏ ÏãúÏ¶åÏùÄ Ï†ÑÏ≤¥ ÌëúÏãú
                    startYear = 0;
                    startWeek = 0;
                    endYear = 99;
                    endWeek = 52;
                }
                
                // Ï£ºÏ∞® Îç∞Ïù¥ÌÑ∞ ÏàòÏßë (ÏãúÏ¶åÎ≥Ñ Î≤îÏúÑÎßå)
                Object.keys(weeklyMap).forEach(weekKey => {
                const match = weekKey.match(/(\d+)W(\d+)/);
                if (match) {
                    const year = parseInt(match[1]);
                    const week = parseInt(match[2]);
                    const fullYear = year < 100 ? 2000 + year : year;
                    
                        // ÏãúÏ¶åÎ≥Ñ Î≤îÏúÑ ÌïÑÌÑ∞ÎßÅ
                        let include = false;
                        if (season === '24F') {
                            // 24F: 24ÎÖÑ 24Ï£º ~ 25ÎÖÑ 10Ï£º
                            if (year === 24 && week >= 24) {
                                include = true;
                            } else if (year === 25 && week <= 10) {
                                include = true;
                            }
                        } else if (season === '25F') {
                            // 25F: 25ÎÖÑ 24Ï£º Ïù¥ÏÉÅÎßå Ìè¨Ìï®, 26ÎÖÑ 10Ï£º Ïù¥ÌïòÎßå Ìè¨Ìï®
                            // 24ÎÖÑ Îç∞Ïù¥ÌÑ∞Îäî Ï†àÎåÄ Ìè¨Ìï®ÌïòÏßÄ ÏïäÏùå
                            if (year === 25 && week >= 24) {
                                include = true;
                            } else if (year === 26 && week <= 10) {
                                include = true;
                            }
                            // 24ÎÖÑ Îç∞Ïù¥ÌÑ∞Îäî Ï†úÏô∏
                        } else {
                            include = true; // Îã§Î•∏ ÏãúÏ¶åÏùÄ Ï†ÑÏ≤¥ Ìè¨Ìï®
                        }
                        
                        if (include) {
                            const sortKey = getWeekSortKey(fullYear, week);
                            weekData.push({
                                week: weekKey,
                                weekDisplay: formatWeekForDisplay(year, week),
                            sortKey: sortKey,
                                salesTotal: weeklyMap[weekKey].salesTotal || 0,
                                salesDomestic: weeklyMap[weekKey].salesDomestic || 0,
                                salesDF: weeklyMap[weekKey].salesDF || 0
                        });
                    }
                }
            });
            
                // Îπà Ï£ºÏ∞® Ï±ÑÏö∞Í∏∞ (ÏãúÏ¶åÎ≥Ñ Î≤îÏúÑ)
                if (season === '24F' || season === '25F') {
                    // Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞Ïóê ÏûàÎäî ÎÖÑÎèÑ ÌôïÏù∏
                    const existingYears = new Set();
                    weekData.forEach(d => {
                        const match = d.week.match(/(\d+)W(\d+)/);
                        if (match) {
                            existingYears.add(parseInt(match[1]));
                        }
                    });
                    
                    if (season === '24F') {
                        // 24F: 24ÎÖÑ 24Ï£º~52Ï£º, 25ÎÖÑ 1Ï£º~10Ï£º
                        for (let week = 24; week <= 52; week++) {
                            const weekKey = `24W${week.toString().padStart(2, '0')}`;
                            if (!weekData.some(d => d.week === weekKey)) {
                                weekData.push({
                                    week: weekKey,
                                    weekDisplay: formatWeekForDisplay(24, week),
                                    sortKey: getWeekSortKey(2024, week),
                        salesTotal: 0,
                        salesDomestic: 0,
                        salesDF: 0
                    });
                }
                        }
                        for (let week = 1; week <= 10; week++) {
                            const weekKey = `25W${week.toString().padStart(2, '0')}`;
                            if (!weekData.some(d => d.week === weekKey)) {
                                weekData.push({
                                    week: weekKey,
                                    weekDisplay: formatWeekForDisplay(25, week),
                                    sortKey: getWeekSortKey(2025, week),
                                    salesTotal: 0,
                                    salesDomestic: 0,
                                    salesDF: 0
                                });
                            }
                        }
                    } else if (season === '25F') {
                        // 25F: 25ÎÖÑ 24Ï£º~52Ï£º, 26ÎÖÑ 1Ï£º~10Ï£º (Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏñ¥ÎèÑ 0ÏúºÎ°ú Ï±ÑÏõÄ)
                        for (let week = 24; week <= 52; week++) {
                            const weekKey = `25W${week.toString().padStart(2, '0')}`;
                            if (!weekData.some(d => d.week === weekKey)) {
                                weekData.push({
                                    week: weekKey,
                                    weekDisplay: formatWeekForDisplay(25, week),
                                    sortKey: getWeekSortKey(2025, week),
                        salesTotal: 0,
                        salesDomestic: 0,
                        salesDF: 0
                    });
                }
                        }
                        // 26ÎÖÑ 1Ï£º~10Ï£ºÎèÑ Ìï≠ÏÉÅ Ï±ÑÏö∞Í∏∞ (Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏñ¥ÎèÑ 0ÏúºÎ°ú ÌëúÏãú)
                        for (let week = 1; week <= 10; week++) {
                            const weekKey = `26W${week.toString().padStart(2, '0')}`;
                            if (!weekData.some(d => d.week === weekKey)) {
                                weekData.push({
                                    week: weekKey,
                                    weekDisplay: formatWeekForDisplay(26, week),
                                    sortKey: getWeekSortKey(2026, week),
                                    salesTotal: 0,
                                    salesDomestic: 0,
                                    salesDF: 0
                                });
                            }
                        }
                    }
                }
                
                // Ï†ïÎ†¨
                weekData.sort((a, b) => a.sortKey - b.sortKey);
                
                // ÎîîÎ≤ÑÍπÖ: Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
                console.log(`[${season}] Ï£ºÏ∞® Îç∞Ïù¥ÌÑ∞ Ïàò:`, weekData.length);
                if (weekData.length > 0) {
                    console.log(`[${season}] Ï≤´ Ï£ºÏ∞®:`, weekData[0].week, `ÎßàÏßÄÎßâ Ï£ºÏ∞®:`, weekData[weekData.length - 1].week);
                } else {
                    console.warn(`[${season}] Ï£ºÏ∞® Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.`);
                }
                
                if (weekData.length === 0) {
                    console.warn(`[${season}] Ï£ºÏ∞® Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏñ¥ Ï∞®Ìä∏Î•º ÏÉùÏÑ±ÌïòÏßÄ ÏïäÏäµÎãàÎã§.`);
                return;
            }
            
                const weeks = weekData.map(d => d.weekDisplay);
                const weeklySalesTotal = weekData.map(d => Math.round(d.salesTotal / 1000000));
                const weeklySalesDomestic = weekData.map(d => Math.round(d.salesDomestic / 1000000));
                const weeklySalesDF = weekData.map(d => Math.round(d.salesDF / 1000000));
                
                const chartId = `categoryTimeSeriesChart${season}`;
                // ÏãúÏ¶åÎ≥Ñ Î≤îÏúÑ ÌëúÏãú
                let rangeText = '';
                if (season === '24F') {
                    rangeText = ' (24~10Ï£º)';
                } else if (season === '25F') {
                    rangeText = ' (24~10Ï£º)';
                }
                chartsHtml += `
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: rgba(255, 255, 255, 0.95); margin-bottom: 15px; font-weight: 700; letter-spacing: 0.5px;">${season} ÏãúÏ¶å ÌåêÎß§ Ï∂îÏù¥${rangeText} (Îã®ÏúÑ: Î∞±ÎßåÏõê)</h3>
                        <div class="chart-wrapper">
                            <canvas id="${chartId}"></canvas>
                        </div>
                    </div>
                `;
                
                // Ï∞®Ìä∏ ÏÉùÏÑ± (ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ)
                setTimeout(() => {
                    const ctx = document.getElementById(chartId);
                    if (!ctx) return;
                    
                    charts[`categoryTimeSeries${season}`] = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                            labels: weeks,
                    datasets: [
                        {
                                    label: 'Ï†ÑÏ≤¥',
                                    data: weeklySalesTotal,
                            borderColor: 'rgba(102, 126, 234, 1)',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2
                        },
                        {
                                    label: 'Íµ≠ÎÇ¥',
                                    data: weeklySalesDomestic,
                            borderColor: 'rgba(76, 175, 80, 1)',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2
                        },
                        {
                                    label: 'D/F',
                                    data: weeklySalesDF,
                            borderColor: 'rgba(255, 152, 0, 1)',
                            backgroundColor: 'rgba(255, 152, 0, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                                    position: 'top',
                                    labels: {
                                        color: 'rgba(255, 255, 255, 0.9)'
                                    }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                            return context.dataset.label + ': ' + context.parsed.y.toLocaleString() + ' (Î∞±ÎßåÏõê)';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                        color: 'rgba(255, 255, 255, 0.8)'
                                    },
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    }
                                },
                                x: {
                            ticks: {
                                        color: 'rgba(255, 255, 255, 0.8)'
                                    },
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    }
                                }
                            }
                        }
                    });
                }, index * 100);
            });
            
            // Ï∞®Ìä∏ Ïª®ÌÖåÏù¥ÎÑà ÏóÖÎç∞Ïù¥Ìä∏
            const chartsDiv = document.getElementById('seasonCharts');
            if (chartsDiv) {
                chartsDiv.innerHTML = chartsHtml;
            }
            
            // ÏÑ†ÌÉùÎêú Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïòÏù¥ÎùºÏù¥Ìä∏
            document.querySelectorAll('.category-item-card').forEach(card => {
                card.classList.remove('active');
            });
            event.target.closest('.category-item-card')?.classList.add('active');
            
            // Ïä§ÌÅ¨Î°§ÌïòÏó¨ Ï∞®Ìä∏Î°ú Ïù¥Îèô
            document.getElementById('selectedCategoryChart').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∞®Ìä∏ Îã´Í∏∞
        function closeCategoryChart() {
            document.getElementById('selectedCategoryChart').style.display = 'none';
            // Î™®Îì† ÏãúÏ¶å Ï∞®Ìä∏ Ï†úÍ±∞
            Object.keys(charts).forEach(key => {
                if (key.startsWith('categoryTimeSeries') || key === 'comparisonChart') {
                    charts[key].destroy();
                    delete charts[key];
                }
            });
            document.querySelectorAll('.category-item-card').forEach(card => {
                card.classList.remove('active');
            });
        }
        
        // 24F vs 25F ÎπÑÍµê Í∑∏ÎûòÌîÑ ÏÉùÏÑ±
        function createComparisonChart(category, categoryTimeSeries) {
            const ctx = document.getElementById('comparisonChart');
            if (!ctx) return;
            
            // 24F Îç∞Ïù¥ÌÑ∞ ÏàòÏßë (24ÎÖÑ 24Ï£º~25ÎÖÑ 10Ï£º)
            const data24F = { total: [], domestic: [], df: [] };
            const data25F = { total: [], domestic: [], df: [] };
            const weeks = [];
            
            // Ï£ºÏ∞® Î≤îÏúÑ ÏÉùÏÑ± (24~10Ï£º)
            // 24F: 24ÎÖÑ 24Ï£º~52Ï£º, 25ÎÖÑ 1Ï£º~10Ï£º
            // 25F: 25ÎÖÑ 24Ï£º~52Ï£º, 26ÎÖÑ 1Ï£º~10Ï£º
            const weekKeys = [];
            for (let week = 24; week <= 52; week++) {
                weekKeys.push({ key: `24W${week.toString().padStart(2, '0')}`, key25F: `25W${week.toString().padStart(2, '0')}`, display: week.toString(), sortKey: getWeekSortKey(2024, week) });
            }
            for (let week = 1; week <= 10; week++) {
                weekKeys.push({ key: `25W${week.toString().padStart(2, '0')}`, key25F: `26W${week.toString().padStart(2, '0')}`, display: week.toString(), sortKey: getWeekSortKey(2025, week) });
            }
            
            weekKeys.forEach(w => {
                const week24F = categoryTimeSeries['24F']?.[w.key] || { salesTotal: 0, salesDomestic: 0, salesDF: 0 };
                const week25F = categoryTimeSeries['25F']?.[w.key25F] || { salesTotal: 0, salesDomestic: 0, salesDF: 0 };
                
                data24F.total.push(Math.round(week24F.salesTotal / 1000000));
                data24F.domestic.push(Math.round(week24F.salesDomestic / 1000000));
                data24F.df.push(Math.round(week24F.salesDF / 1000000));
                
                data25F.total.push(Math.round(week25F.salesTotal / 1000000));
                data25F.domestic.push(Math.round(week25F.salesDomestic / 1000000));
                data25F.df.push(Math.round(week25F.salesDF / 1000000));
                
                weeks.push(w.display);
            });
            
            // Ï†ÑÏ≤¥ Í∑∏ÎûòÌîÑÎ°ú ÏãúÏûë
            window.currentComparisonType = 'total';
            window.comparisonData = {
                weeks: weeks,
                data24F: data24F,
                data25F: data25F
            };
            
            updateComparisonChart();
        }
        
        // ÎπÑÍµê Í∑∏ÎûòÌîÑ Ï†ÑÌôò
        function switchComparisonChart(type) {
            window.currentComparisonType = type;
            
            // Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.comparison-btn').forEach(btn => {
                btn.style.background = 'rgba(255, 255, 255, 0.2)';
                btn.style.color = 'rgba(255, 255, 255, 0.8)';
                btn.style.border = '1px solid rgba(255, 255, 255, 0.3)';
            });
            
            const btnId = type === 'total' ? 'btnCompareTotal' : type === 'domestic' ? 'btnCompareDomestic' : 'btnCompareDF';
            const activeBtn = document.getElementById(btnId);
            if (activeBtn) {
                activeBtn.style.background = '#667eea';
                activeBtn.style.color = 'white';
                activeBtn.style.border = 'none';
            }
            
            updateComparisonChart();
        }
        
        // ÎπÑÍµê Í∑∏ÎûòÌîÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateComparisonChart() {
            if (!window.comparisonData || !window.currentComparisonType) return;
            
            const ctx = document.getElementById('comparisonChart');
            if (!ctx) return;
            
            // Í∏∞Ï°¥ Ï∞®Ìä∏ Ï†úÍ±∞
            if (charts['comparisonChart']) {
                charts['comparisonChart'].destroy();
            }
            
            const type = window.currentComparisonType;
            const dataType = type === 'domestic' ? 'domestic' : type === 'df' ? 'df' : 'total';
            const labelType = type === 'domestic' ? 'Íµ≠ÎÇ¥' : type === 'df' ? 'D/F' : 'Ï†ÑÏ≤¥';
            
            const chartInstance = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: window.comparisonData.weeks,
                    datasets: [
                        {
                            label: `24F ${labelType}`,
                            data: window.comparisonData.data24F[dataType],
                            borderColor: 'rgba(102, 126, 234, 1)',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2
                        },
                        {
                            label: `25F ${labelType}`,
                            data: window.comparisonData.data25F[dataType],
                            borderColor: 'rgba(76, 175, 80, 1)',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: 'rgba(255, 255, 255, 0.9)'
                            }
                        },
                        tooltip: {
                            usePointStyle: true,
                            callbacks: {
                                title: function(context) {
                                    return 'Ï£ºÏ∞®: ' + context[0].label;
                                },
                                label: function(context) {
                                    const label = context.dataset.label + ': ' + context.parsed.y.toLocaleString() + ' (Î∞±ÎßåÏõê)';
                                    
                                    // YOY Í≥ÑÏÇ∞ Î∞è ÌëúÏãú (25F Îç∞Ïù¥ÌÑ∞ÏÖãÏùº ÎïåÎßå)
                                    if (context.datasetIndex === 1) {
                                        // chartÏùò Î™®Îì† Îç∞Ïù¥ÌÑ∞ÏÖãÏóêÏÑú Í∞ôÏùÄ Ïù∏Îç±Ïä§ Í∞í Í∞ÄÏ†∏Ïò§Í∏∞
                                        const chart = context.chart;
                                        const dataIndex = context.dataIndex;
                                        
                                        if (chart && chart.data && chart.data.datasets && chart.data.datasets.length >= 2) {
                                            const dataset24F = chart.data.datasets[0];
                                            const dataset25F = chart.data.datasets[1];
                                            
                                            if (dataset24F && dataset25F && dataset24F.data && dataset25F.data) {
                                                const value24F = dataset24F.data[dataIndex];
                                                const value25F = dataset25F.data[dataIndex];
                                                
                                                if (value24F !== undefined && value25F !== undefined) {
                                                    if (value24F > 0) {
                                                        const yoy = ((value25F - value24F) / value24F * 100).toFixed(1);
                                                        const yoyValue = parseFloat(yoy);
                                                        const yoySign = yoyValue >= 0 ? '+' : '';
                                                        return [
                                                            label,
                                                            `YOY${yoySign}${yoy}%`
                                                        ];
                                                    } else if (value25F > 0) {
                                                        return [
                                                            label,
                                                            'YOY+‚àû%'
                                                        ];
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.8)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            title: {
                                display: true,
                                text: 'ÌåêÎß§Ïï° (Î∞±ÎßåÏõê)',
                                color: 'rgba(255, 255, 255, 0.9)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.8)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            title: {
                                display: true,
                                text: 'Ï£ºÏ∞®',
                                color: 'rgba(255, 255, 255, 0.9)'
                            }
                        }
                    }
                }
            });
            
            charts['comparisonChart'] = chartInstance;
            
        }
        
        // VOC Î∂ÑÏÑù ÏóÖÎç∞Ïù¥Ìä∏
        function updateVocAnalysis() {
            const selectedCategory = document.getElementById('vocCategorySelect').value;
            const vocContent = document.getElementById('vocContent');
            
            if (!selectedCategory) {
                vocContent.style.display = 'none';
                return;
            }
            
            vocContent.style.display = 'block';
            
            let vocData = null;
            let categoryName = '';
            
            if (selectedCategory === 'DJ_PD') {
                vocData = vocDjData;
                categoryName = 'DJ/PD (Ìå®Îî©)';
            } else if (selectedCategory === 'WJ') {
                vocData = vocWjData;
                categoryName = 'WJ (Î∞îÎûåÎßâÏù¥)';
            } else if (selectedCategory === 'PT_WP_DP') {
                vocData = vocPtWpDpData;
                categoryName = 'PT/WP/DP (Ìå¨Ï∏†/Îç∞Îãò)';
            }
            
            if (!vocData || vocData.length === 0) {
                document.getElementById('vocDetails').innerHTML = '<p>VOC Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            generateVocDetails(selectedCategory, vocData, categoryName);
            generateVocSalesInsights(selectedCategory, vocData, categoryName);
        }
        
        // VOC ÏÉÅÏÑ∏ ÎÇ¥Ïö© ÏÉùÏÑ±
        function generateVocDetails(category, vocData, categoryName) {
            const detailsDiv = document.getElementById('vocDetails');
            let html = '';
            
            if (category === 'DJ_PD') {
                html = generateDjPdVocDetails(vocData);
            } else if (category === 'WJ') {
                html = generateWjVocDetails(vocData);
            } else if (category === 'PT_WP_DP') {
                html = generatePtWpDpVocDetails(vocData);
            }
            
            detailsDiv.innerHTML = html;
            
            if (category === 'DJ_PD') {
                createDjPdSatisfactionChart(vocData);
            }
        }
        
        // ÌÖçÏä§Ìä∏ Î∂ÑÏÑù Ìó¨Ìçº Ìï®Ïàò
        function analyzeTextFrequency(texts) {
            const keywords = {};
            const stopWords = ['Ïù¥', 'Í∞Ä', 'ÏùÑ', 'Î•º', 'Ïùò', 'Ïóê', 'ÏóêÏÑú', 'ÏôÄ', 'Í≥º', 'ÎèÑ', 'Î°ú', 'ÏúºÎ°ú', 'ÏùÄ', 'Îäî', 'Í≤É', 'Ïàò', 'Îì±', 'Î∞è', 'ÎòêÌïú', 'Í∑∏Î¶¨Í≥†', 'ÌïòÏßÄÎßå', 'Í∑∏Îü∞Îç∞', 'Í∑∏ÎûòÏÑú', 'Í∑∏Îü¨ÎÇò', 'ÎïåÎ¨∏', 'ÎïåÎ¨∏Ïóê', 'ÏúÑÌï¥', 'ÎåÄÌï¥', 'ÌÜµÌï¥', 'Îî∞Îùº', 'Îî∞ÎùºÏÑú', 'ÎßåÏïΩ', 'ÎßåÏïΩÏóê', 'Îßå', 'ÎßåÌÅº', 'Ï≤òÎüº', 'Í∞ôÏù¥', 'Î≥¥Îã§', 'Î∂ÄÌÑ∞', 'ÍπåÏßÄ', 'ÍπåÏßÄÎèÑ', 'Ï°∞Ï∞®', 'ÎßàÏ†Ä', 'Ï°∞Ï∞®ÎèÑ', 'ÎßàÏ†ÄÎèÑ', 'Îøê', 'ÎøêÎßå', 'ÎøêÎßå ÏïÑÎãàÎùº', 'ÎøêÎçîÎü¨', 'ÎøêÎçîÎü¨ÎèÑ', 'ÎøêÏù¥', 'ÎøêÏù¥Ïïº', 'ÎøêÏù¥ÏóêÏöî', 'ÎøêÏûÖÎãàÎã§', 'ÎøêÏù¥Ïóà', 'ÎøêÏù¥ÏóàÏñ¥', 'ÎøêÏù¥ÏóàÏñ¥Ïöî', 'ÎøêÏù¥ÏóàÏäµÎãàÎã§'];
            
            texts.forEach(text => {
                if (!text || text === 'nan') return;
                const words = text.replace(/[^\w\sÍ∞Ä-Ìû£]/g, ' ').split(/\s+/).filter(w => w.length > 1 && !stopWords.includes(w));
                words.forEach(word => {
                    keywords[word] = (keywords[word] || 0) + 1;
                });
            });
            
            return Object.entries(keywords)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20)
                .map(([word, count]) => ({ word, count }));
        }
        
        function categorizeSentiment(text) {
            if (!text || text === 'nan') return 'neutral';
            const positiveWords = ['Ï¢ã', 'ÎßåÏ°±', 'ÌõåÎ•≠', 'Ïö∞Ïàò', 'Îõ∞Ïñ¥', 'ÏµúÍ≥†', 'ÏôÑÎ≤Ω', 'ÌõåÎ•≠', 'Ïù∏Í∏∞', 'Ìò∏Ï°∞', 'ÏÑ±Í≥µ', 'Ìñ•ÏÉÅ', 'Í∞úÏÑ†', 'Ï¶ùÍ∞Ä', 'ÏÉÅÏäπ'];
            const negativeWords = ['Î∂àÎßå', 'Î¨∏Ï†ú', 'Î∂ÄÏ°±', 'Ï†ÄÏ°∞', 'Ïã§Ìå®', 'Í∞êÏÜå', 'ÌïòÎùΩ', 'Ï†ÄÌï≠', 'ÎçîÎîò', 'Î∂ÄÏßÑ', 'Ïñ¥Î†§ÏõÄ', 'Î∂àÎßåÏ°±', 'Îã®Ï†ê', 'ÏïΩÏ†ê'];
            
            const lowerText = text.toLowerCase();
            const positiveCount = positiveWords.filter(w => lowerText.includes(w)).length;
            const negativeCount = negativeWords.filter(w => lowerText.includes(w)).length;
            
            if (positiveCount > negativeCount) return 'positive';
            if (negativeCount > positiveCount) return 'negative';
            return 'neutral';
        }
        
        // DJ/PD VOC ÏÉÅÏÑ∏ ÎÇ¥Ïö© ÏÉùÏÑ± (Í∞úÏÑ† Î≤ÑÏ†Ñ)
        function generateDjPdVocDetails(vocData) {
            let html = `<h2 style="color: #667eea; margin-bottom: 25px; font-size: 1.8em;">üìä ${vocData.length}Í±¥Ïùò DJ/PD VOC Ïã¨Ï∏µ Î∂ÑÏÑù</h2>`;
            
            // ÎßåÏ°±ÎèÑ Î∂ÑÏÑù
            const satisfactionCols = ['Ïª¨Îü¨', 'ÏÜåÏû¨', 'Ìïè', 'Í∏∞Ïû•', 'Í∞ÄÍ≤©', 'ÎîîÏûêÏù∏ ÎîîÌÖåÏùº', 'Î≥ºÎ•®Í∞ê(ÌïÑÌååÏõå)', 'Í∏∞Îä•ÏÑ±', 'Î¨¥Í≤åÍ∞ê'];
            const satisfactionData = {};
            const satisfactionRanking = [];
            
            satisfactionCols.forEach(col => {
                const scores = vocData.map(row => parseFloat(row[col])).filter(score => !isNaN(score) && score > 0);
                if (scores.length > 0) {
                    const avg = scores.reduce((a, b) => a + b, 0) / scores.length;
                    satisfactionData[col] = {
                        avg: parseFloat(avg.toFixed(2)),
                        count: scores.length,
                        min: Math.min(...scores),
                        max: Math.max(...scores)
                    };
                    satisfactionRanking.push({ category: col, avg: satisfactionData[col].avg });
                }
            });
            
            satisfactionRanking.sort((a, b) => b.avg - a.avg);
            const topSatisfaction = satisfactionRanking[0];
            const lowSatisfaction = satisfactionRanking[satisfactionRanking.length - 1];
            
            // Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            const issues = [];
            const feedbacks = [];
            const productReactions = [];
            const colorNeeds = [];
            const priceReactions = [];
            const expansionOpinions = [];
            const salesSpeedIssues = [];
            
            vocData.forEach(row => {
                const lowSatisfaction = row['ÏúÑ ÏßàÎ¨∏ÏóêÏÑú ÎßåÏ°±ÎèÑ 3ÎØ∏ÎßåÏúºÎ°ú ÏÑ†ÌÉùÌïú ÏöîÏÜåÍ∞Ä ÏûàÎã§Î©¥ ÏïåÎ†§Ï£ºÏÑ∏Ïöî. ÏÉÅÏÑ∏ Ïù¥Ïú†ÎèÑ Ï†ÅÏñ¥ Ï£ºÏÑ∏Ïöî.(*)'];
                if (lowSatisfaction && lowSatisfaction.trim() && lowSatisfaction !== 'nan') {
                    issues.push(lowSatisfaction.trim());
                }
                
                const pdReaction = row['Í≤ΩÎüâÏª§Î∏åPD (3APDB0356) ÌòÑÏû• Î∞òÏùëÏùÑ ÏïåÎ†§Ï£ºÏÑ∏Ïöî(*)'];
                if (pdReaction && pdReaction.trim() && pdReaction !== 'nan') {
                    productReactions.push(pdReaction.trim());
                }
                
                const expansionOpinion = row['26FÏóêÎäî Í≤ΩÎüâ Ìå®Îî©ÏùÑ ÌôïÏû•Ìï† Í≥ÑÌöçÏûÖÎãàÎã§. ÏßÄÍ∏àÏ≤òÎüº PDÎ°ú Í∞ÄÍ≤©ÏùÑ Ï†ÄÎ†¥ÌïòÍ≤å Ïú†ÏßÄÌïòÎäîÍ≤å Ï¢ãÏùÑÏßÄ, DJÎ°ú Í∞ÄÍ≤©ÎåÄÍ∞Ä Ïò¨ÎùºÍ∞ÄÎçîÎùºÎèÑ ÏÜåÏû¨ Î≥ÄÍ≤ΩÌïòÏó¨ ÌôïÏû•ÌïòÎäîÍ≤å Ï¢ãÏùÑÏßÄ ÏùòÍ≤¨ ÏïåÎ†§Ï£ºÏÑ∏Ïöî(*)'];
                if (expansionOpinion && expansionOpinion.trim() && expansionOpinion !== 'nan') {
                    expansionOpinions.push(expansionOpinion.trim());
                }
                
                const salesSpeedIssue = row['Ï†ÑÎÖÑ ÎåÄÎπÑ Ïª§Î∏å Ìå®Îî© ÎùºÏù∏Ïùò ÌåêÎß§ ÏÜçÎèÑÍ∞Ä ÎçîÎîò ÏÉÅÌô© ÏûÖÎãàÎã§. Ïñ¥Îñ§ ÏöîÏÜåÏùò(Í∞ÄÍ≤©,Ïª¨Îü¨,ÏÜåÏû¨,ÎîîÏûêÏù∏,ÎßàÏºÄÌåÖ Îì±) Î¨∏Ï†úÍ∞Ä ÏûàÏñ¥ÏÑúÏù∏ÏßÄ ÏïÑÎãàÎ©¥ Í∏∞Ïò®Ïù¥ ÎÇ¥Î†§Í∞ÄÎ©¥ Î∞òÏùëÏù¥ Ïò¨Í≤ÉÏúºÎ°ú Î≥¥Ïù¥ÎäîÏßÄ ÏûêÏú†Î°≠Í≤å ÏùòÍ≤¨ Í∏∞Ïû¨ Î∂ÄÌÉÅ ÎìúÎ¶ΩÎãàÎã§.(*)'];
                if (salesSpeedIssue && salesSpeedIssue.trim() && salesSpeedIssue !== 'nan') {
                    salesSpeedIssues.push(salesSpeedIssue.trim());
                }
                
                const colorNeed = row['26F DJ Í∏∞Ìöç ÌïÑÏöî Ïª¨Îü¨ Ï°∞ÏÇ¨(*)'];
                if (colorNeed && colorNeed.trim() && colorNeed !== 'nan') {
                    colorNeeds.push(colorNeed.trim());
                }
                
                // Í∞ÄÍ≤© Í¥ÄÎ†® ÏùòÍ≤¨ Ï∂îÏ∂ú
                const priceFields = [
                    row['Í≥†ÌîÑÏΩîÏñ¥ ÌõÑÎìú Í≤ΩÎüâ 239,-(3ADJB0156)'],
                    row['Í≥†ÌîÑÏΩîÏñ¥ ÌÄºÌåÖ Í≤ΩÎüâ 259,-(3ADJB2756)'],
                    row['Ïª§Î∏å Ìå®Îî© 299,- (3ADJB2656)'],
                    row['Ïó¨ÏÑ± Ïª§Î∏åÌå®Îî© 289,- (3FDJB2056)']
                ];
                priceFields.forEach(price => {
                    if (price && price.trim() && price !== 'nan' && (price.includes('Ï†ÄÌï≠') || price.includes('ÎÜí') || price.includes('ÎÇÆ'))) {
                        priceReactions.push(price.trim());
                    }
                });
            });
            
            // ÌÇ§ÏõåÎìú Î∂ÑÏÑù
            const issueKeywords = analyzeTextFrequency(issues);
            const feedbackKeywords = analyzeTextFrequency(feedbacks);
            const reactionKeywords = analyzeTextFrequency(productReactions);
            
            // Í∞êÏÑ± Î∂ÑÏÑù
            const positiveReactions = productReactions.filter(r => categorizeSentiment(r) === 'positive');
            const negativeReactions = productReactions.filter(r => categorizeSentiment(r) === 'negative');
            const neutralReactions = productReactions.filter(r => categorizeSentiment(r) === 'neutral');
            
            // Ïª¨Îü¨ ÌÜµÍ≥Ñ
            const colorStats = {};
            colorNeeds.forEach(colorStr => {
                if (colorStr.includes('|')) {
                    colorStr.split('|').forEach(c => {
                        const trimmed = c.trim();
                        if (trimmed) colorStats[trimmed] = (colorStats[trimmed] || 0) + 1;
                    });
                } else {
                    const trimmed = colorStr.trim();
                    if (trimmed) colorStats[trimmed] = (colorStats[trimmed] || 0) + 1;
                }
            });
            const topColors = Object.entries(colorStats).sort((a, b) => b[1] - a[1]).slice(0, 10);
            
            html += `
                <!-- ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏöîÏïΩ -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 15px; margin-bottom: 30px; color: white; box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);">
                    <h3 style="margin-bottom: 20px; font-size: 1.6em; display: flex; align-items: center; gap: 10px;">
                        <span>üíé</span> ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏöîÏïΩ
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">ÏµúÍ≥† ÎßåÏ°±ÎèÑ Ìï≠Î™©</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${topSatisfaction.category}</div>
                            <div style="font-size: 1.2em; margin-top: 5px;">${topSatisfaction.avg}Ï†ê</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">Í∞úÏÑ† ÌïÑÏöî Ìï≠Î™©</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${lowSatisfaction.category}</div>
                            <div style="font-size: 1.2em; margin-top: 5px;">${lowSatisfaction.avg}Ï†ê</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">Í∏çÏ†ï Î∞òÏùë ÎπÑÏú®</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${((positiveReactions.length / productReactions.length) * 100).toFixed(1)}%</div>
                            <div style="font-size: 0.9em; margin-top: 5px;">${positiveReactions.length}/${productReactions.length}Í±¥</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">Ï£ºÏöî Ïù¥Ïäà Í±¥Ïàò</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${issues.length}Í±¥</div>
                            <div style="font-size: 0.9em; margin-top: 5px;">Í∞úÏÑ† ÌïÑÏöî ÏÇ¨Ìï≠</div>
                        </div>
                    </div>
                </div>
                
                <!-- ÎßåÏ°±ÎèÑ ÏÉÅÏÑ∏ Î∂ÑÏÑù -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üìä ÎßåÏ°±ÎèÑ Ï†êÏàò ÏÉÅÏÑ∏ Î∂ÑÏÑù</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        ${Object.keys(satisfactionData).map(col => {
                            const data = satisfactionData[col];
                            const isTop = col === topSatisfaction.category;
                            const isLow = col === lowSatisfaction.category;
                            return `
                                <div style="background: ${isTop ? '#e8f5e9' : isLow ? '#ffebee' : '#f8f9fa'}; padding: 15px; border-radius: 10px; border-left: 4px solid ${isTop ? '#4caf50' : isLow ? '#f44336' : '#667eea'};">
                                    <div style="font-size: 0.9em; color: #666; margin-bottom: 5px; display: flex; justify-content: space-between;">
                                        <span>${col}</span>
                                        ${isTop ? '<span style="color: #4caf50; font-weight: bold;">ÏµúÍ≥†</span>' : isLow ? '<span style="color: #f44336; font-weight: bold;">Í∞úÏÑ†ÌïÑÏöî</span>' : ''}
                                    </div>
                                    <div style="font-size: 1.5em; font-weight: bold; color: #667eea;">${data.avg}</div>
                                    <div style="font-size: 0.8em; color: #999; margin-top: 5px;">
                                        Î≤îÏúÑ: ${data.min} ~ ${data.max}Ï†ê | ${data.count}Í±¥ ÏùëÎãµ
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 15px;">
                        <strong>üìå Î∂ÑÏÑù Í≤∞Í≥º:</strong> ${topSatisfaction.category} Ìï≠Î™©Ïù¥ ${topSatisfaction.avg}Ï†êÏúºÎ°ú Í∞ÄÏû• ÎÜíÏùÄ ÎßåÏ°±ÎèÑÎ•º Î≥¥Ïù¥Î©∞, 
                        ${lowSatisfaction.category} Ìï≠Î™©(${lowSatisfaction.avg}Ï†ê)ÏùÄ Ï¶âÏãú Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌïú ÏòÅÏó≠ÏûÖÎãàÎã§. 
                        Îëê Ìï≠Î™© Í∞Ñ ${(topSatisfaction.avg - lowSatisfaction.avg).toFixed(2)}Ï†êÏùò Ï∞®Ïù¥Í∞Ä ÏûàÏñ¥ ${lowSatisfaction.category} Í∞úÏÑ†Ïóê ÏßëÏ§ëÌï† ÌïÑÏöîÍ∞Ä ÏûàÏäµÎãàÎã§.
                    </div>
                </div>
                
                <!-- Ï£ºÏöî Ïù¥Ïäà ÌÇ§ÏõåÎìú Î∂ÑÏÑù -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üîç Ï£ºÏöî Ïù¥Ïäà ÌÇ§ÏõåÎìú Î∂ÑÏÑù</h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
                        ${issueKeywords.slice(0, 15).map(kw => `
                            <span style="background: #fff3cd; padding: 8px 15px; border-radius: 20px; font-size: 0.9em; border: 2px solid #ffc107;">
                                ${kw.word} <strong style="color: #f57c00;">(${kw.count})</strong>
                            </span>
                        `).join('')}
                    </div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 10px; border-left: 4px solid #ffc107;">
                        <strong>üí° Ïù∏ÏÇ¨Ïù¥Ìä∏:</strong> "${issueKeywords[0]?.word}" ÌÇ§ÏõåÎìúÍ∞Ä ${issueKeywords[0]?.count}Ìöå Ïñ∏Í∏âÎêòÏñ¥ Í∞ÄÏû• ÎπàÎ≤àÌïú Ïù¥ÏäàÎ°ú ÌôïÏù∏Îê©ÎãàÎã§. 
                        Ïù¥Îäî Í≥†Í∞ùÎì§Ïù¥ Í∞ÄÏû• ÎßéÏù¥ Î∂àÎßåÏùÑ ÎäêÎÅºÎäî ÏòÅÏó≠Ïù¥ÎØÄÎ°ú Ïö∞ÏÑ†Ï†ÅÏúºÎ°ú Í∞úÏÑ†Ìï¥Ïïº Ìï©ÎãàÎã§.
                    </div>
                </div>
                
                <!-- Í∞êÏÑ± Î∂ÑÏÑù -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üòä Í∞êÏÑ± Î∂ÑÏÑù Í≤∞Í≥º</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                        <div style="background: #e8f5e9; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #4caf50;">
                            <div style="font-size: 2em; margin-bottom: 10px;">üòä</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #2e7d32;">${positiveReactions.length}Í±¥</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Í∏çÏ†ï Î∞òÏùë</div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 5px;">${((positiveReactions.length / productReactions.length) * 100).toFixed(1)}%</div>
                        </div>
                        <div style="background: #fff3e0; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #ff9800;">
                            <div style="font-size: 2em; margin-bottom: 10px;">üòê</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #e65100;">${neutralReactions.length}Í±¥</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Ï§ëÎ¶Ω Î∞òÏùë</div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 5px;">${((neutralReactions.length / productReactions.length) * 100).toFixed(1)}%</div>
                        </div>
                        <div style="background: #ffebee; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #f44336;">
                            <div style="font-size: 2em; margin-bottom: 10px;">üòü</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #c62828;">${negativeReactions.length}Í±¥</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Î∂ÄÏ†ï Î∞òÏùë</div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 5px;">${((negativeReactions.length / productReactions.length) * 100).toFixed(1)}%</div>
                        </div>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <strong>üìä Ï¢ÖÌï© ÌèâÍ∞Ä:</strong> Ï†ÑÏ≤¥ ${productReactions.length}Í±¥Ïùò Î∞òÏùë Ï§ë 
                        <strong style="color: #4caf50;">Í∏çÏ†ï ${positiveReactions.length}Í±¥ (${((positiveReactions.length / productReactions.length) * 100).toFixed(1)}%)</strong>, 
                        <strong style="color: #f44336;">Î∂ÄÏ†ï ${negativeReactions.length}Í±¥ (${((negativeReactions.length / productReactions.length) * 100).toFixed(1)}%)</strong>Î°ú 
                        ${positiveReactions.length > negativeReactions.length ? 'Ï†ÑÎ∞òÏ†ÅÏúºÎ°ú Í∏çÏ†ïÏ†ÅÏù∏ Î∞òÏùëÏù¥ Ïö∞ÏÑ∏Ìï©ÎãàÎã§.' : 'Î∂ÄÏ†ïÏ†Å Î∞òÏùëÏù¥ ÏÉÅÎãπ Î∂ÄÎ∂ÑÏùÑ Ï∞®ÏßÄÌïòÎØÄÎ°ú Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.'}
                    </div>
                </div>
                
                <!-- Ï£ºÏöî Í∞úÏÑ† ÌïÑÏöî ÏÇ¨Ìï≠ (ÏÉÅÏúÑ 5Í∞úÎßå) -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">‚ö†Ô∏è Ï£ºÏöî Í∞úÏÑ† ÌïÑÏöî ÏÇ¨Ìï≠ (Top 5)</h3>
                    <div style="line-height: 1.8;">
                        ${issues.slice(0, 5).map((issue, idx) => `
                            <div style="padding: 15px; margin-bottom: 15px; background: ${idx === 0 ? '#ffebee' : '#fff3cd'}; border-left: 4px solid ${idx === 0 ? '#f44336' : '#ffc107'}; border-radius: 5px;">
                                <div style="display: flex; align-items: start; gap: 10px;">
                                    <span style="background: ${idx === 0 ? '#f44336' : '#ffc107'}; color: white; padding: 5px 10px; border-radius: 50%; font-weight: bold; min-width: 30px; text-align: center;">${idx + 1}</span>
                                    <div style="flex: 1;">
                                        <div style="font-weight: ${idx === 0 ? 'bold' : 'normal'}; color: ${idx === 0 ? '#c62828' : '#333'};">
                                            ${issue}
                                        </div>
                                        ${idx === 0 ? '<div style="margin-top: 8px; font-size: 0.9em; color: #666;">üî• ÏµúÏö∞ÏÑ† Í∞úÏÑ† Ìï≠Î™©</div>' : ''}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    ${issues.length > 5 ? `<div style="text-align: center; margin-top: 15px;"><a href="#" onclick="alert('Ï†ÑÏ≤¥ ${issues.length}Í±¥Ïùò Ïù¥ÏäàÍ∞Ä ÏûàÏäµÎãàÎã§. ÏÉÅÏÑ∏ ÎÇ¥Ïö©ÏùÄ ÏïÑÎûò ÏÑπÏÖòÏùÑ Ï∞∏Í≥†ÌïòÏÑ∏Ïöî.'); return false;" style="color: #667eea; text-decoration: none;">+ ${issues.length - 5}Í±¥ Îçî Î≥¥Í∏∞</a></div>` : ''}
                </div>
                
                <!-- Ï†úÌíàÎ≥Ñ ÌòÑÏû• Î∞òÏùë (Ïπ¥ÌÖåÍ≥†Î¶¨Ìôî) -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üí¨ Ï†úÌíàÎ≥Ñ ÌòÑÏû• Î∞òÏùë Î∂ÑÏÑù</h3>
                    ${positiveReactions.length > 0 ? `
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #4caf50; margin-bottom: 10px; font-size: 1.1em;">‚úÖ Í∏çÏ†ïÏ†Å Î∞òÏùë (${positiveReactions.length}Í±¥)</h4>
                            <div style="line-height: 1.8;">
                                ${positiveReactions.slice(0, 5).map((reaction, idx) => `
                                    <div style="padding: 12px; margin-bottom: 10px; background: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 5px;">
                                        <strong>${idx + 1}.</strong> ${reaction}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    ${negativeReactions.length > 0 ? `
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #f44336; margin-bottom: 10px; font-size: 1.1em;">‚ùå Î∂ÄÏ†ïÏ†Å Î∞òÏùë (${negativeReactions.length}Í±¥)</h4>
                            <div style="line-height: 1.8;">
                                ${negativeReactions.slice(0, 5).map((reaction, idx) => `
                                    <div style="padding: 12px; margin-bottom: 10px; background: #ffebee; border-left: 4px solid #f44336; border-radius: 5px;">
                                        <strong>${idx + 1}.</strong> ${reaction}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 15px;">
                        <strong>üìå ÌïµÏã¨ Î©îÏãúÏßÄ:</strong> ${reactionKeywords.slice(0, 3).map(kw => kw.word).join(', ')} ÌÇ§ÏõåÎìúÍ∞Ä ÏûêÏ£º Ïñ∏Í∏âÎêòÏñ¥ 
                        Í≥†Í∞ùÎì§Ïù¥ Ïù¥ ÏòÅÏó≠Ïóê ÎåÄÌïú Í¥ÄÏã¨Ïù¥ ÎÜíÏùåÏùÑ Ïïå Ïàò ÏûàÏäµÎãàÎã§.
                    </div>
                </div>
                
                <!-- ÌôïÏû• Î∞è Í∞úÏÑ† ÏùòÍ≤¨ (ÌÇ§ÏõåÎìú Î∂ÑÏÑù Ìè¨Ìï®) -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üí° ÌôïÏû• Î∞è Í∞úÏÑ† ÏùòÍ≤¨</h3>
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <strong>üîë ÌïµÏã¨ ÌÇ§ÏõåÎìú:</strong> 
                        ${feedbackKeywords.slice(0, 8).map(kw => `<span style="background: white; padding: 5px 10px; border-radius: 15px; margin: 0 5px; font-size: 0.9em;">${kw.word} (${kw.count})</span>`).join('')}
                    </div>
                    <div style="line-height: 1.8;">
                        ${feedbacks.slice(0, 8).map((feedback, idx) => `
                            <div style="padding: 12px; margin-bottom: 10px; background: #f0f9ff; border-left: 4px solid #0ea5e9; border-radius: 5px;">
                                <strong>${idx + 1}.</strong> ${feedback}
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- ÌåêÎß§ ÏÜçÎèÑ Ïù¥Ïäà Î∂ÑÏÑù -->
                ${salesSpeedIssues.length > 0 ? `
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üìâ ÌåêÎß§ ÏÜçÎèÑ Ïù¥Ïäà Ïã¨Ï∏µ Î∂ÑÏÑù</h3>
                    <div style="line-height: 1.8;">
                        ${salesSpeedIssues.slice(0, 8).map((issue, idx) => `
                            <div style="padding: 12px; margin-bottom: 10px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 5px;">
                                <strong>${idx + 1}.</strong> ${issue}
                            </div>
                        `).join('')}
                    </div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #ffc107;">
                        <strong>‚ö†Ô∏è Ï£ºÏùò:</strong> ${salesSpeedIssues.length}Í±¥Ïùò ÌåêÎß§ ÏÜçÎèÑ Í¥ÄÎ†® Ïù¥ÏäàÍ∞Ä Î≥¥Í≥†ÎêòÏóàÏäµÎãàÎã§. 
                        Ïù¥Îäî Ïã§Ï†ú ÌåêÎß§ ÏÑ±Í≥ºÏóê ÏßÅÏ†ëÏ†ÅÏù∏ ÏòÅÌñ•ÏùÑ ÎØ∏Ïπ† Ïàò ÏûàÏúºÎØÄÎ°ú Ï¶âÏãú ÎåÄÏùëÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.
                    </div>
                </div>
                ` : ''}
                
                <!-- 26F Ïª¨Îü¨ Í∏∞Ìöç -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üé® 26F Í∏∞Ìöç ÌïÑÏöî Ïª¨Îü¨ Î∂ÑÏÑù</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px;">
                        ${topColors.map(([color, count], idx) => `
                            <div style="background: ${idx < 3 ? '#fef3c7' : '#f8f9fa'}; padding: 15px; border-radius: 10px; text-align: center; border: 2px solid ${idx < 3 ? '#f59e0b' : '#ddd'};">
                                <div style="font-size: 1.2em; font-weight: bold; color: #667eea; margin-bottom: 5px;">${color}</div>
                                <div style="font-size: 0.9em; color: #666;">${count}Ìöå Ïñ∏Í∏â</div>
                                ${idx < 3 ? '<div style="font-size: 0.8em; color: #f59e0b; margin-top: 5px;">‚≠ê Ï∂îÏ≤ú</div>' : ''}
                            </div>
                        `).join('')}
                    </div>
                    <div style="background: #fef3c7; padding: 15px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                        <strong>üí° Ïª¨Îü¨ Ï†ÑÎûµ:</strong> ${topColors[0]?.[0]} Ïª¨Îü¨Í∞Ä ${topColors[0]?.[1]}ÌöåÎ°ú Í∞ÄÏû• ÎßéÏù¥ Ïñ∏Í∏âÎêòÏñ¥ 
                        26F ÏãúÏ¶å Í∏∞Ìöç Ïãú Ïö∞ÏÑ† Í≥†Î†§Ìï¥Ïïº Ìï† Ïª¨Îü¨ÏûÖÎãàÎã§. ${topColors.slice(1, 3).map(([c]) => c).join(', ')} Ïª¨Îü¨ÎèÑ ÎÜíÏùÄ Í¥ÄÏã¨ÏùÑ Î≥¥Ïù¥Í≥† ÏûàÏäµÎãàÎã§.
                    </div>
                </div>
                
                <!-- Ïï°ÏÖò ÏïÑÏù¥ÌÖú -->
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); border: 2px solid #667eea;">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üéØ Í∂åÏû• Ïï°ÏÖò ÏïÑÏù¥ÌÖú</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #f44336;">
                            <h4 style="color: #f44336; margin-bottom: 10px;">üî¥ Ï¶âÏãú Ï°∞Ïπò (Í∏¥Í∏â)</h4>
                            <ul style="line-height: 1.8; padding-left: 20px;">
                                <li>${lowSatisfaction.category} ÎßåÏ°±ÎèÑ Í∞úÏÑ† (ÌòÑÏû¨ ${lowSatisfaction.avg}Ï†ê)</li>
                                <li>${issueKeywords[0]?.word} Í¥ÄÎ†® Ïù¥Ïäà Ìï¥Í≤∞</li>
                                ${salesSpeedIssues.length > 0 ? '<li>ÌåêÎß§ ÏÜçÎèÑ Ï†ÄÌïò ÏõêÏù∏ Î∂ÑÏÑù Î∞è ÎåÄÏùë</li>' : ''}
                            </ul>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #ff9800;">
                            <h4 style="color: #ff9800; margin-bottom: 10px;">üü† Îã®Í∏∞ Í∞úÏÑ† (1-2Í∞úÏõî)</h4>
                            <ul style="line-height: 1.8; padding-left: 20px;">
                                <li>${topColors[0]?.[0]} Ïª¨Îü¨ Ï§ëÏã¨Ïùò 26F Ïª¨Îü¨ ÎùºÏù∏ÏóÖ ÌôïÏû•</li>
                                <li>Í∏çÏ†ï Î∞òÏùëÏù¥ ÎÜíÏùÄ Ï†úÌíà ÌäπÏÑ± Í∞ïÌôî</li>
                                <li>Î∂ÄÏ†ï Î∞òÏùë ÏöîÏÜå Ï†úÍ±∞ ÎòêÎäî Í∞úÏÑ†</li>
                            </ul>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #4caf50;">
                            <h4 style="color: #4caf50; margin-bottom: 10px;">üü¢ Ï§ëÏû•Í∏∞ Ï†ÑÎûµ (3-6Í∞úÏõî)</h4>
                            <ul style="line-height: 1.8; padding-left: 20px;">
                                <li>${topSatisfaction.category} Í∞ïÏ†êÏùÑ Îã§Î•∏ Ï†úÌíàÏóê ÌôïÏû•</li>
                                <li>Í≥†Í∞ù ÌîºÎìúÎ∞± Í∏∞Î∞ò Ï†úÌíà Í∞úÎ∞ú ÌîÑÎ°úÏÑ∏Ïä§ Ï†ïÎ¶Ω</li>
                                <li>Ï†ïÍ∏∞Ï†ÅÏù∏ VOC Î™®ÎãàÌÑ∞ÎßÅ Ï≤¥Í≥Ñ Íµ¨Ï∂ï</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            return html;
        }
        
        // WJ VOC ÏÉÅÏÑ∏ ÎÇ¥Ïö© ÏÉùÏÑ± (Í∞úÏÑ† Î≤ÑÏ†Ñ)
        function generateWjVocDetails(vocData) {
            let html = `<h2 style="color: #667eea; margin-bottom: 25px; font-size: 1.8em;">üìä ${vocData.length}Í±¥Ïùò WJ VOC Ïã¨Ï∏µ Î∂ÑÏÑù</h2>`;
            
            const productReactions = [];
            const salesSpeedIssues = [];
            const launchTiming = [];
            
            vocData.forEach(row => {
                const timing = row['Í∏àÎÖÑÎèÑ FW WJ Îü∞Ïπ≠ ÏãúÏ†ê Ï†ÅÏ†àÏÑ± ÌèâÍ∞Ä(*)'];
                if (timing && timing.trim() && timing !== 'nan') {
                    launchTiming.push(timing.trim());
                }
                
                const reactions = [
                    row['3AWJB0154 Í≥†ÌîÑÏΩîÏñ¥ 2L Î∞îÎûåÎßâÏù¥ Ï¥àÎ∞ò Î∞òÏùë Ï°∞ÏÇ¨(*)'],
                    row['3FWJB0154 Ïó¨ÏÑ± Í≥†ÌîÑÏΩîÏñ¥ 2L Î∞îÎûåÎßâÏù¥ Ï¥àÎ∞ò Î∞òÏùë Ï°∞ÏÇ¨(*)'],
                    row['3AWJB0254 Í≥†ÌîÑÏΩîÏñ¥ Î∏îÎü¨ÌÇπ Î©îÍ∞ÄÎ°úÍ≥†  2L Î∞îÎûåÎßâÏù¥ Ï¥àÎ∞ò Î∞òÏùë Ï°∞ÏÇ¨(*)'],
                    row['3FWJB0454 Ïó¨ÏÑ± Í≥†ÌîÑÏΩîÏñ¥ Ïä§Ìã∞Ïπò Î∞îÎûåÎßâÏù¥ Ï¥àÎ∞ò Î∞òÏùë Ï°∞ÏÇ¨(*)'],
                    row['Í≥†Ïñ¥ÎùºÏù∏ Î∞îÎûåÎßâÏù¥ Ï¥àÎ∞ò Î∞òÏùë Ï°∞ÏÇ¨(*)']
                ];
                
                reactions.forEach(reaction => {
                    if (reaction && reaction.trim() && reaction !== 'nan') {
                        productReactions.push(reaction.trim());
                    }
                });
                
                const salesIssue = row['24F ÎåÄÎπÑ 25F WJÏùò ÌåêÎß§ ÏÜçÎèÑÍ∞Ä ÎçîÎîò ÏõêÏù∏ Ï°∞ÏÇ¨(*)'];
                if (salesIssue && salesIssue.trim() && salesIssue !== 'nan') {
                    salesSpeedIssues.push(salesIssue.trim());
                }
            });
            
            // Îü∞Ïπ≠ ÏãúÏ†ê ÌÜµÍ≥Ñ
            const timingStats = {};
            launchTiming.forEach(t => {
                timingStats[t] = (timingStats[t] || 0) + 1;
            });
            const topTiming = Object.entries(timingStats).sort((a, b) => b[1] - a[1])[0];
            
            // ÌÇ§ÏõåÎìú Î∂ÑÏÑù
            const reactionKeywords = analyzeTextFrequency(productReactions);
            const issueKeywords = analyzeTextFrequency(salesSpeedIssues);
            
            // Í∞êÏÑ± Î∂ÑÏÑù
            const positiveReactions = productReactions.filter(r => categorizeSentiment(r) === 'positive');
            const negativeReactions = productReactions.filter(r => categorizeSentiment(r) === 'negative');
            const neutralReactions = productReactions.filter(r => categorizeSentiment(r) === 'neutral');
            
            html += `
                <!-- ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏöîÏïΩ -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 15px; margin-bottom: 30px; color: white; box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);">
                    <h3 style="margin-bottom: 20px; font-size: 1.6em; display: flex; align-items: center; gap: 10px;">
                        <span>üíé</span> ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏöîÏïΩ
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">Îü∞Ïπ≠ ÏãúÏ†ê ÌèâÍ∞Ä</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${topTiming?.[0] || 'N/A'}</div>
                            <div style="font-size: 0.9em; margin-top: 5px;">${topTiming?.[1] || 0}Í±¥ ÏùëÎãµ</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">Í∏çÏ†ï Î∞òÏùë ÎπÑÏú®</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${productReactions.length > 0 ? ((positiveReactions.length / productReactions.length) * 100).toFixed(1) : 0}%</div>
                            <div style="font-size: 0.9em; margin-top: 5px;">${positiveReactions.length}/${productReactions.length}Í±¥</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">ÌåêÎß§ ÏÜçÎèÑ Ïù¥Ïäà</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${salesSpeedIssues.length}Í±¥</div>
                            <div style="font-size: 0.9em; margin-top: 5px;">${salesSpeedIssues.length > 0 ? 'Ï¶âÏãú ÎåÄÏùë ÌïÑÏöî' : 'Ïù¥Ïäà ÏóÜÏùå'}</div>
                        </div>
                    </div>
                </div>
                
                <!-- Îü∞Ïπ≠ ÏãúÏ†ê ÌèâÍ∞Ä -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">‚è∞ Îü∞Ïπ≠ ÏãúÏ†ê ÌèâÍ∞Ä Î∂ÑÏÑù</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        ${Object.entries(timingStats).sort((a, b) => b[1] - a[1]).map(([timing, count]) => `
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #667eea; text-align: center;">
                                <div style="font-size: 1.2em; font-weight: bold; color: #667eea; margin-bottom: 5px;">${timing}</div>
                                <div style="font-size: 0.9em; color: #666;">${count}Í±¥ (${((count / launchTiming.length) * 100).toFixed(1)}%)</div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 10px;">
                        <strong>üìå Î∂ÑÏÑù Í≤∞Í≥º:</strong> ${topTiming?.[0]} ÌèâÍ∞ÄÍ∞Ä ${topTiming?.[1]}Í±¥(${((topTiming?.[1] / launchTiming.length) * 100).toFixed(1)}%)ÏúºÎ°ú Í∞ÄÏû• ÎßéÏïÑ 
                        ${topTiming?.[0] === 'Ï†ÅÎãπÌïòÎã§' ? 'Îü∞Ïπ≠ ÏãúÏ†êÏù¥ Ï†ÅÏ†àÌñàÏùåÏùÑ ÏãúÏÇ¨Ìï©ÎãàÎã§.' : topTiming?.[0] === 'Îã§ÏÜå Îπ†Î•¥Îã§' ? 'Îü∞Ïπ≠ ÏãúÏ†êÏù¥ Îã§ÏÜå Îπ†Î•¥Îã§Îäî ÏùòÍ≤¨Ïù¥ ÎßéÏäµÎãàÎã§.' : 'Îü∞Ïπ≠ ÏãúÏ†êÏóê ÎåÄÌïú Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌï† Ïàò ÏûàÏäµÎãàÎã§.'}
                    </div>
                </div>
                
                <!-- Í∞êÏÑ± Î∂ÑÏÑù -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üòä Ï†úÌíà Î∞òÏùë Í∞êÏÑ± Î∂ÑÏÑù</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                        <div style="background: #e8f5e9; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #4caf50;">
                            <div style="font-size: 2em; margin-bottom: 10px;">üòä</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #2e7d32;">${positiveReactions.length}Í±¥</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Í∏çÏ†ï Î∞òÏùë</div>
                        </div>
                        <div style="background: #fff3e0; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #ff9800;">
                            <div style="font-size: 2em; margin-bottom: 10px;">üòê</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #e65100;">${neutralReactions.length}Í±¥</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Ï§ëÎ¶Ω Î∞òÏùë</div>
                        </div>
                        <div style="background: #ffebee; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #f44336;">
                            <div style="font-size: 2em; margin-bottom: 10px;">üòü</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #c62828;">${negativeReactions.length}Í±¥</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Î∂ÄÏ†ï Î∞òÏùë</div>
                        </div>
                    </div>
                    ${positiveReactions.length > 0 ? `
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #4caf50; margin-bottom: 10px; font-size: 1.1em;">‚úÖ Í∏çÏ†ïÏ†Å Î∞òÏùë (${positiveReactions.length}Í±¥)</h4>
                            <div style="line-height: 1.8;">
                                ${positiveReactions.slice(0, 5).map((reaction, idx) => `
                                    <div style="padding: 12px; margin-bottom: 10px; background: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 5px;">
                                        <strong>${idx + 1}.</strong> ${reaction}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    ${negativeReactions.length > 0 ? `
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #f44336; margin-bottom: 10px; font-size: 1.1em;">‚ùå Î∂ÄÏ†ïÏ†Å Î∞òÏùë (${negativeReactions.length}Í±¥)</h4>
                            <div style="line-height: 1.8;">
                                ${negativeReactions.slice(0, 5).map((reaction, idx) => `
                                    <div style="padding: 12px; margin-bottom: 10px; background: #ffebee; border-left: 4px solid #f44336; border-radius: 5px;">
                                        <strong>${idx + 1}.</strong> ${reaction}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 15px;">
                        <strong>üìä Ï¢ÖÌï© ÌèâÍ∞Ä:</strong> Ï†ÑÏ≤¥ ${productReactions.length}Í±¥Ïùò Î∞òÏùë Ï§ë 
                        <strong style="color: #4caf50;">Í∏çÏ†ï ${positiveReactions.length}Í±¥ (${((positiveReactions.length / productReactions.length) * 100).toFixed(1)}%)</strong>, 
                        <strong style="color: #f44336;">Î∂ÄÏ†ï ${negativeReactions.length}Í±¥ (${((negativeReactions.length / productReactions.length) * 100).toFixed(1)}%)</strong>Î°ú 
                        ${positiveReactions.length > negativeReactions.length ? 'Ï†ÑÎ∞òÏ†ÅÏúºÎ°ú Í∏çÏ†ïÏ†ÅÏù∏ Î∞òÏùëÏù¥ Ïö∞ÏÑ∏Ìï©ÎãàÎã§.' : 'Î∂ÄÏ†ïÏ†Å Î∞òÏùëÏù¥ ÏÉÅÎãπ Î∂ÄÎ∂ÑÏùÑ Ï∞®ÏßÄÌïòÎØÄÎ°ú Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.'}
                    </div>
                </div>
                
                <!-- Ï£ºÏöî ÌÇ§ÏõåÎìú Î∂ÑÏÑù -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üîç Ï£ºÏöî ÌÇ§ÏõåÎìú Î∂ÑÏÑù</h3>
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <strong>Ï†úÌíà Î∞òÏùë ÌÇ§ÏõåÎìú:</strong> 
                        ${reactionKeywords.slice(0, 10).map(kw => `<span style="background: white; padding: 5px 10px; border-radius: 15px; margin: 0 5px; font-size: 0.9em;">${kw.word} (${kw.count})</span>`).join('')}
                    </div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 10px;">
                        <strong>ÌåêÎß§ ÏÜçÎèÑ Ïù¥Ïäà ÌÇ§ÏõåÎìú:</strong> 
                        ${issueKeywords.slice(0, 10).map(kw => `<span style="background: white; padding: 5px 10px; border-radius: 15px; margin: 0 5px; font-size: 0.9em;">${kw.word} (${kw.count})</span>`).join('')}
                    </div>
                </div>
                
                <!-- ÌåêÎß§ ÏÜçÎèÑ Ïù¥Ïäà Ïã¨Ï∏µ Î∂ÑÏÑù -->
                ${salesSpeedIssues.length > 0 ? `
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üìâ ÌåêÎß§ ÏÜçÎèÑ Ïù¥Ïäà Ïã¨Ï∏µ Î∂ÑÏÑù</h3>
                    <div style="line-height: 1.8;">
                        ${salesSpeedIssues.slice(0, 10).map((issue, idx) => `
                            <div style="padding: 12px; margin-bottom: 10px; background: ${idx === 0 ? '#ffebee' : '#fff3cd'}; border-left: 4px solid ${idx === 0 ? '#f44336' : '#ffc107'}; border-radius: 5px;">
                                <strong>${idx + 1}.</strong> ${issue}
                                ${idx === 0 ? '<div style="margin-top: 5px; font-size: 0.9em; color: #666;">üî• ÏµúÏö∞ÏÑ† Ïù¥Ïäà</div>' : ''}
                            </div>
                        `).join('')}
                    </div>
                    <div style="background: #ffebee; padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #f44336;">
                        <strong>‚ö†Ô∏è Í≤ΩÍ≥†:</strong> ${salesSpeedIssues.length}Í±¥Ïùò ÌåêÎß§ ÏÜçÎèÑ Í¥ÄÎ†® Ïù¥ÏäàÍ∞Ä Î≥¥Í≥†ÎêòÏóàÏäµÎãàÎã§. 
                        "${issueKeywords[0]?.word}" ÌÇ§ÏõåÎìúÍ∞Ä ${issueKeywords[0]?.count}Ìöå Ïñ∏Í∏âÎêòÏñ¥ Í∞ÄÏû• ÎπàÎ≤àÌïú ÏõêÏù∏ÏúºÎ°ú Î≥¥ÏûÖÎãàÎã§. 
                        Ïù¥Îäî Ïã§Ï†ú ÌåêÎß§ ÏÑ±Í≥ºÏóê ÏßÅÏ†ëÏ†ÅÏù∏ ÏòÅÌñ•ÏùÑ ÎØ∏Ïπ† Ïàò ÏûàÏúºÎØÄÎ°ú Ï¶âÏãú ÎåÄÏùëÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.
                    </div>
                </div>
                ` : ''}
                
                <!-- Ïï°ÏÖò ÏïÑÏù¥ÌÖú -->
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); border: 2px solid #667eea;">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üéØ Í∂åÏû• Ïï°ÏÖò ÏïÑÏù¥ÌÖú</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                        ${salesSpeedIssues.length > 0 ? `
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #f44336;">
                            <h4 style="color: #f44336; margin-bottom: 10px;">üî¥ Ï¶âÏãú Ï°∞Ïπò (Í∏¥Í∏â)</h4>
                            <ul style="line-height: 1.8; padding-left: 20px;">
                                <li>ÌåêÎß§ ÏÜçÎèÑ Ï†ÄÌïò ÏõêÏù∏ Î∂ÑÏÑù (${issueKeywords[0]?.word} Í¥ÄÎ†®)</li>
                                <li>Î∂ÄÏ†ï Î∞òÏùë ÏöîÏÜå Ï¶âÏãú Í∞úÏÑ†</li>
                                <li>ÏãúÏû• Î∞òÏùë Î™®ÎãàÌÑ∞ÎßÅ Í∞ïÌôî</li>
                            </ul>
                        </div>
                        ` : ''}
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #ff9800;">
                            <h4 style="color: #ff9800; margin-bottom: 10px;">üü† Îã®Í∏∞ Í∞úÏÑ† (1-2Í∞úÏõî)</h4>
                            <ul style="line-height: 1.8; padding-left: 20px;">
                                <li>${topTiming?.[0] !== 'Ï†ÅÎãπÌïòÎã§' ? 'Îü∞Ïπ≠ ÏãúÏ†ê Ï°∞Ï†ï Í≤ÄÌÜ†' : 'Í∏çÏ†ï Î∞òÏùëÏù¥ ÎÜíÏùÄ Ï†úÌíà ÌäπÏÑ± Í∞ïÌôî'}</li>
                                <li>${reactionKeywords[0]?.word} Í¥ÄÎ†® Í∞úÏÑ† ÏÇ¨Ìï≠ Î∞òÏòÅ</li>
                                <li>Í≥†Í∞ù ÌîºÎìúÎ∞± Í∏∞Î∞ò Ï†úÌíà Í∞úÏÑ†</li>
                            </ul>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #4caf50;">
                            <h4 style="color: #4caf50; margin-bottom: 10px;">üü¢ Ï§ëÏû•Í∏∞ Ï†ÑÎûµ (3-6Í∞úÏõî)</h4>
                            <ul style="line-height: 1.8; padding-left: 20px;">
                                <li>Í∏çÏ†ï Î∞òÏùëÏù¥ ÎÜíÏùÄ Ï†úÌíà ÎùºÏù∏ ÌôïÏû•</li>
                                <li>Ï†ïÍ∏∞Ï†ÅÏù∏ VOC Î™®ÎãàÌÑ∞ÎßÅ Ï≤¥Í≥Ñ Íµ¨Ï∂ï</li>
                                <li>ÏãúÏû• Ìä∏Î†åÎìú Î∞òÏòÅ Ï†úÌíà Í∏∞Ìöç</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            return html;
        }
        
        // PT/WP/DP VOC ÏÉÅÏÑ∏ ÎÇ¥Ïö© ÏÉùÏÑ± (Í∞úÏÑ† Î≤ÑÏ†Ñ)
        function generatePtWpDpVocDetails(vocData) {
            let html = `<h2 style="color: #667eea; margin-bottom: 25px; font-size: 1.8em;">üìä ${vocData.length}Í±¥Ïùò PT/WP/DP VOC Ïã¨Ï∏µ Î∂ÑÏÑù</h2>`;
            
            const ptReactions = [];
            const wpReactions = [];
            const dpReactions = [];
            const ptFitIssues = [];
            const wpFitIssues = [];
            const colorNeeds = [];
            const allReactions = [];
            
            vocData.forEach(row => {
                const ptGood = row['[PT] PTÏóêÏÑú Í≥†Í∞ù Î∞òÏùëÏù¥ Ï¢ãÏùÄ ÏöîÏÜåÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî(*)'];
                const ptDetail = row['[PT] ÏúÑ ÏßàÎ¨∏Ïùò ÎãµÎ≥ÄÏóê ÎåÄÌïú ÏÉÅÏÑ∏ ÎÇ¥Ïö©ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî(*)'];
                if (ptGood && ptGood.trim() && ptGood !== 'nan') {
                    const reaction = `${ptGood}: ${ptDetail || ''}`;
                    ptReactions.push(reaction);
                    allReactions.push(reaction);
                }
                
                const ptFit = row['[PT] ÌòÑÏû¨ Íµ¨ÏÑ±ÏóêÏÑú Ï∂ïÏÜåÌïòÍ±∞ÎÇò Ï∂îÍ∞Ä ÎêòÏñ¥ÏïºÌïòÎäî ÌïèÏùÑ ÏûêÏú†Î°≠Í≤å ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.(*)'];
                if (ptFit && ptFit.trim() && ptFit !== 'nan') {
                    ptFitIssues.push(ptFit.trim());
                }
                
                const wpGood = row['[WP] WPÏóêÏÑú Í≥†Í∞ù Î∞òÏùëÏù¥ Ï¢ãÏùÄ ÏöîÏÜåÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî(*)'];
                const wpDetail = row['[WP] ÏúÑ ÏßàÎ¨∏Ïùò ÎãµÎ≥ÄÏóê ÎåÄÌïú ÏÉÅÏÑ∏ ÎÇ¥Ïö©ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî(*)'];
                if (wpGood && wpGood.trim() && wpGood !== 'nan') {
                    const reaction = `${wpGood}: ${wpDetail || ''}`;
                    wpReactions.push(reaction);
                    allReactions.push(reaction);
                }
                
                const wpFit = row['[WP] ÌòÑÏû¨ Íµ¨ÏÑ±ÏóêÏÑú Ï∂ïÏÜåÌïòÍ±∞ÎÇò Ï∂îÍ∞Ä ÎêòÏñ¥ÏïºÌïòÎäî ÌïèÏùÑ ÏûêÏú†Î°≠Í≤å ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.(*)'];
                if (wpFit && wpFit.trim() && wpFit !== 'nan') {
                    wpFitIssues.push(wpFit.trim());
                }
                
                const dpReaction = row['[DP] Îç∞Îãò ÌîåÎ†àÏñ¥ÌïèÏóê ÎåÄÌïú ÏÉùÍ∞ÅÏù¥ÎÇò Í≥†Í∞ùÎ∞òÏùëÏùÑ ÏûêÏú†Î°≠Í≤å ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî(*)'];
                if (dpReaction && dpReaction.trim() && dpReaction !== 'nan') {
                    dpReactions.push(dpReaction.trim());
                    allReactions.push(dpReaction.trim());
                }
                
                [row['[PT] PT Í∏∞Ìöç ÌïÑÏöî Ïª¨Îü¨ Ï°∞ÏÇ¨(*)'], row['[WP] WP Í∏∞Ìöç ÌïÑÏöî Ïª¨Îü¨ Ï°∞ÏÇ¨(*)'], row['[DP] DP Í∏∞Ìöç ÌïÑÏöî Ïª¨Îü¨ Ï°∞ÏÇ¨(*)']].forEach(color => {
                    if (color && color.trim() && color !== 'nan') {
                        colorNeeds.push(color.trim());
                    }
                });
            });
            
            // ÌÇ§ÏõåÎìú Î∂ÑÏÑù
            const ptKeywords = analyzeTextFrequency(ptReactions);
            const wpKeywords = analyzeTextFrequency(wpReactions);
            const dpKeywords = analyzeTextFrequency(dpReactions);
            const fitKeywords = analyzeTextFrequency([...ptFitIssues, ...wpFitIssues]);
            const colorStats = {};
            colorNeeds.forEach(colorStr => {
                if (colorStr.includes('|')) {
                    colorStr.split('|').forEach(c => {
                        const trimmed = c.trim();
                        if (trimmed) colorStats[trimmed] = (colorStats[trimmed] || 0) + 1;
                    });
                } else {
                    const trimmed = colorStr.trim();
                    if (trimmed) colorStats[trimmed] = (colorStats[trimmed] || 0) + 1;
                }
            });
            const topColors = Object.entries(colorStats).sort((a, b) => b[1] - a[1]).slice(0, 10);
            
            // Í∞êÏÑ± Î∂ÑÏÑù
            const positiveReactions = allReactions.filter(r => categorizeSentiment(r) === 'positive');
            const negativeReactions = allReactions.filter(r => categorizeSentiment(r) === 'negative');
            const neutralReactions = allReactions.filter(r => categorizeSentiment(r) === 'neutral');
            
            html += `
                <!-- ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏöîÏïΩ -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 15px; margin-bottom: 30px; color: white; box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);">
                    <h3 style="margin-bottom: 20px; font-size: 1.6em; display: flex; align-items: center; gap: 10px;">
                        <span>üíé</span> ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏöîÏïΩ
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">Ï†ÑÏ≤¥ Î∞òÏùë</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${allReactions.length}Í±¥</div>
                            <div style="font-size: 0.9em; margin-top: 5px;">PT: ${ptReactions.length} | WP: ${wpReactions.length} | DP: ${dpReactions.length}</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">Í∏çÏ†ï Î∞òÏùë ÎπÑÏú®</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${allReactions.length > 0 ? ((positiveReactions.length / allReactions.length) * 100).toFixed(1) : 0}%</div>
                            <div style="font-size: 0.9em; margin-top: 5px;">${positiveReactions.length}/${allReactions.length}Í±¥</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">Ìïè Í∞úÏÑ† ÏùòÍ≤¨</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${ptFitIssues.length + wpFitIssues.length}Í±¥</div>
                            <div style="font-size: 0.9em; margin-top: 5px;">PT: ${ptFitIssues.length} | WP: ${wpFitIssues.length}</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">Ïù∏Í∏∞ Ïª¨Îü¨</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${topColors[0]?.[0] || 'N/A'}</div>
                            <div style="font-size: 0.9em; margin-top: 5px;">${topColors[0]?.[1] || 0}Ìöå Ïñ∏Í∏â</div>
                        </div>
                    </div>
                </div>
                
                <!-- Í∞êÏÑ± Î∂ÑÏÑù -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üòä Ï†ÑÏ≤¥ Í∞êÏÑ± Î∂ÑÏÑù</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                        <div style="background: #e8f5e9; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #4caf50;">
                            <div style="font-size: 2em; margin-bottom: 10px;">üòä</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #2e7d32;">${positiveReactions.length}Í±¥</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Í∏çÏ†ï Î∞òÏùë</div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 5px;">${allReactions.length > 0 ? ((positiveReactions.length / allReactions.length) * 100).toFixed(1) : 0}%</div>
                        </div>
                        <div style="background: #fff3e0; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #ff9800;">
                            <div style="font-size: 2em; margin-bottom: 10px;">üòê</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #e65100;">${neutralReactions.length}Í±¥</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Ï§ëÎ¶Ω Î∞òÏùë</div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 5px;">${allReactions.length > 0 ? ((neutralReactions.length / allReactions.length) * 100).toFixed(1) : 0}%</div>
                        </div>
                        <div style="background: #ffebee; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #f44336;">
                            <div style="font-size: 2em; margin-bottom: 10px;">üòü</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #c62828;">${negativeReactions.length}Í±¥</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Î∂ÄÏ†ï Î∞òÏùë</div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 5px;">${allReactions.length > 0 ? ((negativeReactions.length / allReactions.length) * 100).toFixed(1) : 0}%</div>
                        </div>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <strong>üìä Ï¢ÖÌï© ÌèâÍ∞Ä:</strong> Ï†ÑÏ≤¥ ${allReactions.length}Í±¥Ïùò Î∞òÏùë Ï§ë 
                        <strong style="color: #4caf50;">Í∏çÏ†ï ${positiveReactions.length}Í±¥ (${allReactions.length > 0 ? ((positiveReactions.length / allReactions.length) * 100).toFixed(1) : 0}%)</strong>, 
                        <strong style="color: #f44336;">Î∂ÄÏ†ï ${negativeReactions.length}Í±¥ (${allReactions.length > 0 ? ((negativeReactions.length / allReactions.length) * 100).toFixed(1) : 0}%)</strong>Î°ú 
                        ${positiveReactions.length > negativeReactions.length ? 'Ï†ÑÎ∞òÏ†ÅÏúºÎ°ú Í∏çÏ†ïÏ†ÅÏù∏ Î∞òÏùëÏù¥ Ïö∞ÏÑ∏Ìï©ÎãàÎã§.' : 'Î∂ÄÏ†ïÏ†Å Î∞òÏùëÏù¥ ÏÉÅÎãπ Î∂ÄÎ∂ÑÏùÑ Ï∞®ÏßÄÌïòÎØÄÎ°ú Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.'}
                    </div>
                </div>
                
                <!-- Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌÇ§ÏõåÎìú Î∂ÑÏÑù -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üîç Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌïµÏã¨ ÌÇ§ÏõåÎìú</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        ${ptKeywords.length > 0 ? `
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; border-left: 4px solid #2196F3;">
                            <h4 style="color: #1976d2; margin-bottom: 10px;">üëñ PT ÌÇ§ÏõåÎìú</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                ${ptKeywords.slice(0, 8).map(kw => `<span style="background: white; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">${kw.word} (${kw.count})</span>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                        ${wpKeywords.length > 0 ? `
                        <div style="background: #e0f2f1; padding: 15px; border-radius: 10px; border-left: 4px solid #0ea5e9;">
                            <h4 style="color: #00897b; margin-bottom: 10px;">üëî WP ÌÇ§ÏõåÎìú</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                ${wpKeywords.slice(0, 8).map(kw => `<span style="background: white; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">${kw.word} (${kw.count})</span>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                        ${dpKeywords.length > 0 ? `
                        <div style="background: #fff3e0; padding: 15px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                            <h4 style="color: #e65100; margin-bottom: 10px;">üëó DP ÌÇ§ÏõåÎìú</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                ${dpKeywords.slice(0, 8).map(kw => `<span style="background: white; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">${kw.word} (${kw.count})</span>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                        ${fitKeywords.length > 0 ? `
                        <div style="background: #fff3cd; padding: 15px; border-radius: 10px; border-left: 4px solid #ffc107;">
                            <h4 style="color: #f57c00; margin-bottom: 10px;">üìè Ìïè Í∞úÏÑ† ÌÇ§ÏõåÎìú</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                ${fitKeywords.slice(0, 8).map(kw => `<span style="background: white; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">${kw.word} (${kw.count})</span>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
                
                <!-- PT Í≥†Í∞ù Î∞òÏùë -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üëñ PT (Ìå¨Ï∏†) Í≥†Í∞ù Î∞òÏùë Î∂ÑÏÑù</h3>
                    ${ptReactions.length > 0 ? `
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <strong>üîë ÌïµÏã¨ ÌÇ§ÏõåÎìú:</strong> 
                        ${ptKeywords.slice(0, 6).map(kw => `<span style="background: white; padding: 5px 10px; border-radius: 15px; margin: 0 5px; font-size: 0.9em;">${kw.word} (${kw.count})</span>`).join('')}
                    </div>
                    <div style="line-height: 1.8;">
                        ${ptReactions.slice(0, 10).map((reaction, idx) => `
                            <div style="padding: 12px; margin-bottom: 10px; background: #e7f3ff; border-left: 4px solid #2196F3; border-radius: 5px;">
                                <strong>${idx + 1}.</strong> ${reaction}
                            </div>
                        `).join('')}
                    </div>
                    ` : '<p style="color: #999; text-align: center; padding: 20px;">PT Í¥ÄÎ†® Î∞òÏùë Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>'}
                    ${ptFitIssues.length > 0 ? `
                    <h4 style="color: #666; margin-top: 20px; margin-bottom: 10px;">‚ö†Ô∏è Ìïè Í∞úÏÑ† ÏùòÍ≤¨ (${ptFitIssues.length}Í±¥)</h4>
                    <div style="line-height: 1.8;">
                        ${ptFitIssues.slice(0, 8).map((issue, idx) => `
                            <div style="padding: 12px; margin-bottom: 10px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 5px;">
                                <strong>${idx + 1}.</strong> ${issue}
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                </div>
                
                <!-- WP Í≥†Í∞ù Î∞òÏùë -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üëî WP (ÏôÄÏù¥ÎìúÌå¨Ï∏†) Í≥†Í∞ù Î∞òÏùë Î∂ÑÏÑù</h3>
                    ${wpReactions.length > 0 ? `
                    <div style="background: #e0f2f1; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <strong>üîë ÌïµÏã¨ ÌÇ§ÏõåÎìú:</strong> 
                        ${wpKeywords.slice(0, 6).map(kw => `<span style="background: white; padding: 5px 10px; border-radius: 15px; margin: 0 5px; font-size: 0.9em;">${kw.word} (${kw.count})</span>`).join('')}
                    </div>
                    <div style="line-height: 1.8;">
                        ${wpReactions.slice(0, 10).map((reaction, idx) => `
                            <div style="padding: 12px; margin-bottom: 10px; background: #f0f9ff; border-left: 4px solid #0ea5e9; border-radius: 5px;">
                                <strong>${idx + 1}.</strong> ${reaction}
                            </div>
                        `).join('')}
                    </div>
                    ` : '<p style="color: #999; text-align: center; padding: 20px;">WP Í¥ÄÎ†® Î∞òÏùë Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>'}
                    ${wpFitIssues.length > 0 ? `
                    <h4 style="color: #666; margin-top: 20px; margin-bottom: 10px;">‚ö†Ô∏è Ìïè Í∞úÏÑ† ÏùòÍ≤¨ (${wpFitIssues.length}Í±¥)</h4>
                    <div style="line-height: 1.8;">
                        ${wpFitIssues.slice(0, 8).map((issue, idx) => `
                            <div style="padding: 12px; margin-bottom: 10px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 5px;">
                                <strong>${idx + 1}.</strong> ${issue}
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                </div>
                
                <!-- DP Í≥†Í∞ù Î∞òÏùë -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üëó DP (Îç∞Îãò) Í≥†Í∞ù Î∞òÏùë Î∂ÑÏÑù</h3>
                    ${dpReactions.length > 0 ? `
                    <div style="background: #fff3e0; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <strong>üîë ÌïµÏã¨ ÌÇ§ÏõåÎìú:</strong> 
                        ${dpKeywords.slice(0, 6).map(kw => `<span style="background: white; padding: 5px 10px; border-radius: 15px; margin: 0 5px; font-size: 0.9em;">${kw.word} (${kw.count})</span>`).join('')}
                    </div>
                    <div style="line-height: 1.8;">
                        ${dpReactions.slice(0, 10).map((reaction, idx) => `
                            <div style="padding: 12px; margin-bottom: 10px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 5px;">
                                <strong>${idx + 1}.</strong> ${reaction}
                            </div>
                        `).join('')}
                    </div>
                    ` : '<p style="color: #999; text-align: center; padding: 20px;">DP Í¥ÄÎ†® Î∞òÏùë Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>'}
                </div>
                
                <!-- Ïª¨Îü¨ Í∏∞Ìöç Î∂ÑÏÑù -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üé® Í∏∞Ìöç ÌïÑÏöî Ïª¨Îü¨ Î∂ÑÏÑù</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px;">
                        ${topColors.map(([color, count], idx) => `
                            <div style="background: ${idx < 3 ? '#fef3c7' : '#f8f9fa'}; padding: 15px; border-radius: 10px; text-align: center; border: 2px solid ${idx < 3 ? '#f59e0b' : '#ddd'};">
                                <div style="font-size: 1.2em; font-weight: bold; color: #667eea; margin-bottom: 5px;">${color}</div>
                                <div style="font-size: 0.9em; color: #666;">${count}Ìöå Ïñ∏Í∏â</div>
                                ${idx < 3 ? '<div style="font-size: 0.8em; color: #f59e0b; margin-top: 5px;">‚≠ê Ï∂îÏ≤ú</div>' : ''}
                            </div>
                        `).join('')}
                    </div>
                    ${topColors.length > 0 ? `
                    <div style="background: #fef3c7; padding: 15px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                        <strong>üí° Ïª¨Îü¨ Ï†ÑÎûµ:</strong> ${topColors[0]?.[0]} Ïª¨Îü¨Í∞Ä ${topColors[0]?.[1]}ÌöåÎ°ú Í∞ÄÏû• ÎßéÏù¥ Ïñ∏Í∏âÎêòÏñ¥ 
                        Îã§Ïùå ÏãúÏ¶å Í∏∞Ìöç Ïãú Ïö∞ÏÑ† Í≥†Î†§Ìï¥Ïïº Ìï† Ïª¨Îü¨ÏûÖÎãàÎã§. ${topColors.slice(1, 3).map(([c]) => c).join(', ')} Ïª¨Îü¨ÎèÑ ÎÜíÏùÄ Í¥ÄÏã¨ÏùÑ Î≥¥Ïù¥Í≥† ÏûàÏäµÎãàÎã§.
                    </div>
                    ` : ''}
                </div>
                
                <!-- Ïï°ÏÖò ÏïÑÏù¥ÌÖú -->
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); border: 2px solid #667eea;">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üéØ Í∂åÏû• Ïï°ÏÖò ÏïÑÏù¥ÌÖú</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #f44336;">
                            <h4 style="color: #f44336; margin-bottom: 10px;">üî¥ Ï¶âÏãú Ï°∞Ïπò (Í∏¥Í∏â)</h4>
                            <ul style="line-height: 1.8; padding-left: 20px;">
                                ${ptFitIssues.length + wpFitIssues.length > 0 ? `<li>Ìïè Í∞úÏÑ† ÏùòÍ≤¨ ${ptFitIssues.length + wpFitIssues.length}Í±¥ Ï¶âÏãú Í≤ÄÌÜ†</li>` : ''}
                                ${negativeReactions.length > 0 ? `<li>Î∂ÄÏ†ï Î∞òÏùë ÏöîÏÜå Í∞úÏÑ† (${negativeReactions.length}Í±¥)</li>` : ''}
                                ${fitKeywords.length > 0 ? `<li>"${fitKeywords[0]?.word}" Í¥ÄÎ†® Ìïè Í∞úÏÑ†</li>` : ''}
                            </ul>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #ff9800;">
                            <h4 style="color: #ff9800; margin-bottom: 10px;">üü† Îã®Í∏∞ Í∞úÏÑ† (1-2Í∞úÏõî)</h4>
                            <ul style="line-height: 1.8; padding-left: 20px;">
                                ${topColors.length > 0 ? `<li>${topColors[0]?.[0]} Ïª¨Îü¨ Ï§ëÏã¨ ÎùºÏù∏ÏóÖ ÌôïÏû•</li>` : ''}
                                <li>Í∏çÏ†ï Î∞òÏùëÏù¥ ÎÜíÏùÄ ÏöîÏÜå Í∞ïÌôî</li>
                                <li>Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌïµÏã¨ ÌÇ§ÏõåÎìú Î∞òÏòÅ</li>
                            </ul>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #4caf50;">
                            <h4 style="color: #4caf50; margin-bottom: 10px;">üü¢ Ï§ëÏû•Í∏∞ Ï†ÑÎûµ (3-6Í∞úÏõî)</h4>
                            <ul style="line-height: 1.8; padding-left: 20px;">
                                <li>PT/WP/DP ÌÜµÌï© Î∏åÎûúÎìú Ï†ÑÎûµ ÏàòÎ¶Ω</li>
                                <li>Í≥†Í∞ù ÌîºÎìúÎ∞± Í∏∞Î∞ò Ï†úÌíà Í∞úÎ∞ú ÌîÑÎ°úÏÑ∏Ïä§ Ï†ïÎ¶Ω</li>
                                <li>Ï†ïÍ∏∞Ï†ÅÏù∏ VOC Î™®ÎãàÌÑ∞ÎßÅ Ï≤¥Í≥Ñ Íµ¨Ï∂ï</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            return html;
        }
        
        // DJ/PD ÎßåÏ°±ÎèÑ Ï∞®Ìä∏ ÏÉùÏÑ±
        function createDjPdSatisfactionChart(vocData) {
            const chartDiv = document.getElementById('vocSatisfactionChart');
            const satisfactionCols = ['Ïª¨Îü¨', 'ÏÜåÏû¨', 'Ìïè', 'Í∏∞Ïû•', 'Í∞ÄÍ≤©', 'ÎîîÏûêÏù∏ ÎîîÌÖåÏùº', 'Î≥ºÎ•®Í∞ê(ÌïÑÌååÏõå)', 'Í∏∞Îä•ÏÑ±', 'Î¨¥Í≤åÍ∞ê'];
            const labels = [];
            const averages = [];
            
            satisfactionCols.forEach(col => {
                const scores = vocData.map(row => parseFloat(row[col])).filter(score => !isNaN(score) && score > 0);
                if (scores.length > 0) {
                    const avg = scores.reduce((a, b) => a + b, 0) / scores.length;
                    labels.push(col);
                    averages.push(parseFloat(avg.toFixed(2)));
                }
            });
            
            chartDiv.innerHTML = `
                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4em;">üìä ÎßåÏ°±ÎèÑ Ï†êÏàò Ï∞®Ìä∏</h3>
                    <div class="chart-wrapper" style="height: 400px;">
                        <canvas id="djPdSatisfactionChart"></canvas>
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                const ctx = document.getElementById('djPdSatisfactionChart');
                if (ctx && charts['djPdSatisfactionChart']) {
                    charts['djPdSatisfactionChart'].destroy();
                }
                if (ctx) {
                    charts['djPdSatisfactionChart'] = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'ÎßåÏ°±ÎèÑ Ï†êÏàò',
                                data: averages,
                                backgroundColor: 'rgba(102, 126, 234, 0.8)',
                                borderColor: 'rgba(102, 126, 234, 1)',
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 5,
                                    title: { display: true, text: 'ÎßåÏ°±ÎèÑ Ï†êÏàò (1-5Ï†ê)' }
                                }
                            },
                            plugins: { legend: { display: false } }
                        }
                    });
                }
            }, 100);
        }
        
        // ÌåêÎß§ Îç∞Ïù¥ÌÑ∞ Ïó∞Í≥Ñ Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏÉùÏÑ± (Í∞úÏÑ† Î≤ÑÏ†Ñ)
        function generateVocSalesInsights(category, vocData, categoryName) {
            const insightsDiv = document.getElementById('vocInsightsContent');
            let insights = [];
            
            if (!preprocessedData || !preprocessedData.categories) {
                insights.push('<p>ÌåêÎß§ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏñ¥ Ïù∏ÏÇ¨Ïù¥Ìä∏Î•º ÏÉùÏÑ±Ìï† Ïàò ÏóÜÏäµÎãàÎã§.</p>');
                insightsDiv.innerHTML = insights.join('');
                return;
            }
            
            const categoryMap = {
                'DJ_PD': ['DJ', 'PD'],
                'WJ': ['WJ'],
                'PT_WP_DP': ['PT', 'WP', 'DP']
            };
            
            const targetCategories = categoryMap[category] || [];
            let totalSales = 0;
            let totalDomestic = 0;
            let totalDF = 0;
            const categoryBreakdown = {};
            
            ['OUTER', 'INNER', 'BOTTOM'].forEach(group => {
                const categories = preprocessedData.categories[group] || [];
                categories.forEach(cat => {
                    if (targetCategories.includes(cat.item)) {
                        totalSales += cat.salesTotal || 0;
                        totalDomestic += cat.salesDomestic || 0;
                        totalDF += cat.salesDF || 0;
                        categoryBreakdown[cat.item] = {
                            salesTotal: cat.salesTotal || 0,
                            salesDomestic: cat.salesDomestic || 0,
                            salesDF: cat.salesDF || 0
                        };
                    }
                });
            });
            
            const vocCount = vocData.length;
            const domesticRatio = totalSales > 0 ? (totalDomestic / totalSales * 100).toFixed(1) : 0;
            const dfRatio = totalSales > 0 ? (totalDF / totalSales * 100).toFixed(1) : 0;
            const salesPerVoc = totalSales > 0 ? totalSales / vocCount : 0;
            
            // VOC Í∞êÏÑ± Î∂ÑÏÑù
            let positiveCount = 0;
            let negativeCount = 0;
            let allTexts = [];
            
            vocData.forEach(row => {
                Object.values(row).forEach(val => {
                    if (val && typeof val === 'string' && val.trim() && val !== 'nan' && val.length > 10) {
                        allTexts.push(val);
                    }
                });
            });
            
            allTexts.forEach(text => {
                const sentiment = categorizeSentiment(text);
                if (sentiment === 'positive') positiveCount++;
                if (sentiment === 'negative') negativeCount++;
            });
            
            const positiveRatio = allTexts.length > 0 ? (positiveCount / allTexts.length * 100).toFixed(1) : 0;
            const negativeRatio = allTexts.length > 0 ? (negativeCount / allTexts.length * 100).toFixed(1) : 0;
            
            insights.push(`
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #667eea;">
                    <h4 style="color: #667eea; margin-bottom: 20px; font-size: 1.5em; display: flex; align-items: center; gap: 10px;">
                        <span>üìà</span> ÌåêÎß§ ÌòÑÌô© Î∂ÑÏÑù
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">Ï¥ù ÌåêÎß§Ïï°</div>
                            <div style="font-size: 2em; font-weight: bold; color: #667eea;">${formatSalesAmount(totalSales)}</div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 5px;">Î∞±ÎßåÏõê</div>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">Íµ≠ÎÇ¥ ÌåêÎß§</div>
                            <div style="font-size: 1.8em; font-weight: bold; color: #4caf50;">${formatSalesAmount(totalDomestic)}</div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 5px;">${domesticRatio}%</div>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">D/F ÌåêÎß§</div>
                            <div style="font-size: 1.8em; font-weight: bold; color: #ff9800;">${formatSalesAmount(totalDF)}</div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 5px;">${dfRatio}%</div>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">VOCÎãπ ÌåêÎß§Ïï°</div>
                            <div style="font-size: 1.8em; font-weight: bold; color: #764ba2;">${formatSalesAmount(salesPerVoc)}</div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 5px;">Î∞±ÎßåÏõê/VOC</div>
                        </div>
                    </div>
                    ${Object.keys(categoryBreakdown).length > 1 ? `
                    <div style="background: white; padding: 15px; border-radius: 10px; margin-top: 15px;">
                        <strong>Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌåêÎß§ Î∂ÑÌè¨:</strong>
                        ${Object.entries(categoryBreakdown).map(([cat, data]) => {
                            const ratio = totalSales > 0 ? (data.salesTotal / totalSales * 100).toFixed(1) : 0;
                            return `<span style="margin: 0 10px;">${cat}: ${formatSalesAmount(data.salesTotal)} (${ratio}%)</span>`;
                        }).join(' | ')}
                    </div>
                    ` : ''}
                </div>
            `);
            
            insights.push(`
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h4 style="color: #667eea; margin-bottom: 20px; font-size: 1.5em; display: flex; align-items: center; gap: 10px;">
                        <span>üí¨</span> VOC Í∞êÏÑ± Î∂ÑÏÑù
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                        <div style="background: #e8f5e9; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #4caf50;">
                            <div style="font-size: 2em; margin-bottom: 10px;">üòä</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #2e7d32;">${positiveCount}Í±¥</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Í∏çÏ†ï</div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 5px;">${positiveRatio}%</div>
                        </div>
                        <div style="background: #fff3e0; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #ff9800;">
                            <div style="font-size: 2em; margin-bottom: 10px;">üòê</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #e65100;">${allTexts.length - positiveCount - negativeCount}Í±¥</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Ï§ëÎ¶Ω</div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 5px;">${(100 - parseFloat(positiveRatio) - parseFloat(negativeRatio)).toFixed(1)}%</div>
                        </div>
                        <div style="background: #ffebee; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #f44336;">
                            <div style="font-size: 2em; margin-bottom: 10px;">üòü</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #c62828;">${negativeCount}Í±¥</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Î∂ÄÏ†ï</div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 5px;">${negativeRatio}%</div>
                        </div>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <strong>üìä Î∂ÑÏÑù Í≤∞Í≥º:</strong> Ï†ÑÏ≤¥ ${allTexts.length}Í±¥Ïùò VOC ÌÖçÏä§Ìä∏ Ï§ë 
                        <strong style="color: #4caf50;">Í∏çÏ†ï ${positiveCount}Í±¥ (${positiveRatio}%)</strong>, 
                        <strong style="color: #f44336;">Î∂ÄÏ†ï ${negativeCount}Í±¥ (${negativeRatio}%)</strong>Î°ú 
                        ${parseFloat(positiveRatio) > parseFloat(negativeRatio) ? 'Ï†ÑÎ∞òÏ†ÅÏúºÎ°ú Í∏çÏ†ïÏ†ÅÏù∏ ÌîºÎìúÎ∞±Ïù¥ Ïö∞ÏÑ∏Ìï©ÎãàÎã§.' : 'Î∂ÄÏ†ïÏ†Å ÌîºÎìúÎ∞±Ïù¥ ÏÉÅÎãπ Î∂ÄÎ∂ÑÏùÑ Ï∞®ÏßÄÌïòÎØÄÎ°ú Ï¶âÏãú Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.'}
                    </div>
                </div>
            `);
            
            if (category === 'DJ_PD') {
                const satisfactionCols = ['Ïª¨Îü¨', 'ÏÜåÏû¨', 'Ìïè', 'Í∏∞Ïû•', 'Í∞ÄÍ≤©', 'ÎîîÏûêÏù∏ ÎîîÌÖåÏùº', 'Î≥ºÎ•®Í∞ê(ÌïÑÌååÏõå)', 'Í∏∞Îä•ÏÑ±', 'Î¨¥Í≤åÍ∞ê'];
                const satisfactionScores = {};
                
                satisfactionCols.forEach(col => {
                    const scores = vocData.map(row => parseFloat(row[col])).filter(score => !isNaN(score) && score > 0);
                    if (scores.length > 0) {
                        satisfactionScores[col] = scores.reduce((a, b) => a + b, 0) / scores.length;
                    }
                });
                
                const sortedScores = Object.entries(satisfactionScores).sort((a, b) => b[1] - a[1]);
                if (sortedScores.length > 0) {
                    const topSatisfaction = sortedScores[0];
                    const lowSatisfaction = sortedScores[sortedScores.length - 1];
                    const gap = (topSatisfaction[1] - lowSatisfaction[1]).toFixed(2);
                    
                    insights.push(`
                        <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                            <h4 style="color: #667eea; margin-bottom: 20px; font-size: 1.5em;">‚≠ê ÎßåÏ°±ÎèÑ vs ÌåêÎß§ Ïó∞Í≥Ñ Î∂ÑÏÑù</h4>
                            <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #4caf50;">
                                <strong>‚úÖ ÏµúÍ≥† ÎßåÏ°±ÎèÑ:</strong> ${topSatisfaction[0]} Ìï≠Î™©Ïù¥ ${topSatisfaction[1].toFixed(2)}Ï†êÏúºÎ°ú Í∞ÄÏû• ÎÜíÏùÄ ÎßåÏ°±ÎèÑÎ•º Î≥¥ÏûÖÎãàÎã§. 
                                Ïù¥Îäî ${topSatisfaction[0]}Í∞Ä ÌåêÎß§Ïóê Í∏çÏ†ïÏ†Å ÏòÅÌñ•ÏùÑ ÎØ∏ÏπòÎäî Í∞ïÏ†ê ÏöîÏÜåÏûÑÏùÑ ÏãúÏÇ¨Ìï©ÎãàÎã§.
                            </div>
                            <div style="background: #ffebee; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #f44336;">
                                <strong>‚ö†Ô∏è Í∞úÏÑ† ÌïÑÏöî:</strong> ${lowSatisfaction[0]} Ìï≠Î™©Ïù¥ ${lowSatisfaction[1].toFixed(2)}Ï†êÏúºÎ°ú Í∞ÄÏû• ÎÇÆÏùÄ ÎßåÏ°±ÎèÑÎ•º Í∏∞Î°ùÌñàÏäµÎãàÎã§. 
                                ÏµúÍ≥† Ìï≠Î™©Í≥º ${gap}Ï†êÏùò Ï∞®Ïù¥Í∞Ä ÏûàÏñ¥ Ï¶âÏãú Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.
                            </div>
                            <div style="background: #fff3cd; padding: 15px; border-radius: 10px; border-left: 4px solid #ffc107;">
                                <strong>üí° Ïù∏ÏÇ¨Ïù¥Ìä∏:</strong> ${lowSatisfaction[0]} ÎßåÏ°±ÎèÑÎ•º ${topSatisfaction[1].toFixed(1)}Ï†ê ÏàòÏ§ÄÏúºÎ°ú Í∞úÏÑ†ÌïúÎã§Î©¥, 
                                ÏòàÏÉÅ ÌåêÎß§ Ï¶ùÍ∞ÄÏú®ÏùÄ ÏïΩ ${((topSatisfaction[1] - lowSatisfaction[1]) / lowSatisfaction[1] * 100).toFixed(1)}%Î°ú Ï∂îÏ†ïÎê©ÎãàÎã§.
                            </div>
                        </div>
                    `);
                }
            }
            
            insights.push(`
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px; color: white; box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);">
                    <h4 style="margin-bottom: 20px; font-size: 1.5em; display: flex; align-items: center; gap: 10px;">
                        <span>üéØ</span> ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏ Î∞è Í∂åÏû•ÏÇ¨Ìï≠
                    </h4>
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px); line-height: 1.8;">
                        <p style="margin-bottom: 15px;">
                            <strong>1. ÌåêÎß§-ÌîºÎìúÎ∞± ÏÉÅÍ¥ÄÍ¥ÄÍ≥Ñ:</strong> VOC ${vocCount}Í±¥Í≥º ÌåêÎß§Ïï° ${formatSalesAmount(totalSales)} (Î∞±ÎßåÏõê)ÏùÑ Î∂ÑÏÑùÌïú Í≤∞Í≥º, 
                            VOC 1Í±¥Îãπ ÌèâÍ∑† ÌåêÎß§Ïï°ÏùÄ <strong>${formatSalesAmount(salesPerVoc)}</strong> (Î∞±ÎßåÏõê)ÏûÖÎãàÎã§. 
                            Ïù¥Îäî Í≥†Í∞ù ÌîºÎìúÎ∞±Ïùò ÏßàÍ≥º ÏñëÏù¥ ÌåêÎß§ ÏÑ±Í≥ºÏóê ÏßÅÏ†ëÏ†ÅÏù∏ ÏòÅÌñ•ÏùÑ ÎØ∏Ïπ®ÏùÑ Î≥¥Ïó¨Ï§çÎãàÎã§.
                        </p>
                        <p style="margin-bottom: 15px;">
                            <strong>2. Ï±ÑÎÑêÎ≥Ñ Î∂ÑÏÑù:</strong> Íµ≠ÎÇ¥ ÌåêÎß§Í∞Ä ${domesticRatio}%, D/F ÌåêÎß§Í∞Ä ${dfRatio}%Î•º Ï∞®ÏßÄÌï©ÎãàÎã§. 
                            ${parseFloat(domesticRatio) > parseFloat(dfRatio) ? 'Íµ≠ÎÇ¥ ÏãúÏû•Ïù¥ Ï£ºÏöî ÌåêÎß§ Ï±ÑÎÑêÏù¥ÎØÄÎ°ú Íµ≠ÎÇ¥ Í≥†Í∞ù VOCÏóê Îçî ÏßëÏ§ëÌï† ÌïÑÏöîÍ∞Ä ÏûàÏäµÎãàÎã§.' : 'D/F Ï±ÑÎÑê ÎπÑÏ§ëÏù¥ ÎÜíÏúºÎØÄÎ°ú Í∏ÄÎ°úÎ≤å Í≥†Í∞ù ÎãàÏ¶àÎèÑ Ìï®Íªò Í≥†Î†§Ìï¥Ïïº Ìï©ÎãàÎã§.'}
                        </p>
                        <p style="margin-bottom: 15px;">
                            <strong>3. Í∞úÏÑ† Ìö®Í≥º ÏòàÏ∏°:</strong> ${parseFloat(negativeRatio) > 20 ? 
                            `Î∂ÄÏ†ïÏ†Å ÌîºÎìúÎ∞±Ïù¥ ${negativeRatio}%Î°ú ÎÜíÏùÄ Ìé∏Ïù¥ÎØÄÎ°ú, Ï£ºÏöî Ïù¥Ïäà Ìï¥Í≤∞ Ïãú ÏòàÏÉÅ ÌåêÎß§ Ï¶ùÍ∞Ä Ìö®Í≥ºÎäî ÏÉÅÎãπÌï† Í≤ÉÏúºÎ°ú ÏòàÏÉÅÎê©ÎãàÎã§.` :
                            `Í∏çÏ†ïÏ†Å ÌîºÎìúÎ∞±Ïù¥ ${positiveRatio}%Î°ú Ïö∞ÏÑ∏ÌïòÎØÄÎ°ú, ÌòÑÏû¨ Í∞ïÏ†êÏùÑ Ïú†ÏßÄÌïòÎ©¥ÏÑú Í∞úÏÑ† ÏÇ¨Ìï≠Ïóê ÏßëÏ§ëÌïòÎ©¥ Ï∂îÍ∞Ä ÏÑ±Ïû•Ïù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.`}
                        </p>
                        <p style="margin-bottom: 0;">
                            <strong>4. Ïã§Ìñâ Ïö∞ÏÑ†ÏàúÏúÑ:</strong> VOC Î∂ÑÏÑù Í≤∞Í≥ºÎ•º Î∞îÌÉïÏúºÎ°ú Ï¶âÏãú Ï°∞ÏπòÍ∞Ä ÌïÑÏöîÌïú Ìï≠Î™©Î∂ÄÌÑ∞ Îã®Í≥ÑÏ†ÅÏúºÎ°ú Í∞úÏÑ†ÌïòÏó¨ 
                            Í≥†Í∞ù ÎßåÏ°±ÎèÑ Ìñ•ÏÉÅÍ≥º ÌåêÎß§ Ï¶ùÎåÄÎ•º ÎèôÏãúÏóê Îã¨ÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                        </p>
                    </div>
                </div>
            `);
            
            insightsDiv.innerHTML = insights.join('');
        }
        
        // VOC Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateVocCharts() {
            if (vocDjData.length === 0) {
                document.getElementById('djSatisfactionChart').parentElement.innerHTML = '<p style="text-align: center; color: #666;">DJ/PD VOC Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            // DJ VOC ÎßåÏ°±ÎèÑ Ï†êÏàò Ï∂îÏ∂ú
            const satisfactionCols = ['Ïª¨Îü¨', 'ÏÜåÏû¨', 'Ìïè', 'Í∏∞Ïû•', 'Í∞ÄÍ≤©', 'ÎîîÏûêÏù∏ ÎîîÌÖåÏùº', 'Î≥ºÎ•®Í∞ê(ÌïÑÌååÏõå)', 'Í∏∞Îä•ÏÑ±', 'Î¨¥Í≤åÍ∞ê'];
            const satisfactionScores = {};
            
            satisfactionCols.forEach(col => {
                const scores = vocDjData
                    .map(row => parseNumber(row[col]))
                    .filter(s => s > 0 && s <= 5);
                if (scores.length > 0) {
                    satisfactionScores[col] = scores.reduce((a, b) => a + b, 0) / scores.length;
                }
            });
            
            const labels = Object.keys(satisfactionScores);
            const scores = Object.values(satisfactionScores);
            
            if (labels.length === 0) {
                document.getElementById('djSatisfactionChart').parentElement.innerHTML = '<p style="text-align: center; color: #666;">ÎßåÏ°±ÎèÑ Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÏ∂úÌï† Ïàò ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            if (charts.djSatisfaction) {
                charts.djSatisfaction.destroy();
            }
            const djSatisfactionCtx = document.getElementById('djSatisfactionChart').getContext('2d');
            charts.djSatisfaction = new Chart(djSatisfactionCtx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ÎßåÏ°±ÎèÑ Ï†êÏàò',
                        data: scores,
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(102, 126, 234, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 5,
                            ticks: { stepSize: 1 }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
            
            // VOC Ïπ¥Ïö¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('djVocCount').textContent = vocDjData.length + 'Í±¥';
            document.getElementById('ptWpDpVocCount').textContent = vocPtWpDpData.length + 'Í±¥';
            document.getElementById('wjVocCount').textContent = vocWjData.length + 'Í±¥';
        }
        
        // Í≤ÄÏÉâ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateSearchCharts() {
            if (searchData.length === 0) {
                document.getElementById('searchChart').parentElement.innerHTML = '<p style="text-align: center; color: #666;">Í≤ÄÏÉâ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                document.getElementById('keywordTags').innerHTML = '<p style="text-align: center; color: #666;">Í≤ÄÏÉâ Îç∞Ïù¥ÌÑ∞Î•º Î°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.</p>';
                return;
            }
            
            const keywordMap = {};
            searchData.forEach(row => {
                const keyword = row['ÌÇ§ÏõåÎìú'] || '';
                const searchVolume = parseNumber(row['Í∏∞Í∞Ñ Í≤ÄÏÉâÎüâ']);
                if (keyword && searchVolume > 0) {
                    keywordMap[keyword] = (keywordMap[keyword] || 0) + searchVolume;
                }
            });
            
            const keywords = Object.keys(keywordMap)
                .sort((a, b) => keywordMap[b] - keywordMap[a])
                .slice(0, 20);
            const volumes = keywords.map(k => keywordMap[k]);
            
            if (keywords.length === 0) {
                document.getElementById('searchChart').parentElement.innerHTML = '<p style="text-align: center; color: #666;">Í≤ÄÏÉâ ÌÇ§ÏõåÎìú Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÏ∂úÌï† Ïàò ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            if (charts.search) {
                charts.search.destroy();
            }
            const searchCtx = document.getElementById('searchChart').getContext('2d');
            charts.search = new Chart(searchCtx, {
                type: 'bar',
                data: {
                    labels: keywords,
                    datasets: [{
                        label: 'Í≤ÄÏÉâÎüâ',
                        data: volumes,
                        backgroundColor: 'rgba(255, 99, 132, 0.8)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Í≤ÄÏÉâÎüâ: ' + context.parsed.x.toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        x: { beginAtZero: true }
                    }
                }
            });
            
            // ÌÇ§ÏõåÎìú ÌÉúÍ∑∏ ÏÉùÏÑ±
            const keywordTagsHtml = keywords.map(k => `
                <div class="keyword-tag">${k} (${keywordMap[k].toLocaleString()})</div>
            `).join('');
            document.getElementById('keywordTags').innerHTML = keywordTagsHtml;
        }
        
        // Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateInsights() {
            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏßëÍ≥Ñ
            const categoryMap = {};
            salesData.forEach(row => {
                const item = row['ÏïÑÏù¥ÌÖú'] || 'Í∏∞ÌÉÄ';
                const sales = parseNumber(row['ÌåêÎß§Ïï°_ÌïúÍµ≠']);
                if (!categoryMap[item]) {
                    categoryMap[item] = 0;
                }
                categoryMap[item] += sales;
            });
            
            const categories = Object.keys(categoryMap).sort((a, b) => categoryMap[b] - categoryMap[a]);
            const salesValues = categories.map(cat => categoryMap[cat]);
            const totalSales = salesValues.reduce((a, b) => a + b, 0);
            
            if (categories.length === 0) {
                document.getElementById('categoryPieChart').parentElement.innerHTML = '<p style="text-align: center; color: #666;">ÌåêÎß§ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            // ÌååÏù¥ Ï∞®Ìä∏
            if (charts.categoryPie) {
                charts.categoryPie.destroy();
            }
            const categoryPieCtx = document.getElementById('categoryPieChart').getContext('2d');
            charts.categoryPie = new Chart(categoryPieCtx, {
                type: 'doughnut',
                data: {
                    labels: categories,
                    datasets: [{
                        data: salesValues,
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)',
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(199, 199, 199, 0.8)',
                            'rgba(83, 102, 255, 0.8)'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const percentage = ((value / totalSales) * 100).toFixed(1);
                                    return label + ': ' + (value / 1000000).toFixed(1) + 'MÏõê (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
            
            // Ïù∏ÏÇ¨Ïù¥Ìä∏ Ïπ¥Îìú
            const topCategory = categories[0] || 'N/A';
            const avgSales = totalSales / categories.length;
            
            document.getElementById('insightsCards').innerHTML = `
                <div class="category-card">
                    <h4>Ï£ºÏöî Ïù∏ÏÇ¨Ïù¥Ìä∏</h4>
                    <div class="metric">
                        <span class="metric-label">ÏµúÍ≥† ÌåêÎß§ Ïπ¥ÌÖåÍ≥†Î¶¨</span>
                        <span class="metric-value">${topCategory}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ÌèâÍ∑† ÌåêÎß§Ïï°</span>
                        <span class="metric-value">${(avgSales / 1000000).toFixed(1)}MÏõê</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Ï¥ù Ïπ¥ÌÖåÍ≥†Î¶¨ Ïàò</span>
                        <span class="metric-value">${categories.length}Í∞ú</span>
                    </div>
                </div>
            `;
        }
        
        // ÌÉ≠ Ï†ÑÌôò
        function showTab(tabName, element) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            element.classList.add('active');
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        window.addEventListener('DOMContentLoaded', loadAllData);
    
        </script>
</body>
</html>
